TFL.widget("LetterNotify",{options:{notify_id:"",notification_title:"",notification_icon:"",notification_url:""},is_notify_loading:!1,is_first:!0,_init:function(i){TFL.LetterNotify.options=$.extend(TFL.LetterNotify.options,i)},get_notify:function(){if(TFL.LetterNotify.is_notify_loading===!1){TFL.LetterNotify.is_notify_loading=!0;var i=TFL.LetterNotify.options.notify_id,t=parseInt($(i).text()),o=TFL.LetterNotify.options.notification_url;TFL.LetterNotify.is_first&&(o+="&first_load=1"),o+="&t="+(new Date).getTime(),$.get(o,function(o){if(o=parseInt(o),o===t||0==o)return $(i).removeClass("nav-icon-num"),TFL.LetterNotify.is_notify_loading=!1,void(TFL.LetterNotify.is_first=!1);$(i).hasClass("nav-icon-num")||$(i).addClass("nav-icon-num"),$(i).text(o),TFL.LetterNotify.is_notify_loading=!1,TFL.LetterNotify.is_first=!1;TFL.LetterNotify.options.notification_title,TFL.LetterNotify.options.notification_icon})}},show_desktop_notify:function(i,t,o){TFL.Notification.config({pageVisibility:!1,autoClose:3e3});var n={body:t,icon:o,tag:"LetterNotify"};0!=TFL.Notification.isSupported&&(TFL.Notification.permissionLevel()==TFL.Notification.PERMISSION_DEFAULT?TFL.Notification.requestPermission(function(){TFL.Notification.createNotification(i,n)}):TFL.Notification.permissionLevel()==TFL.Notification.PERMISSION_GRANTED&&TFL.Notification.createNotification(i,n))}});var notify_options={notify_id:"#msg_count",notification_title:"TAPD通知",notification_icon:"",notification_url:_base+"/fastapp/tcloud/get_user_notify_count.php?user_id="+user_id};TFL.LetterNotify._init(notify_options),TFL.use("Notification",function(){TFL.LetterNotify.get_notify()});