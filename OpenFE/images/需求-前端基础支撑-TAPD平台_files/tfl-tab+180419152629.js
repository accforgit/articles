TFL.widget("tab",{defaults:{object:null,eventType:"click",idPrefix:"tfl-tab-",load:null,show:null,complete:null,selectTab:null,tabController:"a",autoLabelWidth:!0,loadingTips:"正在加载,请稍候..."},_init:function(){var t=this,e=t.options,a=$(e.object);if(e.object){t.panels=$([]);var n=a.find(e.tabController);e.autoWidth&&t._autoLabelWidth(a,n),n.each(function(){var n=$(this);if(!n.hasClass("dropdown-toggle")){var i=n.attr("chref");i&&n.attr("href",i)&&n.removeAttr("chref");var r,d=n.attr("href"),o=!/^#\w+/.test(d);if(o){var s=n.attr("id")?n.attr("id")+"-div":e.idPrefix+TFL.tab.getNextTabId();n.data("href",d).attr("href","#"+s),$("#"+s).length?r=$("#"+s).addClass("tab-content none"):(r=$("<div></div>").attr("id",s).addClass("tab-content none"),r.insertAfter(t.panels[t.panels.length-1]||a))}else r=$(d);t.panels=t.panels.add(r),n.bind(e.eventType,function(){var i=$(this),r=i.parent("li"),d=!1;if(i.attr("data-refresh")&&($(i.attr("href")).html("").attr("data-content",""),d=!0),!r.hasClass("current")||d){var l=a.find(".current").not(".dropdown"),h=l.find("> a").attr("href");if(t._activate(r,a),t._showPanel($(i.attr("href")),$(h)),o&&t._load($("#"+s),i.data("href")),e.selectTab){var c=TFL.parseHash();c.tab&&c.tab!==n.attr("id")&&(location.href="#tab="+n.attr("id"))}}}),n.click(function(t){t.preventDefault(),this.blur()})}}),t._setTab(e.selectTab,e.eventType),t._trigger("complete",$(e.object))}},_activate:function(t,e){e.find(".current").removeClass("current"),t.addClass("current"),t.parent().parent(".dropdown-menu").length&&t.closest("li.dropdown").addClass("current")},_load:function(t,e){var a=this,n=a.options;if(!t.attr("data-content")){!t.find("div.loading").length&&t.append("<span class='loading'></span><span class='loading-tip'>"+n.loadingTips+"</span>");var i=-1!=e.indexOf("?")?"&":"?";t.load(e+i+"r="+(new Date).getTime(),function(){$(this).attr("data-content",!0),a._trigger("load",t)})}},_showPanel:function(t,e){var a=this;a.options;e.addClass("none").removeClass("tab-current"),t.removeClass("none").addClass("tab-current"),a._trigger("show",t)},_setTab:function(t,e){var a=this;if(null!==t)if("url"===t){var n=TFL.parseHash();$("#"+n.tab).length?$("#"+n.tab).trigger(e):$(a.options.object).find(a.options.tabController).eq(0).trigger(e)}else $(t).trigger(e)},_autoLabelWidth:function(t,e){TFL.tab.autoLabelWidth(t,e)}},!1,!0),TFL.tab.tabId=0,TFL.tab.getNextTabId=function(){return++this.tabId},TFL.tab.autoLabelWidth=function(t,e){t=$(t),e=(e?$(e):t.find("a")).not(":hidden");var a=function(t,e){var a=0;if(e.each(function(){a+=$(this).outerWidth()}),a>t.outerWidth()){var n=e.length,i=t.outerWidth()/n;e.each(function(){$(this).css({"padding-left":5,"padding-right":5,"text-align":"center",width:i-12})})}};a(t,e),$(window).resize(function(){a(t,e)})},TFL.tab.autoLabelWidthButFirstFixed=function(t,e){function a(t,e){var a=0;if(t.each(function(t){a+=$(this).outerWidth()}),a>=e){var n=t.length,i=e/n;t.each(function(){$(this).css({"text-align":"center",width:i-40}),$(this).find("a").css({width:i-15}),$(this).find("span").css({width:i-40})})}else t.each(function(){$(this).css({"text-align":"center",width:"inherit"}),$(this).find("span").css({"max-width":"150px",width:"inherit"}),$(this).find("a").css({width:"inherit"})})}if(t=$(t),e)var n=e.eq(0).outerWidth();else{var n=t.find("li").not(":hidden").eq(0).outerWidth();e=t.find("li:gt(0)").not(":hidden")}a(e,t.outerWidth()-n),$(window).resize(function(){a(e,t.outerWidth()-n)})};