function quick_add_child(e,t,a,i,n,l,o){var c=$(e).closest("tr");if(c){var s=i+"name",r=($("#"+s),$("#"+s).find("a:last"));0===r.length&&(r=$("#story_"+i)),$(r).attr("title")&&(a=$(r).attr("title"))}"function"==typeof before_call_quick_add&&before_call_quick_add(e);var d=enableHebe?"tfl-dkselect":"",u=c.find("td").length,_=$(".quick_add_"+i).length,p=i,i=i+"_"+_,b='<tr class="quick_add_'+p+'" id="quick_add_tr_'+i+'"><td colspan='+u+' style="overflow:visible"><form class="create-child-story-form" onsubmit="return false;" id="quick_add_'+i+'">',f="</form></td>";enableHebe?input_lab='<span id="child-story-input-span" title="'+t+'"><input placeholder="请输入需求标题" class="quick_add_input tapd-txt" id="quick_add_input'+i+'" type="text" size="100" value="'+htmlspecialchars_encode(a)+'" name="data['+l+'][name]" ></span>':input_lab='<span title="'+t+'" style="margin-left:120px;"><input class="quick_add_input" id="quick_add_input'+i+'" class="tapd-txt" type="text" size="100" value="'+htmlspecialchars_encode(a)+'" name="data['+l+'][name]" style="color: black; width:300px;" ></span>',enableHebe?priority_label='<span id="child-story-priority-span" title="优先级"><select onchange="clean_select(this)" name="data['+l+'][priority]" class="placeholder '+d+'"><option value="">优先级</font></option><option value="4">High</option><option value="3">Middle</option><option value="2">Low</option><option value="1">Nice To Have</option></select></span>':priority_label='<span title="优先级" style="margin-left:50px;"><select onclick="clean_select(this)" name="data['+l+'][priority]" style="color:grey;" class="placeholder '+d+'"><option value="">优先级</font></option><option value="4">High</option><option value="3">Middle</option><option value="2">Low</option><option value="1">Nice To Have</option></select></span>',enableHebe?(createChildStoyIndex=createChildStoyIndexResult(),owner_label='<span class="owner-span"><input name="data['+l+'][owner]" class="owner-input" placeholder="处理人" type="text" data-control="pinyinuserchooser" id="StoryOwner'+createChildStoyIndex+'" choose-type="1" data-src-path="'+_base+'" data-src-param="?workspace_id='+_workspace_id+'" /></span>'):owner_label='<span title="处理人" style="margin-left:50px;"><input type="text" value="处理人" id="owner_userchoose'+i+'" class="placeholder" name="data['+l+'][owner]" data-control="pinyinuserchooser" style="color:grey;" onclick="clean_input(this)"/></span>',enableHebe?(submit_btn='<span id="create-child-story-button-span"><a onclick="quick_submit(\''+i+"', '"+n+"','"+p+"', '"+o+'\', this)" class="sure-button btn btn-primary"  ><span>快速创建</span></a>',cancel_btn='<a class="cancel-button" onclick="cancel_quick_submit(\''+i+"')\">取消</a></span>"):(submit_btn='<a style="margin-left:50px;overflow:hidden;vertical-align:middle;" onclick="quick_submit(\''+i+"', '"+n+"','"+p+"', '"+o+'\', this)" class="btn btn-primary"  ><span>快速创建</span></a>',cancel_btn='<a style="margin-left:10px;" onclick="cancel_quick_submit(\''+i+"')\">取消</a>"),f+="</tr>";var h=b+input_lab+priority_label+owner_label+submit_btn+cancel_btn+f,m=$(h);$("#owner_userchoose"+i).live("focus",function(){$(this).click()}),c.after(m),$("#quick_add_input"+i).focus().val("").val(a),m.find(".quick_add_input").on("keydown",function(e){13===e.keyCode&&m.find(".btn").click()})}function getCreateChildStoyKey(){function e(){return t++}var t=1;return e}function check_empry(e){return""===$("#quick_add_input"+e).val().trim()||$("#quick_add_input"+e).hasClass("placeholder")?($("#quick_add_input"+e).css("border","1px solid red"),TFL.tips.showFlash("标题不能为空！",!0,1500),!0):(enableHebe||$("#quick_add_input"+e).css("border",""),!1)}function show_loading(e,t){var a=$("#quick_add_tr_"+e).find(".btn");a.attr("disabled","disabled"),a.addClass("disabled"),a.find("span").text("正在提交...");var i=$("#quick_add_tr_"+e+" a");i.removeAttr("onclick"),i.addClass("secondary")}function quick_submit(e,t,a,i,n){if(!check_empry(e)){var l=$("#quick_add_"+e).serializeArray(),o=$(n).parents("table");show_loading(e),i||(i=""),$.post(t,l,function(t){if(t.length>0&&"0"!=t){if("number_limited"==t)return TFL.tips.showFlash("子需求的总个数不能超过200"),cancel_quick_submit(e),!1;var n=t;t=n.replace(/URLCACHEKEY/g,i);var l=o.find("#"+a);if(0===l.length&&(l=o.find("tr[story_id="+a+"]")),l.prev().length>0){var c=l.prev();l.remove(),c.after(t)}else{var s=l.next();l.remove(),s.before(t)}enableHebe&&TFL.avatarList.init(),cancel_quick_submit(e),"function"==typeof quick_add_call_back&&quick_add_call_back(e)}"0"==t?(TFL.tips.showFlash("你没有创建需求的权限。",!0,1500),cancel_quick_submit(e)):cancel_quick_submit(e)})}}function cancel_quick_submit(e){$("#quick_add_tr_"+e).remove(),"function"==typeof reload_action&&reload_action(e)}function clean_select(e){enableHebe?($(e).css("color","#000"),""==$(e).val()?$(e).addClass("placeholder"):$(e).removeClass("placeholder")):($(e).css("color","black").removeClass("placeholder"),$(e).find("option").eq(0).text(""),$(e).removeAttr("onclick"))}function clean_input(e){$(e).css("color","black").removeClass("placeholder"),e.value="",$(e).removeAttr("onclick")}function remove_entity(e){var t=$(e),a=t.attr("url"),i=t.attr("tip");i=$("<div/>").text(i).html(),TFL.confirm(i,function(){$.get(a,function(a){if($(e).closest("table").hasClass("list-view-table"))$(t).closest("tr").remove();else{var i=t.parents("div.iteration_table_wrapper"),n=$("a[is_loaded=1]",i);if(n.length>0)n.removeAttr("is_loaded"),n.removeClass("fold font-fold"),n.triggerHandler("click");else if("undefined"!=typeof load_content_by_url){$("#s_t_tab").attr("init","false");var l=new Date,o=$("#s_t_button").attr("att_url")+"&time="+l.getTime(),c=parseInt($("#story_task_sum").html()),s=parseInt($("#task_num").html());c=c>0?c-1:c,s=s>0?s-1:s,load_content_by_url("s_t",o),$("#story_task_sum").html(c),$("#task_num").html(s)}}})},function(){})}function switch_placeholder(e){var t="story"==$(e).attr("obj-type")?"请输入需求标题":"请输入任务标题";$("#quick-create-name").attr("placeholder",t)}$(document).delegate('[data-control="pinyinuserchooser"]',"focus",function(){$(this).val().indexOf("处理人")>-1&&$(this).val($(this).val().replace(/处理人;/,""))});