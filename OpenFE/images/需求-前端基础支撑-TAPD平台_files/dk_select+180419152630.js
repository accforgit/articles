function init_dk_selects(){TFL.use("pinyinEngine",function(){get_all_selects().DkSelect({pinyin:!0})})}function get_all_selects(){return $("#StoryVersion, #StoryIterationId, #StoryReleaseId, #StoryModule, #StoryFeature, #TaskIterationId, #selectVersion, #selectModule, #LaunchFormReleaseId,  #LaunchFormRoadmapVersion, #BugModule, #BugIterationId, #BugBaselineFind, #BugBaselineJoin, #BugVersionReport, #BugBaselineClose, #BugVersionTest, #BugBaselineTest, #BugVersionFix, #BugVersionClose, #BugFeature, .dk_select_item")}var last_expanded=null;!function(e){e.extend(e.fn,{DkSelect:function(t){var t=e.extend({refresh:!1,"auto-suggest":!1,input_plus:!0,pinyin:!0},t),i=e(this);return t.pinyin?TFL.use("pinyinEngine",function(){i.dk_select_init(t)}):this.dk_select_init(t),this},dk_select_init:function(t){this.each(function(){function i(){n.list_panel.find("tr td.option_selected").removeClass("option_selected");var t=e.trim(n.panel.val());"-All-"==t&&(t=""),t=t.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1"),t=n.escapeHtml(t);var i=new RegExp(t,"i"),s=(new RegExp("(.*?)("+t+")(.*)","i"),!1),l=n.list_panel.find(".optgroup-label");if(l.hide(),n.options.pinyin&&n.asyncSignal>=0){var a=[];n.PinyinEngine.search(t,function(e){a.push(e)})}if(n.list_panel.find("tr").not(".optgroup-label").each(function(l,o){var d=e(o),r=n.escapeHtml(n.select_options[l]),p=d.find("td");n.options.pinyin&&n.asyncSignal>=0&&jQuery.inArray(r,a)>=0||i.test(r)?(s=!0,r||(r="-- 空 --"),p.html(r.replace(new RegExp("("+t+")","i"),"<b>$1</b>")),d.show(),d.hasClass("optgroup-item")&&d.prevAll(".optgroup-label").first().show()):(p.text(r),d.hide())}),!s&&!n.input_plus){console.log("not match");var o=n.list_panel.find("tr:first");o.show(),o.hasClass("optgroup-label")&&o.next().show()}}var n=e(this);if(n.options=e.extend({refresh:!1,"auto-suggest":!1,input_plus:!0,pinyin:!1},t),n.data("dk_settings",n.options),!n.attr("disabled")){if(n.options.pinyin&&(n.PinyinEngine=new pinyinEngine,n.asyncSignal=0),"enhanced"==n.attr("enhanced")&&!n.options.refresh)return n;n.key="Dk_"+Math.floor(1e10*Math.random()).toString(36),n.attr("key",n.key),n.attr("enhanced","enhanced"),n.find("~ .dk_select").remove(),n.find("~ .font-arrow-down").remove(),n.parent().hasClass("dk_select_wrapper")&&n.unwrap(),n.enter_select=!1,n.current_highlight=null,n.input_plus=n.options.input_plus,(n.hasClass("editable")||n.hasClass("hide_drop_icon"))&&(n.input_plus=!1);var s="dk_select_wrapper";n.input_plus===!0&&(s+=" dk_select_plus_wrapper"),n.wrap('<div class="'+s+'"/>'),n.parent().append('<i class="font font-arrow-down"></i>');var l=n.cover=n.get_cover(),a=n.panel=n.get_panel(n.hasClass("hide_drop_icon"));n.after(l),!n.input_plus&&l.after(a),l.unbind("click").bind("click",function(i){n.toggle_list_panel(e(i.target),t),n.show_items()}),l.unbind("mouseenter").mouseenter(function(){var t=e.trim(n.find("option:selected").text());t&&"&nbsp;"!=t?e(this).attr("title",t):e(this).removeAttr("title")}),n.unbind("focus").bind("focus",function(){});var o=null;n.input_plus||a.unbind("focus").bind("focus",function(i){n.toggle_list_panel(e(i.target),t),this.input_plus||(n.select_value=n.get_selected_text()),n.show_items(),i.preventDefault()}),a.unbind("blur").bind("blur",function(t){if(!n.enter_select){if(n.hasClass("editable")){var i=n.panel.val();if(i==n.select_value)return;i=e("<div/>").text(i).html(),n.append("<option value='"+i+"'>"+i+"</option"),n.val(i)}else n.panel.val(""),""!=n.select_value&&!this.list_panel&&n.panel.val(n.select_value);n.list_panel.find("tr td.option_selected").removeClass("option_selected"),n.last_selection&&n.last_selection.addClass("option_selected"),n.hide_items()}}).unbind("keyup").bind("keyup",function(t){return e.inArray(t.keyCode,new Array(9,13,40,38,34,33))>0?!0:(null!=o&&clearTimeout(o),void(o=setTimeout(i,150)))}).unbind("keydown").bind("keydown",function(e){switch(e.keyCode){case 40:n.highlight_next();break;case 38:n.highlight_prev();break;case 13:n.select_this(),e.preventDefault(),e.stopPropagation()}})}})},hide_last_expanded:function(){last_expanded&&(last_expanded.css("display","none"),e.browser.msie&&this.panelWidth(last_expanded,last_expanded.data("minwidth")).parent().removeClass("dk_select_current"))},getParentYScroll:function(t){for(var i=t.parents(),n=0;n<i.length;n++){var s=e(i[n]);if("HTML"==s[0].tagName)return e(i[n-1]);if(s[0].scrollHeight-s.outerHeight()>0&&s.hasClass("webkit-scrollbar"))return e(i[n])}},getParentXScroll:function(t){for(var i=t.parents(),n=0;n<i.length;n++){var s=e(i[n]);if("HTML"==s[0].tagName)return e(i[n-1]);if(s[0].scrollWidth-s.outerWidth()>0&&s.hasClass("webkit-scrollbar"))return e(i[n])}},bindScrollEvent:function(e){_this=this,parentY=this.getParentYScroll(e),parentY.unbind("scroll").bind("scroll",function(){var t=e.offset().top;t+=e.outerHeight(),_this.list_panel.css({top:t});var i=_this.list_panel.find(".dk_table_wrapper").css("max-height").replace("px","");new_max_height=parentY.outerHeight()-e.position().top-60,i=new_max_height>i?i:new_max_height,_this.list_panel.find(".dk_table_wrapper").css("max-height",i)}),parentX=this.getParentXScroll(e),parentX[0]==parentY[0]||parentX.unbind("scroll"),parentX.bind("scroll",function(){var t=e.offset().left;t+_this.list_panel.outerWidth()>window.innerWidth&&(t=window.innerWidth-_this.list_panel.outerWidth()),_this.list_panel.css({left:t})})},toggle_list_panel:function(t,i){if(this.list_panel){var n=this.list_panel;e(this.cover).length>0&&this.bindScrollEvent(e(this.cover))}else{var n=this.list_panel=this.get_list_panel(i);e(this.cover).length>0?(e("body").append(n),this.bindScrollEvent(e(this.cover))):e("body").append(n)}var s=null;s=e(this.input_plus?this.cover:this.panel);var l=e(window).scrollLeft(),a=e(window).scrollTop(),o=s.offset().left,d=s.offset().top,r=3;o-l+n.width()>window.innerWidth&&(o=window.innerWidth-n.width()+l),n.css({left:o}),d-a+n.outerHeight()+10>window.innerHeight&&d-n.outerHeight()-r>0?d=d-n.outerHeight()-r:d+=s.outerHeight(),n.css({top:d}),!!this.input_plus&&this.panel.val(""),this.hide_last_expanded();var p=this;this.list_panel.find("tr").not(".optgroup-label").each(function(t,i){var n=p.select_options[t];""==n||"--"==n?e(i).find("td").text("-- 空 --").attr("title",n):e(i).find("td").text(n).attr("title",n)}),this.list_panel.find("tr").show(),last_expanded=this.list_panel},get_position:function(e){var t=this;return"undefined"!=typeof e&&(t=e),t.position()},get_cover:function(){var t=e('<div class="dk_select dk_cover"/>'),i=this.get_position(),n=this.outerHeight(),s={};return this.data("pos",i),n>20&&(s.height=n),t.css(s),t},get_panel:function(t){var i=this.outerWidth()-22,n=(this.height(),this.data("pos")),s={},l=e('<input type="text" class="dk_select dk_panel" autocomplete="off"/>');return t&&(i+=16,l.addClass("dk_border")),s.width=i,n.left>0&&(s.left=t?n.left:n.left+1),n.top>0&&(s.top=t?n.top:n.top+1),l.css(s),!this.input_plus&&l.val(this.get_selected_text()),l},get_selected_text:function(){var t=this[0].selectedIndex,i=this.find("option").eq(t);if(0>t)return"";var n=i.text();return" "==n?"":""==i.val()?"":e.trim(n)},get_list_panel:function(t){var i=this,n=this.outerHeight(),s=e('<div class="dk_select dk_list_panel"><div class="dk_input_wrapper"><i class="font font-search"></i></div><div class="dk_table_wrapper webkit-scrollbar"><table><tbody></tbody></table></div></div>'),l=this.children(),a=s.find("table tbody"),o=(this.data("pos"),{});"undefined"!=typeof t.color_block&&s.addClass("dk_list_panel_color_block");var d=null;d=e(this.input_plus?this.cover:this.panel),i.options.fixHeight?s.css({width:"240px",top:n+5+d.offset().top,left:d.offset().left}):s.css({"max-width":"240px",top:n+5+d.offset().top,left:d.offset().left}),this.panelWidth(s,o["min-width"]).data("minwidth",o["min-width"]),i.select_options=[],i.select_table=a;var r,p;for(r=0,p=l.length;p>r;r++)if("OPTGROUP"==l[r].nodeName)i.addGroupNode(l.eq(r));else{if(l[r].getAttributeNode("placeholder"))continue;i.addOptionNode(l.eq(r),0,t)}return s.bind("mouseover",function(e){i.enter_select=!0}).bind("mouseout",function(){i.enter_select=!1}),s.find("td").bind("click",function(t){return e(this).parent().hasClass("optgroup-label")?void t.stopPropagation():(i.removeClass("simulate_select_placeholder"),i.select_item(e(this)),void t.stopPropagation())}),i.input_plus&&(s.find(".dk_input_wrapper").append(i.panel),i.panel.removeAttr("style")),s},addGroupNode:function(t){var i,n,s=this,l=t.children(),a=(s.parent(),e('<tr class="optgroup-label"><td>'+t.attr("label")+"</td></tr>"));for(s.select_table.append(a),i=0,n=l.length;n>i;i++)s.addOptionNode(l.eq(i),1)},addOptionNode:function(t,i,n){var s=this,l=t.text(),a=t.val(),o="",d={"":"empty","--":"empty",High:"High",Middle:"Middle",Low:"Low","Nice To Have":"Nice-To-Have","紧急":"Urgent","高":"High","中":"Middle","低":"Low","无关紧要":"Nice-To-Have",fatal:"fatal","致命":"fatal",serious:"serious","严重":"serious",normal:"normal","一般":"normal",prompt:"prompt","提示":"prompt",advice:"advice","建议":"advice"},n=e.extend({},n);""===a&&(l=""),s.select_options.push(l);var r=e("<tr><td></td></tr>");o=d[l],"undefined"!=typeof n.color_block&&(r.addClass(n.color_block+"-color-"+o.toLowerCase()),r.append(e('<span class="font font-ok"></span>'))),r.find("td").attr("val",a),r.find("td").attr("title",l),""==l?r.find("td").text("-- 空 --"):r.find("td").text(l),i&&r.addClass("optgroup-item"),r.bind("mouseover",function(){s.last_selection&&("undefined"!=typeof n.color_block||s.last_selection.removeClass("option_selected")),e(this).addClass("option_hover"),s.enter_select=!0}).bind("mouseout",function(){e(this).removeClass("option_hover")}),1==t.attr("selected")&&(s.last_selection=r.find("td"),s.last_selection.addClass("option_selected")),s.select_table.append(r),s.options.pinyin&&(s.asyncSignal--,setTimeout(function(){s.PinyinEngine.setCache([l],l),s.asyncSignal++},1))},select_item:function(t){var i=t.text(),n=t.attr("val");this.get(0).value=n,this.val(n),!this.input_plus&&this.panel.val(e.trim(i)),this.select_value=i,this.list_panel.find("td.option_selected").removeClass("option_selected"),t.addClass("option_selected"),this.last_selection=t,this.trigger("change"),this.trigger("click"),this.hide_items()},show_items:function(){var t=this.list_panel;t.css({display:"block",width:this.outerWidth(),"max-width":"","box-sizing":"border-box"}),e.browser.msie&&this.panelWidth(t,t.find("table").width()).parent().addClass("dk_select_current"),!!this.input_plus&&this.panel.focus()},hide_items:function(t){var i=t||this.list_panel;i.css("display","none"),e.browser.msie&&this.panelWidth(i,i.data("minwidth")).parent().removeClass("dk_select_current"),this.trigger("close.dkselect")},highlight_next:function(){var t=this.list_panel.find("tr:not(:hidden)").not(".optgroup-label"),i=t.find("td.option_selected"),n=null;if(0===i.length)n=t.eq(0).find("td"),n.addClass("option_selected");else for(var s=0;s<t.size();s++)if(e(t[s]).find("td.option_selected").size()>0){s<t.size()-1&&(n=e(t[s+1]).find("td"),n.addClass("option_selected"),i.removeClass("option_selected"));break}this.current_highlight=n},highlight_prev:function(){var t=this.list_panel.find("tr:not(:hidden)").not(".optgroup-label"),i=t.find("td.option_selected");if(0!==i.length)for(var n=0;n<t.size();n++)if(e(t[n]).find("td.option_selected").size()>0){if(n>0){var s=e(t[n-1]).find("td");s.addClass("option_selected"),i.removeClass("option_selected"),this.current_highlight=s}break}},select_this:function(){null!==this.current_highlight&&this.select_item(this.current_highlight)},select_option_by_value:function(e){this.val(e);var t=this.get_selected_text();this.find("~ .dk_panel").val(t)},disable:function(){var t=e('<div class="dk_select dk_disabled_cover" />'),i=this.outerHeight();i>20&&t.css({height:i}),this.after(t),this.attr("disabled","disabled"),this.find("~ .dk_panel").addClass("dk_panel_disabled")},enable:function(){this.find("~ .dk_disabled_cover").remove(),this.removeAttr("disabled"),this.find("~ .dk_panel").removeClass("dk_panel_disabled")},escapeHtml:function(e){var t=document.createElement("div"),i=document.createTextNode(e);return t.appendChild(i),t.innerHTML},panelWidth:function(e,t){return t>500?e.css("min-width",500):e.css("min-width",t)}})}(jQuery);var dk_timer;$(document).ready(function(){window.has_loaded_dk_select||(window.has_loaded_dk_select=!0,$.browser.msie&&"6.0"==$.browser.version||(setTimeout(init_dk_selects,200),$(document).bind("dk_select_options_updated",function(e,t){var i=$(e.target);t&&(i=$("#"+t));var n=i.data("dk_settings");$.extend(n,{refresh:!0}),i.DkSelect(n)}),$(document).bind("dk_select_async_updated",function(e,t){clearTimeout(dk_timer),dk_timer=setTimeout(init_dk_selects,100)}),$(document).bind("dk_select_rebind",function(e){get_all_selects().DkSelect()}),$(document).bind("click",function(e){var t=$(e.target);t.hasClass("dk_cover")||t.hasClass("dk_panel")||t.hasClass("dk_list_panel")||void 0!=$(this).hide_last_expanded&&$(this).hide_last_expanded(),t.hasClass("simulate_select_placeholder")&&t.bind("change",function(){t.removeClass("simulate_select_placeholder")})})))});