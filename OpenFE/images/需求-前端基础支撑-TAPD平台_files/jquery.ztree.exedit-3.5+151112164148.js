!function(e){var t={event:{DRAG:"ztree_drag",DROP:"ztree_drop",REMOVE:"ztree_remove",RENAME:"ztree_rename"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},o={edit:{enable:!1,editNameSelectAll:!1,showRemoveBtn:!0,showRenameBtn:!0,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:!1,isCopy:!0,isMove:!0,prev:!0,next:!0,inner:!0,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDrop:null,onRename:null}},d=function(e){var t=I.getRoot(e);t.curEditNode=null,t.curEditInput=null,t.curHoverNode=null,t.dragFlag=0,t.dragNodeShowBefore=[],t.dragMaskList=new Array,t.showHoverDom=!0},r=function(e){},n=function(e){var t=e.treeObj,o=f.event;t.bind(o.RENAME,function(t,o,d){T.apply(e.callback.onRename,[t,o,d])}),t.bind(o.REMOVE,function(t,o,d){T.apply(e.callback.onRemove,[t,o,d])}),t.bind(o.DRAG,function(t,o,d,r){T.apply(e.callback.onDrag,[o,d,r])}),t.bind(o.DROP,function(t,o,d,r,n,a,i){T.apply(e.callback.onDrop,[o,d,r,n,a,i])})},a=function(e){var t=e.treeObj,o=f.event;t.unbind(o.RENAME),t.unbind(o.REMOVE),t.unbind(o.DRAG),t.unbind(o.DROP)},i=function(e){var t=e.target,o=I.getSetting(e.data.treeId),d=e.relatedTarget,r="",n=null,a="",i="",l=null,s=null,u=null;if(T.eqs(e.type,"mouseover")?(u=T.getMDom(o,t,[{tagName:"a",attrName:"treeNode"+f.id.A}]),u&&(r=T.getParentNodeId(u),a="hoverOverNode")):T.eqs(e.type,"mouseout")?(u=T.getMDom(o,d,[{tagName:"a",attrName:"treeNode"+f.id.A}]),u||(r="remove",a="hoverOutNode")):T.eqs(e.type,"mousedown")&&(u=T.getMDom(o,t,[{tagName:"a",attrName:"treeNode"+f.id.A}]),u&&(r=T.getParentNodeId(u),a="mousedownNode")),r.length>0)switch(n=I.getNodeCache(o,r),a){case"mousedownNode":l=N.onMousedownNode;break;case"hoverOverNode":l=N.onHoverOverNode;break;case"hoverOutNode":l=N.onHoverOutNode}var c={stop:!1,node:n,nodeEventType:a,nodeEventCallback:l,treeEventType:i,treeEventCallback:s};return c},l=function(e,t,o,d,r,n,a){o&&(o.isHover=!1,o.editNameFlag=!1)},s=function(t,o){o.cancelEditName=function(e){var o=I.getRoot(t),d=t.data.key.name,r=o.curEditNode;o.curEditNode&&E.cancelCurEditNode(t,e?e:r[d])},o.copyNode=function(e,o,d,r){function n(){E.addNodes(t,e,[a],r)}if(!o)return null;if(e&&!e.isParent&&t.data.keep.leaf&&d===f.move.TYPE_INNER)return null;var a=T.clone(o);return e||(e=null,d=f.move.TYPE_INNER),d==f.move.TYPE_INNER?T.canAsync(t,e)?E.asyncNode(t,e,r,n):n():(E.addNodes(t,e.parentNode,[a],r),E.moveNode(t,e,a,d,!1,r)),a},o.editName=function(e){e&&e.tId&&e===I.getNodeCache(t,e.tId)&&(e.parentTId&&E.expandCollapseParentNode(t,e.getParentNode(),!0),E.editNode(t,e))},o.moveNode=function(o,d,r,n){function a(){E.moveNode(t,o,d,r,!1,n)}return d?o&&!o.isParent&&t.data.keep.leaf&&r===f.move.TYPE_INNER?null:o&&(d.parentTId==o.tId&&r==f.move.TYPE_INNER||e("#"+d.tId).find("#"+o.tId).length>0)?null:(o||(o=null),T.canAsync(t,o)?E.asyncNode(t,o,n,a):a(),d):d},o.setEditable=function(e){return t.edit.enable=e,this.refresh()}},u={setSonNodeLevel:function(e,t,o){if(o){var d=e.data.key.children;if(o.level=t?t.level+1:0,o[d])for(var r=0,n=o[d].length;n>r;r++)o[d][r]&&I.setSonNodeLevel(e,o,o[d][r])}}},c={},N={onHoverOverNode:function(e,t){var o=I.getSetting(e.data.treeId),d=I.getRoot(o);d.curHoverNode!=t&&N.onHoverOutNode(e),d.curHoverNode=t,E.addHoverDom(o,t)},onHoverOutNode:function(e,t){var o=I.getSetting(e.data.treeId),d=I.getRoot(o);d.curHoverNode&&!I.isSelectedNode(o,d.curHoverNode)&&(E.removeTreeDom(o,d.curHoverNode),d.curHoverNode=null)},onMousedownNode:function(o,d){function r(o){if(0==u.dragFlag&&Math.abs(O-o.clientX)<s.edit.drag.minMoveSize&&Math.abs(D-o.clientY)<s.edit.drag.minMoveSize)return!0;var d,r,a,i,l,c=s.data.key.children;if(T.noSel(s),e("body").css("cursor","pointer"),0==u.dragFlag){if(0==T.apply(s.callback.beforeDrag,[s.treeId,v],!0))return n(o),!0;for(d=0,r=v.length;r>d;d++)0==d&&(u.dragNodeShowBefore=[]),a=v[d],a.isParent&&a.open?(E.expandCollapseNode(s,a,!a.open),u.dragNodeShowBefore[a.tId]=!0):u.dragNodeShowBefore[a.tId]=!1;u.dragFlag=1,u.showHoverDom=!1,T.showIfameMask(s,!0);var N=!0,S=-1;if(v.length>1){var A=v[0].parentTId?v[0].getParentNode()[c]:I.getNodes(s);for(l=[],d=0,r=A.length;r>d;d++)if(void 0!==u.dragNodeShowBefore[A[d].tId]&&(N&&S>-1&&S+1!==d&&(N=!1),l.push(A[d]),S=d),v.length===l.length){v=l;break}}for(N&&(b=v[0].getPreNode(),h=v[v.length-1].getNextNode()),g=e("<ul class='zTreeDragUL'></ul>"),d=0,r=v.length;r>d;d++)if(a=v[d],a.editNameFlag=!1,E.selectNode(s,a,d>0),E.removeTreeDom(s,a),i=e("<li id='"+a.tId+"_tmp'></li>"),i.append(e("#"+a.tId+f.id.A).clone()),i.css("padding","0"),i.children("#"+a.tId+f.id.A).removeClass(f.node.CURSELECTED),g.append(i),d==s.edit.drag.maxShowNodeNum-1){i=e("<li id='"+a.tId+"_moretmp'><a>  ...  </a></li>"),g.append(i);break}g.attr("id",v[0].tId+f.id.UL+"_tmp"),g.addClass(s.treeObj.attr("class")),g.appendTo("body"),p=e("<span class='tmpzTreeMove_arrow'></span>"),p.attr("id","zTreeMove_arrow_tmp"),p.appendTo("body"),s.treeObj.trigger(f.event.DRAG,[o,s.treeId,v])}if(1==u.dragFlag){if(m&&p.attr("id")==o.target.id&&C&&o.clientX+R.scrollLeft()+2>e("#"+C+f.id.A,m).offset().left){var Y=e("#"+C+f.id.A,m);o.target=Y.length>0?Y.get(0):o.target}else m&&(m.removeClass(f.node.TMPTARGET_TREE),C&&e("#"+C+f.id.A,m).removeClass(f.node.TMPTARGET_NODE+"_"+f.move.TYPE_PREV).removeClass(f.node.TMPTARGET_NODE+"_"+t.move.TYPE_NEXT).removeClass(f.node.TMPTARGET_NODE+"_"+t.move.TYPE_INNER));m=null,C=null,P=!1,w=s;var L=I.getSettings();for(var j in L)L[j].treeId&&L[j].edit.enable&&L[j].treeId!=s.treeId&&(o.target.id==L[j].treeId||e(o.target).parents("#"+L[j].treeId).length>0)&&(P=!0,w=L[j]);var x=R.scrollTop(),z=R.scrollLeft(),H=w.treeObj.offset(),B=w.treeObj.get(0).scrollHeight,F=w.treeObj.get(0).scrollWidth,U=o.clientY+x-H.top,V=w.treeObj.height()+H.top-o.clientY-x,G=o.clientX+z-H.left,X=w.treeObj.width()+H.left-o.clientX-z,q=U<s.edit.drag.borderMax&&U>s.edit.drag.borderMin,W=V<s.edit.drag.borderMax&&V>s.edit.drag.borderMin,K=G<s.edit.drag.borderMax&&G>s.edit.drag.borderMin,Q=X<s.edit.drag.borderMax&&X>s.edit.drag.borderMin,Z=U>s.edit.drag.borderMin&&V>s.edit.drag.borderMin&&G>s.edit.drag.borderMin&&X>s.edit.drag.borderMin,J=q&&w.treeObj.scrollTop()<=0,$=W&&w.treeObj.scrollTop()+w.treeObj.height()+10>=B,ee=K&&w.treeObj.scrollLeft()<=0,te=Q&&w.treeObj.scrollLeft()+w.treeObj.width()+10>=F;if(o.target.id&&w.treeObj.find("#"+o.target.id).length>0){for(var oe=o.target;oe&&oe.tagName&&!T.eqs(oe.tagName,"li")&&oe.id!=w.treeId;)oe=oe.parentNode;var de=!0;for(d=0,r=v.length;r>d;d++){if(a=v[d],oe.id===a.tId){de=!1;break}if(e("#"+a.tId).find("#"+oe.id).length>0){de=!1;break}}de&&o.target.id&&(o.target.id==oe.id+f.id.A||e(o.target).parents("#"+oe.id+f.id.A).length>0)&&(m=e(oe),C=oe.id)}a=v[0],Z&&(o.target.id==w.treeId||e(o.target).parents("#"+w.treeId).length>0)&&(!m&&(o.target.id==w.treeId||J||$||ee||te)&&(P||!P&&a.parentTId)&&(m=w.treeObj),q?w.treeObj.scrollTop(w.treeObj.scrollTop()-10):W&&w.treeObj.scrollTop(w.treeObj.scrollTop()+10),K?w.treeObj.scrollLeft(w.treeObj.scrollLeft()-10):Q&&w.treeObj.scrollLeft(w.treeObj.scrollLeft()+10),m&&m!=w.treeObj&&m.offset().left<w.treeObj.offset().left&&w.treeObj.scrollLeft(w.treeObj.scrollLeft()+m.offset().left-w.treeObj.offset().left)),g.css({top:o.clientY+x+3+"px",left:o.clientX+z+3+"px"});var re=0,ne=0;if(m&&m.attr("id")!=w.treeId){var ae=null==C?null:I.getNodeCache(w,C),ie=o.ctrlKey&&s.edit.drag.isMove&&s.edit.drag.isCopy||!s.edit.drag.isMove&&s.edit.drag.isCopy,le=!(!b||C!==b.tId),se=!(!h||C!==h.tId),ue=a.parentTId&&a.parentTId==C,ce=(ie||!se)&&T.apply(w.edit.drag.prev,[w.treeId,v,ae],!!w.edit.drag.prev),Ne=(ie||!le)&&T.apply(w.edit.drag.next,[w.treeId,v,ae],!!w.edit.drag.next),ve=(ie||!ue)&&!(w.data.keep.leaf&&!ae.isParent)&&T.apply(w.edit.drag.inner,[w.treeId,v,ae],!!w.edit.drag.inner);if(ce||Ne||ve){var ge=e("#"+C+f.id.A,m),pe=ae.isLastNode?null:e("#"+ae.getNextNode().tId+f.id.A,m.next()),me=ge.offset().top,Te=ge.offset().left,fe=ce?ve?.25:Ne?.5:1:-1,Ee=Ne?ve?.75:ce?.5:0:-1,Ie=(o.clientY+x-me)/ge.height();if((1==fe||fe>=Ie&&Ie>=-.2)&&ce?(re=1-p.width(),ne=me-p.height()/2,y=f.move.TYPE_PREV):(0==Ee||Ie>=Ee&&1.2>=Ie)&&Ne?(re=1-p.width(),ne=null==pe||ae.isParent&&ae.open?me+ge.height()-p.height()/2:pe.offset().top-p.height()/2,y=f.move.TYPE_NEXT):(re=5-p.width(),ne=me,y=f.move.TYPE_INNER),p.css({display:"block",top:ne+"px",left:Te+re+"px"}),ge.addClass(f.node.TMPTARGET_NODE+"_"+y),(M!=C||_!=y)&&(k=(new Date).getTime()),ae&&ae.isParent&&y==f.move.TYPE_INNER){var be=!0;window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==ae.tId?(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null):window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===ae.tId&&(be=!1),be&&(window.zTreeMoveTimer=setTimeout(function(){y==f.move.TYPE_INNER&&ae&&ae.isParent&&!ae.open&&(new Date).getTime()-k>w.edit.drag.autoOpenTime&&T.apply(w.callback.beforeDragOpen,[w.treeId,ae],!0)&&(E.switchNode(w,ae),w.edit.drag.autoExpandTrigger&&w.treeObj.trigger(f.event.EXPAND,[w.treeId,ae]))},w.edit.drag.autoOpenTime+50),window.zTreeMoveTargetNodeTId=ae.tId)}}else m=null,C="",y=f.move.TYPE_INNER,p.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null)}else y=f.move.TYPE_INNER,m&&T.apply(w.edit.drag.inner,[w.treeId,v,null],!!w.edit.drag.inner)?m.addClass(f.node.TMPTARGET_TREE):m=null,p.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null);M=C,_=y}return!1}function n(o){function d(){if(P){if(!N)for(var t=0,o=v.length;o>t;t++)E.removeNode(s,v[t]);if(y==f.move.TYPE_INNER)E.addNodes(w,b,h);else if(E.addNodes(w,b.getParentNode(),h),y==f.move.TYPE_PREV)for(t=0,o=h.length;o>t;t++)E.moveNode(w,b,h[t],y,!1);else for(t=-1,o=h.length-1;o>t;o--)E.moveNode(w,b,h[o],y,!1)}else if(N&&y==f.move.TYPE_INNER)E.addNodes(w,b,h);else if(N&&E.addNodes(w,b.getParentNode(),h),y!=f.move.TYPE_NEXT)for(t=0,o=h.length;o>t;t++)E.moveNode(w,b,h[t],y,!1);else for(t=-1,o=h.length-1;o>t;o--)E.moveNode(w,b,h[o],y,!1);for(t=0,o=h.length;o>t;t++)E.selectNode(w,h[t],t>0);e("#"+h[0].tId).focus().blur()}if(window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null),M=null,_=null,R.unbind("mousemove",r),R.unbind("mouseup",n),R.unbind("selectstart",a),e("body").css("cursor","auto"),m&&(m.removeClass(f.node.TMPTARGET_TREE),C&&e("#"+C+f.id.A,m).removeClass(f.node.TMPTARGET_NODE+"_"+f.move.TYPE_PREV).removeClass(f.node.TMPTARGET_NODE+"_"+t.move.TYPE_NEXT).removeClass(f.node.TMPTARGET_NODE+"_"+t.move.TYPE_INNER)),T.showIfameMask(s,!1),u.showHoverDom=!0,0!=u.dragFlag){u.dragFlag=0;var i,l,c;for(i=0,l=v.length;l>i;i++)c=v[i],c.isParent&&u.dragNodeShowBefore[c.tId]&&!c.open&&(E.expandCollapseNode(s,c,!c.open),delete u.dragNodeShowBefore[c.tId]);g&&g.remove(),p&&p.remove();var N=o.ctrlKey&&s.edit.drag.isMove&&s.edit.drag.isCopy||!s.edit.drag.isMove&&s.edit.drag.isCopy;if(!N&&m&&C&&v[0].parentTId&&C==v[0].parentTId&&y==f.move.TYPE_INNER&&(m=null),m){var b=null==C?null:I.getNodeCache(w,C);if(0==T.apply(s.callback.beforeDrop,[w.treeId,v,b,y,N],!0))return;var h=N?T.clone(v):v;y==f.move.TYPE_INNER&&T.canAsync(w,b)?E.asyncNode(w,b,!1,d):d(),s.treeObj.trigger(f.event.DROP,[o,w.treeId,h,b,y,N])}else{for(i=0,l=v.length;l>i;i++)E.selectNode(w,v[i],i>0);s.treeObj.trigger(f.event.DROP,[o,s.treeId,v,null,null,null])}}}function a(){return!1}var i,l,s=I.getSetting(o.data.treeId),u=I.getRoot(s);if(2==o.button||!s.edit||!s.edit.enable||!s.edit.drag.isCopy&&!s.edit.drag.isMove)return!0;var c=o.target,N=I.getRoot(s).curSelectedList,v=[];if(I.isSelectedNode(s,d))for(i=0,l=N.length;l>i;i++){if(N[i].editNameFlag&&T.eqs(c.tagName,"input")&&null!==c.getAttribute("treeNode"+f.id.INPUT))return!0;if(v.push(N[i]),v[0].parentTId!==N[i].parentTId){v=[d];break}}else v=[d];E.editNodeBlur=!0,E.cancelCurEditNode(s,null,!0);var g,p,m,b,h,R=e(document),P=!1,w=s,M=null,_=null,C=null,y=f.move.TYPE_INNER,O=o.clientX,D=o.clientY,k=(new Date).getTime();return T.uCanDo(s)&&R.bind("mousemove",r),R.bind("mouseup",n),R.bind("selectstart",a),o.preventDefault&&o.preventDefault(),!0}},v={getAbs:function(e){var t=e.getBoundingClientRect();return[t.left,t.top]},inputFocus:function(e){e.get(0)&&(e.focus(),T.setCursorPosition(e.get(0),e.val().length))},inputSelect:function(e){e.get(0)&&(e.focus(),e.select())},setCursorPosition:function(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var o=e.createTextRange();o.collapse(!0),o.moveEnd("character",t),o.moveStart("character",t),o.select()}},showIfameMask:function(t,o){for(var d=I.getRoot(t);d.dragMaskList.length>0;)d.dragMaskList[0].remove(),d.dragMaskList.shift();if(o)for(var r=e("iframe"),n=0,a=r.length;a>n;n++){var i=r.get(n),l=T.getAbs(i),s=e("<div id='zTreeMask_"+n+"' class='zTreeMask' style='top:"+l[1]+"px; left:"+l[0]+"px; width:"+i.offsetWidth+"px; height:"+i.offsetHeight+"px;'></div>");s.appendTo("body"),d.dragMaskList.push(s)}},getParentNodeId:function(e){return e.parentNode.id?e.parentNode.id:e.parentNode.parentNode.id}},g={addEditBtn:function(t,o){if(!(o.editNameFlag||e("#"+o.tId+f.id.EDIT).length>0)&&T.apply(t.edit.showRenameBtn,[t.treeId,o],t.edit.showRenameBtn)){var d=e("#"+o.tId+f.id.A),r="<span class='button edit' id='"+o.tId+f.id.EDIT+"' title='"+T.apply(t.edit.renameTitle,[t.treeId,o],t.edit.renameTitle)+"' treeNode"+f.id.EDIT+" style='display:none;'></span>";d.append(r),e("#"+o.tId+f.id.EDIT).bind("click",function(){return T.uCanDo(t)&&0!=T.apply(t.callback.beforeEditName,[t.treeId,o],!0)?(E.editNode(t,o),!1):!1}).show()}},addRemoveBtn:function(t,o){if(!(o.editNameFlag||e("#"+o.tId+f.id.REMOVE).length>0)&&T.apply(t.edit.showRemoveBtn,[t.treeId,o],t.edit.showRemoveBtn)){var d=e("#"+o.tId+f.id.A),r="<span class='button remove' id='"+o.tId+f.id.REMOVE+"' title='"+T.apply(t.edit.removeTitle,[t.treeId,o],t.edit.removeTitle)+"' treeNode"+f.id.REMOVE+" style='display:none;'></span>";d.append(r),e("#"+o.tId+f.id.REMOVE).bind("click",function(){return T.uCanDo(t)&&0!=T.apply(t.callback.beforeRemove,[t.treeId,o],!0)?(E.removeNode(t,o),t.treeObj.trigger(f.event.REMOVE,[t.treeId,o]),!1):!1}).bind("mousedown",function(e){return!0}).show()}},addHoverDom:function(e,t){I.getRoot(e).showHoverDom&&(t.isHover=!0,e.edit.enable&&(E.addEditBtn(e,t),E.addRemoveBtn(e,t)),T.apply(e.view.addHoverDom,[e.treeId,t]))},cancelCurEditNode:function(t,o){var d=I.getRoot(t),r=t.data.key.name,n=d.curEditNode;if(n){var a=d.curEditInput,i=o?o:a.val();if(!o&&T.apply(t.callback.beforeRename,[t.treeId,n,i],!0)===!1)return n.editNameFlag=!0,!1;n[r]=i?i:a.val(),o||t.treeObj.trigger(f.event.RENAME,[t.treeId,n]);var l=e("#"+n.tId+f.id.A);l.removeClass(f.node.CURSELECTED_EDIT),a.unbind(),E.setNodeName(t,n),n.editNameFlag=!1,d.curEditNode=null,d.curEditInput=null,E.selectNode(t,n,!1)}return d.noSelection=!0,!0},editNode:function(t,o){var d=I.getRoot(t);if(E.editNodeBlur=!1,I.isSelectedNode(t,o)&&d.curEditNode==o&&o.editNameFlag)return void setTimeout(function(){T.inputFocus(d.curEditInput)},0);var r=t.data.key.name;o.editNameFlag=!0,E.removeTreeDom(t,o),E.cancelCurEditNode(t),E.selectNode(t,o,!1),e("#"+o.tId+f.id.SPAN).html("<input type=text class='rename' id='"+o.tId+f.id.INPUT+"' treeNode"+f.id.INPUT+" >");var n=e("#"+o.tId+f.id.INPUT);n.attr("value",o[r]),t.edit.editNameSelectAll?T.inputSelect(n):T.inputFocus(n),n.bind("blur",function(e){E.editNodeBlur||E.cancelCurEditNode(t)}).bind("keydown",function(e){"13"==e.keyCode?(E.editNodeBlur=!0,E.cancelCurEditNode(t,null,!0)):"27"==e.keyCode&&E.cancelCurEditNode(t,o[r])}).bind("click",function(e){return!1}).bind("dblclick",function(e){return!1}),e("#"+o.tId+f.id.A).addClass(f.node.CURSELECTED_EDIT),d.curEditInput=n,d.noSelection=!1,d.curEditNode=o},moveNode:function(t,o,d,r,n,a){var i=I.getRoot(t),l=t.data.key.children;if(o!=d&&(!t.data.keep.leaf||!o||o.isParent||r!=f.move.TYPE_INNER)){var s=d.parentTId?d.getParentNode():i,u=null===o||o==i;u&&null===o&&(o=i),u&&(r=f.move.TYPE_INNER);var c=o.parentTId?o.getParentNode():i;r!=f.move.TYPE_PREV&&r!=f.move.TYPE_NEXT&&(r=f.move.TYPE_INNER),r==f.move.TYPE_INNER&&(u?d.parentTId=null:(o.isParent||(o.isParent=!0,o.open=!!o.open,E.setNodeLineIcos(t,o)),d.parentTId=o.tId));var N,v;if(u)N=t.treeObj,v=N;else{if(a||r!=f.move.TYPE_INNER?a||E.expandCollapseNode(t,o.getParentNode(),!0,!1):E.expandCollapseNode(t,o,!0,!1),N=e("#"+o.tId),v=e("#"+o.tId+f.id.UL),N.get(0)&&!v.get(0)){var g=[];E.makeUlHtml(t,o,g,""),N.append(g.join(""))}v=e("#"+o.tId+f.id.UL)}var p=e("#"+d.tId);p.get(0)?N.get(0)||p.remove():p=E.appendNodes(t,d.level,[d],null,!1,!0).join(""),v.get(0)&&r==f.move.TYPE_INNER?v.append(p):N.get(0)&&r==f.move.TYPE_PREV?N.before(p):N.get(0)&&r==f.move.TYPE_NEXT&&N.after(p);var m,T,b=-1,h=0,R=null,P=null,w=d.level;if(d.isFirstNode)b=0,s[l].length>1&&(R=s[l][1],R.isFirstNode=!0);else if(d.isLastNode)b=s[l].length-1,R=s[l][b-1],R.isLastNode=!0;else for(m=0,T=s[l].length;T>m;m++)if(s[l][m].tId==d.tId){b=m;break}if(b>=0&&s[l].splice(b,1),r!=f.move.TYPE_INNER)for(m=0,T=c[l].length;T>m;m++)c[l][m].tId==o.tId&&(h=m);if(r==f.move.TYPE_INNER?(o[l]||(o[l]=new Array),o[l].length>0&&(P=o[l][o[l].length-1],P.isLastNode=!1),o[l].splice(o[l].length,0,d),d.isLastNode=!0,d.isFirstNode=1==o[l].length):o.isFirstNode&&r==f.move.TYPE_PREV?(c[l].splice(h,0,d),P=o,P.isFirstNode=!1,d.parentTId=o.parentTId,d.isFirstNode=!0,d.isLastNode=!1):o.isLastNode&&r==f.move.TYPE_NEXT?(c[l].splice(h+1,0,d),P=o,P.isLastNode=!1,d.parentTId=o.parentTId,d.isFirstNode=!1,d.isLastNode=!0):(r==f.move.TYPE_PREV?c[l].splice(h,0,d):c[l].splice(h+1,0,d),d.parentTId=o.parentTId,d.isFirstNode=!1,d.isLastNode=!1),I.fixPIdKeyValue(t,d),I.setSonNodeLevel(t,d.getParentNode(),d),E.setNodeLineIcos(t,d),E.repairNodeLevelClass(t,d,w),!t.data.keep.parent&&s[l].length<1){s.isParent=!1,s.open=!1;var M=e("#"+s.tId+f.id.UL),_=e("#"+s.tId+f.id.SWITCH),C=e("#"+s.tId+f.id.ICON);E.replaceSwitchClass(s,_,f.folder.DOCU),E.replaceIcoClass(s,C,f.folder.DOCU),M.css("display","none")}else R&&E.setNodeLineIcos(t,R);P&&E.setNodeLineIcos(t,P),t.check&&t.check.enable&&E.repairChkClass&&(E.repairChkClass(t,s),E.repairParentChkClassWithSelf(t,s),s!=d.parent&&E.repairParentChkClassWithSelf(t,d)),a||E.expandCollapseParentNode(t,d.getParentNode(),!0,n)}},removeEditBtn:function(t){e("#"+t.tId+f.id.EDIT).unbind().remove()},removeRemoveBtn:function(t){e("#"+t.tId+f.id.REMOVE).unbind().remove()},removeTreeDom:function(e,t){t.isHover=!1,E.removeEditBtn(t),E.removeRemoveBtn(t),T.apply(e.view.removeHoverDom,[e.treeId,t])},repairNodeLevelClass:function(t,o,d){if(d!==o.level){var r=e("#"+o.tId),n=e("#"+o.tId+f.id.A),a=e("#"+o.tId+f.id.UL),i="level"+d,l="level"+o.level;r.removeClass(i),r.addClass(l),n.removeClass(i),n.addClass(l),a.removeClass(i),a.addClass(l)}}},p={tools:v,view:g,event:c,data:u};e.extend(!0,e.fn.zTree.consts,t),e.extend(!0,e.fn.zTree._z,p);var m=e.fn.zTree,T=m._z.tools,f=m.consts,E=m._z.view,I=m._z.data;m._z.event;I.exSetting(o),I.addInitBind(n),I.addInitUnBind(a),I.addInitCache(r),I.addInitNode(l),I.addInitProxy(i),I.addInitRoot(d),I.addZTreeTools(s);var b=E.cancelPreSelectedNode;E.cancelPreSelectedNode=function(e,t){for(var o=I.getRoot(e).curSelectedList,d=0,r=o.length;r>d&&(t&&t!==o[d]||(E.removeTreeDom(e,o[d]),!t));d++);b&&b.apply(E,arguments)};var h=E.createNodes;E.createNodes=function(e,t,o,d){h&&h.apply(E,arguments),o&&E.repairParentChkClassWithSelf&&E.repairParentChkClassWithSelf(e,d)},E.makeNodeUrl=function(e,t){return t.url&&!e.edit.enable?t.url:null};var R=E.removeNode;E.removeNode=function(e,t){var o=I.getRoot(e);o.curEditNode===t&&(o.curEditNode=null),R&&R.apply(E,arguments)};var P=E.selectNode;E.selectNode=function(e,t,o){var d=I.getRoot(e);return I.isSelectedNode(e,t)&&d.curEditNode==t&&t.editNameFlag?!1:(P&&P.apply(E,arguments),E.addHoverDom(e,t),!0)};var w=T.uCanDo;T.uCanDo=function(e,t){var o=I.getRoot(e);return t&&(T.eqs(t.type,"mouseover")||T.eqs(t.type,"mouseout")||T.eqs(t.type,"mousedown")||T.eqs(t.type,"mouseup"))?!0:!o.curEditNode&&(w?w.apply(E,arguments):!0)}}(jQuery);