function fill_stoies_count(e,t){null!=ajax_get_story_count_xhr&&ajax_get_story_count_xhr.abort();var r=parseQuery(t),s="category_id"in r?r.category_id:0;!function(e){ajax_get_story_count_xhr=$.ajax({type:"POST",url:t,data:$("#query_condition"),cache:!1,success:function(t){judge_export_list(t),change_category_count(t,e)}})}(s)}function change_category_count(e,t){var t=t||$.cookie("selected_category_id");if(t=t?t:0,"boolean"==typeof enableHebe&&enableHebe){var r=$("#category_tree_for_view").find("a[obj_id="+t+"]");null!==t&&e>0&&(r.siblings(".category_count").length>0?r.siblings(".category_count").html(e):r.after($("<span class='secondary category_count'> "+e+"</span>")))}else{var r=$("#category_tree_for_view").find("a[obj_id="+t+"]");null!==t&&e>0&&(r.siblings(".category_count").length>0?r.siblings(".category_count").html("["+e+"]"):r.after($("<span class='secondary category_count'> ["+e+"]</span>")))}}function judge_export_list(e){$(".query_results_count").show(),$("#query_results_count").length>0&&$("#query_results_count").text(e.trim()),$("#all_stories_count").html(e.trim()),$("#all_stories_count").parent().css("display",""),parseInt(e)>0&&($("#export_p_stories_list").css("display",""),$("#disabled_export_p_stories_list").css("display","none"))}function drop_menu_delete_action(e,t,r){has_current_page_url?($("#operation_"+e).hide(),$("#story_list_content tr.modified_item_tr").each(function(){$(this).removeClass("modified_item_tr")}),$("#story_list_content tr[story_id='"+e+"'] ").addClass("modified_item_tr"),confirm(t)&&onGoTo(r+"&ref="+current_page_url)):($("#operation_"+e).hide(),confirm(t)&&onGoTo(r))}function drop_menu_timesheet_action(e,t,r,s,o){temp_entity_id_for_callback_function=e,$("#operation_"+e).hide(),$("#story_list_content tr.modified_item_tr").each(function(){$(this).removeClass("modified_item_tr")}),$("#story_list_content tr[story_id='"+e+"'] ").addClass("modified_item_tr"),tapd_tb_show(t,r,s,o,!1)}function storieslistTimesheetResponse(e){e=temp_entity_id_for_callback_function,tapd_tb_remove();var t={effort_completed:$("#story_list_content tr[story_id='"+e+"'] td[id='effort_completed']"),remain:$("#story_list_content tr[story_id='"+e+"'] td[id='remain']"),exceed:$("#story_list_content tr[story_id='"+e+"'] td[id='exceed']"),progress:$("#story_list_content tr[story_id='"+e+"'] td[id='progress']")};$.post(get_story_effort_info_url,{entry_id:e},function(e){if(1==e.status)for(effort_obj in t)t[effort_obj].length>0&&("progress"==effort_obj?refresh_process_div_obj(t[effort_obj],e.data[effort_obj]):t[effort_obj].html(e.data[effort_obj]))},"json"),temp_entity_id_for_callback_function=""}function refresh_process_div_obj(e,t){var r={green:0},s="g_hp_",o=$(e).children("div")[0],i="grey";for(color in r)r[color]<=t&&(i=color);o=$(o).children("div")[0],$(o).removeClass().addClass(s+i),$(e).find(".bar_bg").css({width:t+"%"}),$(e).find(".bar_font").html(t+"%")}function storieslistResponse(responseText,story_id,story_status){responseText=eval("("+responseText+")"),a_status_id="story_status_"+story_id;var arr='<i class="arr"></i>';$("#"+a_status_id).text(responseText.status_name).removeClass("workflow-status-end workflow-status-begin workflow-status-in-progress"),responseText.is_done_status?$("#"+a_status_id).addClass("workflow-status-end"):responseText.is_first_status?$("#"+a_status_id).addClass("workflow-status-begin"):$("#"+a_status_id).addClass("workflow-status-in-progress"),"undefined"==typeof enableHebe||enableHebe||$("#"+a_status_id).append(arr);var menu_url="",$current_tr=$("#story_list_content tr[story_id='"+story_id+"']"),$owner_row=$current_tr.find("td.owner");if($owner_row.size()&&void 0!=responseText.owner){var current_owner=responseText.owner;current_owner.indexOf(";")==current_owner.length-1&&(current_owner=current_owner.substring(0,current_owner.length-1)),$owner_row.removeAttr("data-avatar-editableinit"),$owner_row.data("avatar-value",current_owner).data("avatar-users",current_owner),$owner_row.attr("data-avatar-value",current_owner).attr("data-avatar-users",current_owner).find(".editable-value").attr("title",current_owner).html(current_owner),TFL.avatarList&&TFL.avatarList.init($owner_row)}if(setTimeout(function(){$current_table=$current_tr.closest("table"),$current_table_th=$current_table.find("thead tr"),$.each($current_tr.find("td"),function(e,t){$(t).trigger("mouseenter"),$(t).trigger("hover"),$(t).trigger("mouseout")});for(var e in responseText)if($current_index=$current_table_th.find("[field-name="+e+"]").index(),$current_index>-1&&"owner"!=e&&"status_name"!=e&&"status"!=e){var t="",r="";if("object"!=$.type(responseText[e]))switch($.type(responseText[e])){case"array":responseText[e]=$.grep(responseText[e],function(e,t){return!(""==e||"undefined"==typeof e||null==e)}),t=r=responseText[e].join("|");break;case"string":default:t=r=responseText[e]}else t=responseText[e].name,r=responseText[e].value;if($inline_element=$current_tr.find("td").eq($current_index),$inline_element.attr("title",t),$inline_element.attr("data-editable-value",r),$inline_inner_element=$inline_element.children(":not(.edit-control-ico)"),/^effort/.test(e)){$editable_element=$inline_element.children(".edit-control-ico").clone(),$inline_element.html(""),$inline_element.append($editable_element),$inline_element.append(t);continue}$inline_inner_element?($inline_inner_element.html(t),$inline_inner_element.attr("title",t),$inline_inner_element.attr("data-editable-value",r),inline_call_back($inline_inner_element)):$inline_element.html($show_value),"priority"==e&&("High"!=responseText[e]?$inline_inner_element.removeClass("high_priority"):$inline_inner_element.addClass("high_priority"))}},100),!0===responseText.is_done_status||"true"==responseText.is_done_status)$current_tr.addClass("rowdone").removeClass("rowNOTdone"),$current_tr.find("a[class='tapd-btn-split']").removeClass().addClass("tapd-btn-split-disabled").removeAttr("href"),$current_tr.find("a[class='tapd-btn-add-timesheet tapdbox']").removeClass().addClass("tapd-btn-add-timesheet-disabled").removeAttr("href"),menu_url=init_story_operation_list_url+story_id,$current_tr.find("div.operation-wrapper").load(menu_url),responseText.callback_effort_completed&&$current_tr.find("td[id='effort_completed']").text(responseText.callback_effort_completed),responseText.callback_remain&&$current_tr.find("td[id='remain']").text(responseText.callback_remain),responseText.callback_progress&&($current_tr.find(".bar_bg").css("width",responseText.callback_progress+"%"),$current_tr.find(".bar_font").text(responseText.callback_progress+"%"));else{$current_tr.removeClass("rowdone").addClass("rowNOTdone"),split_story_url=$current_tr.find("a[class='tapd-btn-split-disabled']").attr("split_story_url"),$current_tr.find("a[class='tapd-btn-split-disabled']").removeClass().addClass("tapd-btn-split").attr("href",split_story_url);var timesheet_url=$current_tr.find("a[class='tapd-btn-add-timesheet-disabled']").attr("timesheet_url");$current_tr.find("a[class='tapd-btn-add-timesheet-disabled']").removeClass().addClass("tapd-btn-add-timesheet").addClass("tapdbox").attr("href",timesheet_url),menu_url=init_story_operation_list_url+story_id,$current_tr.find("div.operation-wrapper").load(menu_url)}$(".g_menu").hide(),cancelStatusDialog(),show_flash_message(msg_success)}function storieslistResponseHebe(responseText,statusText,story_id,story_status){responseText=eval("("+responseText+")"),a_status_id="story_status_"+story_id;var arr='<i class="arr"></i>';$("#"+a_status_id).text(responseText.status_name).removeClass("workflow-status-end workflow-status-begin workflow-status-in-progress"),responseText.is_done_status?$("#"+a_status_id).addClass("workflow-status-end"):responseText.is_first_status?$("#"+a_status_id).addClass("workflow-status-begin"):$("#"+a_status_id).addClass("workflow-status-in-progress"),"undefined"==typeof enableHebe||enableHebe||$("#"+a_status_id).append(arr);var menu_url="",$current_tr=$("#story_list_content tr[story_id='"+story_id+"']"),$owner_row=$current_tr.find("td.owner");if($owner_row.size()&&void 0!=responseText.owner){var current_owner=responseText.owner;current_owner.indexOf(";")==current_owner.length-1&&(current_owner=current_owner.substring(0,current_owner.length-1)),$owner_row.removeAttr("data-avatar-editableinit"),$owner_row.data("avatar-value",current_owner).data("avatar-users",current_owner),$owner_row.attr("data-avatar-value",current_owner).attr("data-avatar-users",current_owner).find(".editable-value").attr("title",current_owner).html(current_owner),TFL.avatarList&&TFL.avatarList.init($owner_row)}if(setTimeout(function(){$current_table=$current_tr.closest("table"),$current_table_th=$current_table.find("thead tr"),$.each($current_tr.find("td"),function(e,t){$(t).trigger("mouseenter"),$(t).trigger("hover"),$(t).trigger("mouseout")});for(var e in responseText)if($current_index=$current_table_th.find("[field-name="+e+"]").index(),$current_index>-1&&"owner"!=e&&"status_name"!=e&&"status"!=e){var t="",r="";if("object"!=$.type(responseText[e]))switch($.type(responseText[e])){case"array":responseText[e]=$.grep(responseText[e],function(e,t){return!(""==e||"undefined"==typeof e||null==e)}),t=r=responseText[e].join("|");break;case"string":default:t=r=responseText[e]}else t=responseText[e].name,r=responseText[e].value;if(t=htmlspecialchars_encode(t),$inline_element=$current_tr.find("td").eq($current_index),$inline_element.attr("title",t),$inline_element.attr("data-editable-value",r),$inline_inner_element=$inline_element.children(":not(.edit-control-ico)"),/^effort/.test(e)){$editable_element=$inline_element.children(".edit-control-ico").clone(),$inline_element.html(""),$inline_element.append($editable_element),$inline_element.append(t);continue}if($inline_inner_element?($inline_inner_element.html(t),$inline_inner_element.attr("title",t),$inline_inner_element.attr("data-editable-value",r),inline_call_back($inline_inner_element)):$inline_element.html($show_value),"priority"==e){$inline_inner_element.parent("td").attr("class",function(e,t){return t.replace(/priority-label.*?\s/g," ")});var s=responseText[e];$inline_inner_element.parent("td").addClass("priority-label-"+s.toLowerCase())}}},100),!0===responseText.is_done_status||"true"==responseText.is_done_status)$current_tr.addClass("rowdone").removeClass("rowNOTdone"),$current_tr.find("a[class='tapd-btn-split']").removeClass().addClass("tapd-btn-split-disabled").removeAttr("href"),$current_tr.find("a[class='tapd-btn-add-timesheet tapdbox']").removeClass().addClass("tapd-btn-add-timesheet-disabled").removeAttr("href"),menu_url=init_story_operation_list_url+story_id,$current_tr.find("div.operation-wrapper").load(menu_url),responseText.callback_effort_completed&&$current_tr.find("td[id='effort_completed']").text(responseText.callback_effort_completed),responseText.callback_remain&&$current_tr.find("td[id='remain']").text(responseText.callback_remain),responseText.callback_progress&&($current_tr.find(".bar_bg").css("width",responseText.callback_progress+"%"),$current_tr.find(".bar_font").text(responseText.callback_progress+"%"));else{$current_tr.removeClass("rowdone").addClass("rowNOTdone"),split_story_url=$current_tr.find("a[class='tapd-btn-split-disabled']").attr("split_story_url"),$current_tr.find("a[class='tapd-btn-split-disabled']").removeClass().addClass("tapd-btn-split").attr("href",split_story_url);var timesheet_url=$current_tr.find("a[class='tapd-btn-add-timesheet-disabled']").attr("timesheet_url");$current_tr.find("a[class='tapd-btn-add-timesheet-disabled']").removeClass().addClass("tapd-btn-add-timesheet").addClass("tapdbox").attr("href",timesheet_url),menu_url=init_story_operation_list_url+story_id,$current_tr.find("div.operation-wrapper").load(menu_url)}$(".g_menu").hide(),cancelStatusDialog(),show_flash_message(msg_success)}function fold_all(e){$("#story_list_content tbody tr").each(function(t){tr_id=$(this).attr("id"),len=tr_id.length,story_path=tr_id.substring(9,len),level=$(this).attr("level"),0==parseInt(level)&&("fold"==e||"font font-fold"==e?fold_one(tr_id,story_path,level):unfold_one(tr_id,story_path,level))}),0<$("#category_tree_for_view").length&&adjust_category_tree_scroll_bar()}function unfold_one(e,t,r){var s="undefined"!=typeof enableHebe&&enableHebe?"font font-unfold":"unfold";$('tr[id^="tr_story_'+t+'"][level!='+r+"]").css("display","none"),$('a[id^="a_story_'+t+'"]').attr("class",s)}function fold_one(e,t,r){var s="undefined"!=typeof enableHebe&&enableHebe?"font font-fold":"fold";$('tr[id*="tr_story_'+t+'"][level!='+r+"]").css("display",""),$('a[id^="a_story_'+t+'"]').attr("class",s)}function foldcol(e,t,r,s){var o="undefined"!=typeof enableHebe&&enableHebe?"font font-unfold":"unfold",i="undefined"!=typeof enableHebe&&enableHebe?"font font-fold":"fold";"unfold"==e.className||"font font-unfold"==e.className?($('tr[id*="tr_story_'+r+'"][level!='+s+"]").css("display",""),$('a[id^="a_story_'+r+'"]').attr("class",i)):(e.className=o,$('tr[id^="tr_story_'+r+'"][level!='+s+"]").css("display","none"))}function _is_selectd_legal(e){if($("#flash_message").hide(),1==$("#contain_sub_workspace").attr("checked"))return 1==e?$("#flash_message").html(select_stories_init_params.select_story_copy_message):0==e?$("#flash_message").html(select_stories_init_params.select_story_move_message):2==e?$("#flash_message").html(select_stories_init_params.select_story_batch_message):3==e&&$("#flash_message").html(select_stories_init_params.select_story_batch_parent_message),$("#flash_message").show(),!1;var t=$(".g_table#story_list_content input:checkbox:checked").length;if(0==t)return $("#flash_message").html(select_stories_init_params.select_story_alert_message),$("#flash_message").show(),!1;if(0==e||3==e||1==e){var r=50;if(0==e?r=select_stories_init_params.max_story_move_count:1==e&&(r=select_stories_init_params.max_story_copy_count),1==$("#check_all").attr("checked")&&r++,t>r){if(0==e)var s=select_stories_init_params.select_too_much_story_move_message;else if(1==e)var s=select_stories_init_params.select_too_much_story_copy_message;else var s=select_stories_init_params.select_too_much_story_edit_parent_message;return TFL.tips.showFlash(s,!0,3e3),!1}}return!0}function move_story(e){return _is_selectd_legal(0)?void check_secret_permission(get_selected_ids,show_move_story_dialog,select_stories_init_params.story_move_permission_message):!1}function copy_story(e){return _is_selectd_legal(1)?void check_secret_permission(get_selected_ids,show_copy_story_dialog,select_stories_init_params.story_copy_permission_message):!1}function copy_single_story(e){var t=$(e).closest("tr").attr("story_id");check_secret_permission(t,show_copy_story_dialog,select_stories_init_params.story_copy_permission_message,!0)}function batch_edit_parent(e){return _is_selectd_legal(3)?void check_secret_permission(get_selected_ids,show_batch_edit_parent_dialog):!1}function show_batch_edit_parent_dialog(){var e=select_stories_init_params.story_copy_move_base_url,t=select_stories_init_params.edit_parent_story_btns;""!=p_workspace_id?tapd_tb_show(select_stories_init_params.story_edit_parent,e+"/stories/choose_story/batch_"+get_selected_ids()+"/Story/storyId_0/"+p_workspace_id+"?keepThis=true&TB_iframe=true&height=565&width=820 ",!0,t):tapd_tb_show(select_stories_init_params.story_edit_parent,e+"/stories/choose_story/batch_"+get_selected_ids()+"/Story/storyId_0?keepThis=true&TB_iframe=true&height=565&width=820 ",!0,t)}function show_copy_story_dialog(e){var t=select_stories_init_params.story_copy_move_base_url,r=select_stories_init_params.copy_story_btns;enableHebe?tapd_tb_show(select_stories_init_params.story_copy,t+"/stories/copy_story/"+e+"?keepThis=true&TB_iframe=true&height=450&width=650",!0,r):tapd_tb_show(select_stories_init_params.story_copy,t+"/stories/copy_story/"+e+"?keepThis=true&TB_iframe=true&height=420&width=650",!0,r)}function show_move_story_dialog(){var e=select_stories_init_params.story_copy_move_base_url,t=select_stories_init_params.move_story_btns;enableHebe?tapd_tb_show(select_stories_init_params.story_move,e+"/stories/move_story_view_tree?keepThis=true&TB_iframe=true&height=600&width=650",!0,t):tapd_tb_show(select_stories_init_params.story_move,e+"/stories/move_story_view_tree?keepThis=true&TB_iframe=true&height=auto&width=650",!0,t)}function batch_edit(e){return _is_selectd_legal(2)?void bulk_edit(e):!1}function batch_change_status(){return _is_selectd_legal(2)?void check_secret_permission(get_selected_ids,submit_batch_change_status_form):!1}function selectStory(e){if(void 0==e.id);else{tapd_tb_remove(!1);var t=select_stories_init_params.story_copy_move_base_url,r=select_stories_init_params.batch_edit_stories_parent;""!=p_workspace_id?tapd_tb_show(select_stories_init_params.story_edit_parent_preview,t+"/stories/batch_edit_stories_parent/"+get_selected_ids()+"/"+e.id+"/"+p_workspace_id+"?keepThis=true&TB_iframe=true&height=565&width=820 ",!0,r):tapd_tb_show(select_stories_init_params.story_edit_parent_preview,t+"/stories/batch_edit_stories_parent/"+get_selected_ids()+"/"+e.id+"?keepThis=true&TB_iframe=true&height=565&width=820 ",!0,r)}}function selectStoryAndReturn(e){if(void 0==e.id);else{tapd_tb_remove(!1),TFL.use("mask",function(){TFL.mask.init("body")});var t=select_stories_init_params.story_copy_move_base_url,r=(select_stories_init_params.edit_parent_story_btns,"");r=""!=p_workspace_id?t+"/stories/ajax_batch_edit_stories_parent/"+get_selected_ids()+"/"+e.id+"/"+p_workspace_id+"?keepThis=true&TB_iframe=true&height=565&width=820":t+"/stories/ajax_batch_edit_stories_parent/"+get_selected_ids()+"/"+e.id+"?keepThis=true&TB_iframe=true&height=565&width=820",$.ajax({url:r,cache:!1,success:function(e){location.reload()}})}}function view_parent_story(e){var t=select_stories_init_params.story_copy_move_base_url;window.location.href=t+"/stories/view/"+e+"?tag_name=SubStories"}function refresh(){location.reload()}function check_all_selected(){var e=($("#menu_template").children(),$("#story_list_content").attr("list_type"));$(this).attr("checked")?$("td.story_list_action :checkbox:not('#check_all'):not('.no-permission')").each(function(){$(this).attr("checked",!0),""!=$(this).attr("level")&&"0"!=$(this).attr("level")&&"tree"==e&&$(this).attr("disabled",!0),$(".checked_all").attr("checked",!0)}):$("td.story_list_action :checkbox:not('#check_all'):not('.no-permission')").each(function(){$(this).attr("checked",!1),$(this).removeAttr("disabled"),$(".checked_all").attr("checked",!1)}),refresh_selected_items()}function refresh_selected_items(){var e=$("td.story_list_action :checkbox:not('#check_all'):checked");0==e.size()?$("#selected_stories_id").val(""):$("#selected_stories_id").val(get_selected_ids())}function get_selected_ids(){var e=$("td.story_list_action :checkbox:not('#check_all'):checked");if(0==e.size())return"";var t=[];return $.each(e,function(e,r){if(t.push($(r).val()),0==$(this).closest("td").next().find("[id^=batch_operation_menu_]").size()){$(this).closest("tr").addClass("checked-tr");var s=$("#action_button_menu_template").parent().parent().clone();s.attr("id","batch_operation_menu_"+$(r).val()),$(this).closest("td").next().append(s),s.show()}}),t.join(";")}function choose_target(e,t,r){var s=$("#selected_stories_id").val(),o=s,i=$("#story_list_content").attr("list_type");1==$(e).attr("checked")?(o=o+$(e).val()+";",$('input[type=checkbox][id^="check_'+t+'"]').each(function(t){if(select_id=$(this).val(),select_id!=$(e).val()&&"tree"==i){$(this).attr("checked",!0),$(this).attr("disabled","disabled");var r=s.indexOf(select_id);0>r&&(o=o+select_id+";")}TFL.listTable.checkItem($(this))})):$('input[type=checkbox][id^="check_'+t+'"]').each(function(e){$(this).attr("checked",!1),$(this).removeAttr("disabled"),select_id=$(this).val();var t=s.indexOf(select_id);0>t||(o=o.replace(select_id+";",""),o=o.replace(select_id,"")),TFL.listTable.checkItem($(this))}),$("#selected_stories_id").val(o)}function choosed_story(){var e=$("#selected_stories_id").val();return e}function count_stories_num(e){return stories_ids_array=e.split(";"),stories_ids_asrray.length-1}function reload_stories_list(){if($("#category_tree_for_view").size()){tapd_tb_remove(!0);var e=$("#category_tree_for_view").find(" .curSelectedNode"),t=$.Event("selectTreeNode");t.treeId="category_tree_for_view",t.categoryId=$(e).attr("obj_id"),$("#category_tree_for_view").trigger(t)}else tapd_tb_remove(!0)}function get_cookie_value_by_js(e){for(var t,r=document.cookie,s=r.split("; "),o=0;o<s.length;o++){var i=s[o].split("=");if(e==i[0])return t=i[1]}return""}function addcookie(e,t,r){var s=e+"="+escape(t);if(r>0){var o=new Date;o.setTime(o.getTime()+3600*r*1e3),s=s+";expires="+o.toGMTString()}document.cookie=s}function change_page_info_when_ajax(){var e=$(".table_action_wrap .simple-pager"),t=$(".table-action-top .simple-pager");e.length>0?t.html(e.html()):t.html("")}function reload_inline(){$("#story_list_content").removeAttr("editable-init"),TFL.editable.init(),console.log("done")}function listFollowStory(e){if($(e).hasClass("disabled"))return!1;var t=$(e).attr("data-href"),r=$(e).parent().attr("id").replace("-follow_story",""),s="follow";$(e).hasClass("j-list-operation__unfollow")&&(s="unfollow"),$.ajax({url:t,data:{"data[id]":r,"data[type]":s},type:"POST",dataType:"json",success:function(t){if("success"==t.result)if("follow"==s){$(e).attr("title","取消关注").text("取消关注"),$(e).removeClass("j-list-operation__follow").addClass("j-list-operation__unfollow");var r=_base+"my_worktable/to_followed_list/"+_workspace_id+"/story";TFL.tips.showFlash('关注成功，请在<a href="'+r+'" target="_blank">工作台中查看</a>')}else $(e).attr("title","关注").text("关注"),$(e).removeClass("j-list-operation__unfollow").addClass("j-list-operation__follow"),TFL.tips.showFlash("已取消关注"),$(e).parents(".click-tr").remove();else TFL.tips.showFlash(t.msg)},error:function(e){console.log(e)}})}var story_list_params=new Object,ajax_get_story_count_xhr=null,temp_entity_id_for_callback_function;$(document).ready(function(){if($("#items_content").length>0&&$("#story_list_content").removeAttr("ajax-table-headerfixed"),$(document).off("click","#check_all").on("click","#check_all",check_all_selected),refresh_selected_items(),setTimeout(function(){setTimeout(function(){if(should_ays_fill_story_count&&"tree"==stories_list_type)fill_stoies_count(stories_count_conditions,stories_count_url);else if($("#all_stories_count")){var e=$("#all_stories_count").text();judge_export_list(e),change_category_count(e)}change_page_info_when_ajax()},50)},100),current_user_id=get_cookie_value_by_js("current_user_id"),$.cookie(current_user_id+"_"+select_stories_init_params.story_list_fold_key)){var e=$.cookie(current_user_id+"_"+select_stories_init_params.story_list_fold_key),t="undefined"!=typeof enableHebe&&enableHebe?"font font-fold":"fold",r="undefined"!=typeof enableHebe&&enableHebe?"font font-unfold":"unfold";"true"==e?(fold_all("unfold"),$("#stories-fold-all-toggle").attr("class",r).attr("title",$("#stories-fold-all-toggle").attr("data-unfold-title"))):$("#stories-fold-all-toggle").attr("class",t).attr("title",$("#stories-fold-all-toggle").attr("data-fold-title"))}$(document).off("click","#stories-fold-all-toggle").on("click","#stories-fold-all-toggle",function(){current_user_id=get_cookie_value_by_js("current_user_id");var e="undefined"!=typeof enableHebe&&enableHebe?"font font-fold":"fold",t="undefined"!=typeof enableHebe&&enableHebe?"font font-unfold":"unfold";$(this).hasClass("fold")||$(this).hasClass("font-fold")?(fold_all("unfold"),addcookie(current_user_id+"_"+select_stories_init_params.story_list_fold_key,"true",168),$(this).attr("class",t).attr("title",$(this).attr("data-unfold-title")),$(".fold").attr("class",e).attr("title",$(this).attr("data-unfold-title"))):(fold_all("fold"),addcookie(current_user_id+"_"+select_stories_init_params.story_list_fold_key,"false",168),$(this).attr("class",e).attr("title",$(this).attr("data-fold-title")),$(".unfold").attr("class",e).attr("title",$(this).attr("data-fold-title")))}),enableHebe?TFL.listTable.listAction({wrap:".story-table-wrap",ddm:".dropdown-operation",checkbox:"td.flag_area input[type=checkbox]",checkAll:"#check_all",batchMenuTempl:"#menu_template .dropdown-operation"}):TFL.listTable.listAction({wrap:".list-content-wrap",ddm:".dropdown-operation",checkbox:"td.flag_area input[type=checkbox]",checkAll:"#check_all",batchMenuTempl:"#menu_template .dropdown-operation"})});var inline_call_back=function(e){new_id=$(e).attr("data-editable-value"),type="release_id"===$(e).find(".editable-value").attr("type")?"/releases":"/prong/iterations",current_href=$(e).find(".editable-value").attr("href")||_base+_workspace_id+type+"/view/0";var t=0;"undefined"==typeof current_href&&(current_href=$(e).attr("href"),t=1),"string"==typeof current_href&&(""!==new_id?(new_href=current_href.replace(/\d+?$/,"")+new_id,0==t?$(e).find(".editable-value").attr("href",new_href):$(e).attr("href",new_href)):$(e).find(".editable-value").removeAttr("href"))};