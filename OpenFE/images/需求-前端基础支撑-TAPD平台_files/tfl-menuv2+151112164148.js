TFL.widget("menuv2",{init:function(){this.search(),this.displayMoreMenu(),this.betterDorpdown()},search:function(){$("body").bind("menu_resize",function(){}),$("#main-search .input").focus(function(){$("body").hasClass("minimenu")?($(this).closest(".main-search-area").addClass("open"),""==$("#main-search .input").val()&&$("#main-search .input").prev("label").show()):($(this).animate({width:200},200,function(){}),$(".main-search-area").animate({"margin-left":-80},200,function(){}))}).blur(function(){var e=$(this);setTimeout(function(){$("body").hasClass("minimenu")?(e.closest(".main-search-area").removeClass("open"),$("#main-search .input").prev("label").hide()):($(".main-search-area").animate({"margin-left":0},200,function(){}),e.animate({width:120},200,function(){}))},100)}).keyup(function(){""==$(this).val()?$(this).prev("label").show():$(this).prev("label").hide()}),$("#search-form").submit(function(){var e=$("#search-form input[name=keyword]"),n=e.val().length>0;return n||$("#main-search .input").focus(),n}).mouseenter(function(){$("body").hasClass("minimenu")&&$("#main-search .input").focus()}),$("#search-form a").click(function(){var e=$("#search-form").attr("action"),n=$(this).attr("type"),t=$("#search-form input[name=keyword]").val();window.location=e+"?type="+n+"&keyword="+t})},displayMoreMenu:function(){$("#dropdown-nav-more .dropdown-menu li").length>9?$("#dropdown-nav-more .dropdown-menu").addClass("multi-cols"):$("#dropdown-nav-more .dropdown-menu").removeClass("multi-cols")},betterDorpdown:function(){var e={$trigger:null,$submenu:null,deactiveTimer:null,trangle:null,in_handler:null,out_handler:null,_disappear_delay:300,init:function(n,t,i,r){this.$trigger=n,this.$submenu=t,this.in_handler=i,this.out_handler=r,n.hover(function(){e.in_handler(),e.getTrangle()})},getTrangle:function(){return e.trangle={a:{x:e.$trigger.offset().left+e.$trigger.outerWidth()/2,y:e.$trigger.offset().top},b:{x:e.$submenu.offset().left,y:e.$submenu.offset().top},c:{x:e.$submenu.offset().left+e.$submenu.outerWidth(),y:e.$submenu.offset().top}},e.trangle},isInT:function(e,n,t,i){var r=this.math_p(e,n),a=this.math_p(e,t),o=this.math_p(e,i),s=this.math_x(r,a),u=this.math_x(a,o),l=this.math_x(o,r);return s>=0&&u>=0&&l>=0||0>=s&&0>=u&&0>=l?!0:!1},math_x:function(e,n){return e.x*n.y-e.y*n.x},math_p:function(e,n){return{x:e.x-n.x,y:e.y-n.y}},isInJElement:function(e,n){return n.length?n.offset().left+3>e.x?!1:n.offset().top>e.y?!1:n.offset().left+n.outerWidth()-3<e.x?!1:n.offset().top+n.outerHeight()-3<e.y?!1:!0:!1},in_menu_panel:function(e){var n=!1;return this.$submenu.is(":visible")&&(n=this.isInJElement(e,this.$submenu)),n||this.isInJElement(e,this.$trigger)},event_handler:function(n){if(e.in_menu_panel({x:n.pageX,y:n.pageY}))return e.clear_timer(),!e.in_handler||e.in_handler(),void e.getTrangle();if(e.trangle&&e.isInT({x:n.pageX,y:n.pageY},e.trangle.a,e.trangle.b,e.trangle.c)){if(e.deactiveTimer)return;return void(e.deactiveTimer=setTimeout(function(){!e.out_handler||e.out_handler()},e._disappear_delay))}e.clear_timer(),!e.out_handler||e.out_handler()},clear_timer:function(){clearTimeout(this.deactiveTimer),this.deactiveTimer=null}};e.init($("#dropdown-nav-more .dropdown-toggle"),$("#dropdown-nav-more>.dropdown-menu"),function(){$("#dropdown-nav-more").addClass("dropdown-open"),$("body").addClass("menu-open")},function(){$("#dropdown-nav-more").removeClass("dropdown-open"),$("body").removeClass("menu-open")}),$("#hd,#topnav").mousemove(e.event_handler),$("#dropdown-nav-more>.dropdown-menu").mouseleave(e.event_handler)}},!0,!1);