function get_tui_filter_param_as_string(){var e=window.location.href.match(/data\[Filter\]\[\w+\](\[[\w]*\]){0,1}=.[^&]*/g);null==e&&(e=window.location.href.match(/data\%5BFilter\%5D\%5B\w+\%5D(\%5B[\w]*\%5D){0,1}=.[^&]*/g));var t="";if(null!=e&&e.length>=1){t=e[0];for(var i=1;i<e.length;i++)t+="&"+e[i]}return t}function dealMore(e){for(var t=$([]),i=new Array,n=0,r=e.length;r>n;n++){var a=$("<div/>").text(e[n].label).html(),l=$("<div/>").text(e[n].title).html(),o=$("<div class='form-item' field-name='"+e[n].name+"'></div>"),c="",d=$("<label class='control-label' title='"+l+"'>"+a+c+"</label>"),s=$("<div class='controls'></div>");if(setFieldsName(e[n]),"radio"==e[n].type||"checkbox"==e[n].type){var f=$("<div class='controls-hook input-group-col-2'></div>");f.append(e[n].obj),s.append(f)}else s.append(e[n].obj);"tree_select"==e[n].type&&i.push(e[n].id),o.append(d).append(s),t=t.add(o)}$("#filter_content").append(t),update_fields_cookie(),deal_tree_select(i)}function deal_tree_select(e){if(e.length>0)for(var t=0;t<e.length;t++){var i=e[t],n=$.parseJSON(decodeURIComponent($("#"+i).attr("data-nodes")));TFL.use("TreeChooser,TreeChooserExcheck",function(){TFL.TreeChooser().init("#"+i,{view:{selectedMulti:!0,nameIsHTML:!0,dblClickExpand:!1},check:{enable:!0,chkStyle:"checkbox",autoCheckTrigger:!0,chkboxType:{Y:"s",N:"s"}},callback:{beforeClick:function(e,t){return!1},beforeCheck:function(e,t){var n=$.fn.zTree.getZTreeObj($("#"+i).next().find("ul").attr("id"));t.checked?n.cancelSelectedNode(t,!0):n.selectNode(t,!0,!0)},onCheck:function(e,t,n){var r=$("#"+i).next().find("ul").attr("id");updateVal(r,i)},onClick:function(e,t,i){}},filter:!0,clickClosePanel:!1,fillCategoryName:!0},n)})}}function setFieldsName(e){if("date-between"==e.type||"datetime-between"==e.type)e.obj.eq(0).attr({name:"data[Filter]["+e.name+"][begin]","date-to":"data[Filter]["+e.name+"][end]"}),e.obj.eq(1).attr({innerHTML:"-"}),e.obj.eq(2).attr({name:"data[Filter]["+e.name+"][end]","date-from":"data[Filter]["+e.name+"][begin]"});else if("checkbox"==e.type||"multi_select"==e.type||"tselect-multiple"==e.type){var t=e.obj.find("input");t.each(function(){var t=$(this);t.attr("name","data[Filter]["+e.name+"][]")})}else{var t="radio"==e.type?e.obj.find("input"):e.obj;t.attr("name","data[Filter]["+e.name+"]")}}function get_selected_fields(){for(var e=$("#filter_content").find("div.form-item"),t=$(e[0]),i='"'+t.attr("field-name")+'"',n=1;n<e.length;n++)t=$(e[n]),i+=',"'+t.attr("field-name")+'"';return i="["+i+"]"}function clear_all_filters(){clear_filters(),do_search(!0)}function clear_filters(){$("#filterForm input, #filterForm select:not(#currentview_select)").val("9999998"),$("#filterForm input, #filterForm select:not(#currentview_select)").val(""),$("#filterForm input:checked").attr("checked",!1),$("#filterForm .select-dropdown-panel").attr("title","").text("")}function change_more_condition_load_url(){var e=basic_url+"?data[show_fields]="+get_selected_fields()+get_special_fields()+get_unshow_fields()+get_no_empty_fields()+get_need_aggregate()+"&data[useless]=null";$("#more_condition").attr("load-url",e)}function get_no_empty_fields(){if(isTuiFilterPresenterNoEmpty)return"";var e="&data[no_empty]=";return e+=tuiFilterPresenterNoEmptyParam}function get_unshow_fields(){if(isTuiFilterPresenterFieldsNotShow)return"";var e="&data[unshow_fields]=";return e+=tuiFilterPresenterUnShowParam}function get_need_aggregate(){var e="&data[need_aggregate]=";return e+=getNeedAggregateParam}function get_special_fields(){if(isGetSpecialFields)return"";var e="&data[special_fields]=";return e+=getSpecialFielsdParam}function get_query_conditions(e){var t=$("#filterForm").serializeArray(),i=[],n=[],r="",e=e?e:!1;for(var a in t){var l=t[a];l.value&&(r=e?l.value:encodeURIComponent(l.value),i.push(l.name+"="+r),n.push(l))}return{data:n,query:i}}function remove_condition(e){$("input[name='data[Filter]["+e+"]']").val(""),$("input[name='data[Filter]["+e+"][]']").val(""),$("input[name='data[Filter]["+e+"][begin]']").val(""),$("input[name='data[Filter]["+e+"][end]']").val(""),$("select[name='data[Filter]["+e+"]']").length>0&&($("select[name='data[Filter]["+e+"]']")[0].selectedIndex=0),do_search(!0)}function updateVal(e,t){for(var i=$.fn.zTree.getZTreeObj(e),n=i.getCheckedNodes(!0),r="",a="",l=0;l<n.length;l++){var o=htmlspecialchars_decode(n[l].name),c=n[l].id;r.length?r+=";"+o:r=o,a.length?a+=";"+c:a=c}$("#"+t).prev(".treechooser-name").val(r),$("#"+t).val(a)}for(var i=0;i<can_not_remove_fields.length;i++)$("#filter_content .form-item[field-name="+can_not_remove_fields[i]+"]").addClass("no-remove");$(document).ready(function(){function e(e,t){return arguments.length<=1?$.cookie(e):void $.cookie(e,t,{expires:30})}$("#tui-filter-content").css("top",$("#tui-filter-btn").offset().top+$("#tui-filter-btn").outerHeight()+4),$("#close-oss-new-btn").on("top-alert-close",function(e){var t=$("#tui-filter-btn").offset().top+$("#tui-filter-btn").outerHeight()+4;$("#tui-filter-content").css("top",t)}),$(".j-tui-filter-content__toggle").bind("click",function(){clear_all_filters()}),$(document).on("keydown",function(e){e.altKey&&e.ctrlKey&&"f"===e.key&&$("#tui-filter-btn").click()}),$("#tui-filter-btn").bind("click",function(){var t;"none"==$("#tui-filter-content").css("display")?(t="tuiFilterOpen",$("#tui-filter-content").show(),$(".story-table-wrap").addClass("story-table-wrap--filtering"),isSetHash&&e("is_filter_close","false"),$("#tui-filter-btn").addClass("text-primary")):(t="tuiFilterClose",$("#tui-filter-content").hide(),$(".story-table-wrap").removeClass("story-table-wrap--filtering"),isSetHash&&e("is_filter_close","true"),show_result||$("#tui-filter-btn").removeClass("text-primary")),show_result&&$("#tui-filter-btn").removeClass("font-filter").addClass("font-filter-fill").addClass("text-primary"),$("#ws-sidebar").height($("#page-wrapper").height()-12)}),$("#del_filter").bind("click",function(){$("#tui-filter-btn").trigger("click")}),change_more_condition_load_url(),$("#filter_content").keydown(function(e){if(13==e.keyCode){if($(document.activeElement).hasClass("txt-user-chooser"))return;$(".tfl-avatar-list input").blur(),do_search()}}),$("#filterForm").keydown(function(e){return 13==e.keyCode?(e.stopPropagation(),!1):void 0}),update_fields_cookie(),TFL.use("tSelect"),TFL.use("loading"),$(document).bind("leftTreeToOpen",function(){$("div[aria-labelledby=ui-dialog-title-customize_fields_form]").animate({left:parseInt($("div[aria-labelledby=ui-dialog-title-customize_fields_form]").css("left"))+$("#tree-wrapper").width()},"fast")}),$(document).bind("leftTreeToClose",function(){$("div[aria-labelledby=ui-dialog-title-customize_fields_form]").animate({left:parseInt($("div[aria-labelledby=ui-dialog-title-customize_fields_form]").css("left"))-$("#tree-wrapper").width()},"fast")})}),$("#filter_content").bind("onremove",function(e){setTimeout(update_fields_cookie,100),setTimeout(change_more_condition_load_url,100)}),$(function(){var e=$("#filterForm .controls input[html-type='tree_select']");$(e).each(function(e,t){var i=$(t).attr("id"),n=$.parseJSON(decodeURIComponent($("#"+i).attr("data-nodes")));TFL.use("TreeChooser,TreeChooserExcheck",function(){TFL.TreeChooser().init("#"+i,{view:{selectedMulti:!0,nameIsHTML:!0,dblClickExpand:!1},check:{enable:!0,chkStyle:"checkbox",autoCheckTrigger:!0,chkboxType:{Y:"s",N:"s"}},callback:{beforeClick:function(e,t){return!1},beforeCheck:function(e,t){var n=$.fn.zTree.getZTreeObj($("#"+i).next().find("ul").attr("id"));t.checked?n.cancelSelectedNode(t,!0):n.selectNode(t,!0,!0)},onCheck:function(e,t,n){var r=$("#"+i).next().find("ul").attr("id");updateVal(r,i)},onClick:function(e,t,i){}},filter:!0,clickClosePanel:!1,fillCategoryName:!0},n)})})});