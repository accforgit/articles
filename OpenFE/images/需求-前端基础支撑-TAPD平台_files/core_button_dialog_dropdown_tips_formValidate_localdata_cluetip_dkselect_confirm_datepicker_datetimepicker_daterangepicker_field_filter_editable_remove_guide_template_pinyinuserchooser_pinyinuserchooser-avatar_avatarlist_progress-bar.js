/**output by compresser**/var TFL={version:"1.0",moduleConfigs:{},widgets:{},path:window.tfl_path||"",tag:window.tfl_tag||window.jsVersion||"",versionMap:window.DIST_VERSION_MAP||{},cdn_enabled:window.cdn_enabled||!1};TFL.Loader={loaded:{},loadingFiles:{},loadList:{},load:function(e,t,r,i,a){var s,o,n=document,l=n.getElementsByTagName("head")[0],c=t||e.split("?")[0].toLowerCase().substring(e.lastIndexOf(".")+1),u=function(){TFL.Loader.loaded[e]=1,delete TFL.Loader.loadingFiles[e],i&&i(),i=null},d=e.split(TFL.path);if(d.length>1&&"undefined"!=typeof TFLLoadFileListMap&&$.inArray(d[1],TFLLoadFileListMap)>-1&&u(),e){if(e=TFL._convert_to_cdn_url(e,c),TFL.Loader.loaded[e]||"css"===c&&TFL.isCssLoaded(e))return void(i&&i());if(TFL.Loader.loadingFiles[e])return void setTimeout(function(){TFL.Loader.load(e,t,r,i,a)},10);if(TFL.Loader.loadingFiles[e]=1,o=TFL._versionFile(e),"js"===c?(s=n.createElement("script"),s.setAttribute("type","text/javascript"),s.setAttribute("src",o),s.setAttribute("async",!0)):"css"===c?(s=n.createElement("link"),s.setAttribute("type","text/css"),s.setAttribute("rel","stylesheet"),s.setAttribute("href",o),u()):("tmpl"===c||"art"===c)&&(s=$("<div>")),r&&(s.charset=r),"tmpl"===c||"art"===c)s.load(o,function(){$("body").append(s),u()});else if("js"===c)s.onerror=function(){u(),s.onerror=null},s.onload=s.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(u(),s.onload=s.onreadystatechange=null)},l.appendChild(s);else if("css"===c)a?n.body.appendChild(s):l.insertBefore(s,TFL.headFirstChild);else try{l.appendChild(s)}catch(p){console.error("无法加载url为["+o+"]的节点\n",p),u()}}}};var loadJs=TFL.Loader.loadJs=function(e,t){TFL.Loader.load(e,"js","",t)},loadCss=TFL.Loader.loadCss=function(e,t){TFL.Loader.load(e,"css","",null,t)};TFL.headFirstChild=document.getElementsByTagName("head")[0].firstChild,TFL._convert_to_cdn_url=function(e,t){if(!TFL.cdn_enabled)return e;var r=location.protocol+"//"+t+"-tdl.tapd.cn/tfl/",i=RegExp("^"+TFL.path);return e.replace(i,r)},TFL._versionFile=function(e){if(/js\/mathjax\//.test(e))return e;var t=e;for(var r in TFL.versionMap){var i=r.replace(/^http(s)?:\/\//,""),a=["users","adgroups","usersandadgroups","usersandadgroupspinyin","usersscript","userspinyin","tables","workspaces","all_workspaces"],s=e.match(/\/js\/(.*?)(\/|\.js)/),o=null!=s&&-1!=$.inArray(s[1],a);if(!o&&"undefined"!=typeof cdn_enabled&&cdn_enabled){var n=_base.replace(/^http(s)?:\/\//,""),l=/www\.tapd\.cn\/js\//.test(e),c=/www\.tapd\.cn\/css\//.test(e);(l&&/^js\./.test(i)||c&&/^css\./.test(i))&&(e=e.replace(n,i))}if(!(e.indexOf(i)<0)){var u=e.split(location.protocol+"//"+i),d=u[u.length-1].split("?"),p=d[0];if(TFL.versionMap[r]&&TFL.versionMap[r][p]){var f=TFL.versionMap[r][p],h=p.replace(/^js\//,"js_dist/").replace(/^css\//,"css_dist/").replace(/^template\//,"template_dist/"),m=h.lastIndexOf(".");e=location.protocol+"//"+i+h.slice(0,m)+"+"+f+h.slice(m,h.length)}else if(t===e&&TFL.tag){if(-1==t.indexOf("?"))tag="?v="+TFL.tag;else{var g=/(v=|r=)/;tag=g.test(t)?"":"&v="+TFL.tag}e=t+tag}}}return e},TFL.add=function(e,t){e&&t&&t.path&&(TFL.moduleConfigs[e]=t)},TFL.register=function(e,t){TFL.add(e,{path:t.jsUrl})},TFL.use=function(){var e,t,r=[].slice.call(arguments),i="string"==typeof r[0]?r[0].split(","):[];return i.length>1?void TFL.use(i[0],function(){i.shift(),TFL.use(i.join(","),r[1])}):(r[0]instanceof Array&&(r=r[0].concat(r[1])),"function"==typeof r[r.length-1]&&(e=r.pop()),t=r.join(""),void TFL.loadDeps(r,function(){TFL.Loader.loadList[t]=1,e&&e()}))},TFL.loadDeps=function(e,t){function r(){--o||t()}var i,a,s,o,n=(TFL.moduleConfigs,0);if(i=e.join(""),o=e.length,TFL.Loader.loadList[i])return void t();for(;a=e[n++];)"jqueryUiCore"==a&&jQuery.ui?r():(s=TFL.getMod(a),s.requires?TFL.loadDeps(s.requires,function(e){return function(){TFL.Loader.load(e.path,e.type,e.charset,r)}}(s)):(""==s.path&&r(),TFL.Loader.load(s.path,s.type,s.charset,r)))},TFL.getMod=function(e){var t,r=TFL.moduleConfigs;return t="string"==typeof e?r[e]?r[e]:{path:e}:e},TFL.delay=function(){var e=[].slice.call(arguments),t=e.shift();window.setTimeout(function(){for(var t,r=0;t=e[r++];)t&&t()},t)},TFL.css=function(e){e=e.join("");var t=document,r=t.getElementById("tfl-inline-css");r||(r=t.createElement("style"),r.type="text/css",r.id="tfl-inline-css",t.body.appendChild(r)),r.styleSheet?r.styleSheet.cssText+=e:r.appendChild(t.createTextNode(e))},TFL._isWidgeted=function(e){var t,r=!1;try{t=new Function("return TFL."+e)()}catch(i){r=!0}return!r&&t?!0:!1},TFL.widget=function(e,t,r,i){if(1===arguments.length&&$.isPlainObject(arguments[0]))return TFL.initWidget(null,arguments[0]),arguments[0];if(TFL._isWidgeted(e))return!1;for(var a,s,o=e?e.split("."):[],n=TFL,l=0,c=o.length;c>l;l++)if(c>l+1){var u=o[l],d=o[l+1];n[u]=n[u]||{},n[u][d]=n[u][d]||{},a=d,n=n[u]}else a?(n[d]=t,s=n[d]):(i?TFL.toInstantiate(o[l],t):TFL[o[l]]=t,s=TFL[o[l]]),r&&TFL.initWidget(e,s)},TFL.initWidget=function(e,t){var r=function(){if(t.init){if(null!==e){if(TFL.widgets[e])return;TFL.widgets[e]=!0}t.init()}};jQuery.isReady?setTimeout(r,0):$(function(){r()})},TFL.toInstantiate=function(e,t){TFL[e]=function(){return new TFL[e].handler(arguments)},TFL[e].handler=function(t){var r=Array.prototype.slice.call(t,0);return t=r[r.length-1],$.isPlainObject(t)||(t={}),this.options=$.extend({},this.defaults,t),this.widgetName=e,this._init.apply(this,r),this},TFL[e].handler.prototype=$.extend({},TFL.widget.prototype,t)},TFL.widget.prototype={_init:function(){},_trigger:function(e,t,r){var i=this.options[e],a=this.widgetName+e;$(t).trigger(a),$.isFunction(i)&&i(t,r)}},TFL.browser={_uaMatch:function(){var e=navigator.userAgent.toLowerCase(),t={},r=/(opr)[ \/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],i=e.indexOf("compatible")>-1&&e.indexOf("msie")>-1,a=e.indexOf("edge")>-1&&!i,s=e.indexOf("trident")>-1&&e.indexOf("rv:11.0")>-1;return t=a?{browser:"msie",version:"12.0"}:s?{browser:"msie",version:"11.0"}:{browser:r[1]||"",version:r[2]||"0"}},init:function(){TFL.browser.modernizr();var e=TFL.browser._uaMatch(),t={};e.browser&&(t[e.browser]=!0,t.version=e.version),t.opr?(t.webkit=!0,t.opera=!0):t.chrome?t.webkit=!0:t.webkit&&(t.safari=!0);for(var r in t)TFL.browser[r]=t[r]},is:function(e){switch(e){case"ie":e="msie";break;case"firefox":e="mozilla"}return!!TFL.browser[e]},modernizr:function(){for(var e=(function(){var e=document.createElement("div"),t="Ms O Moz Webkit".split(" ");return function(r){var i=t.length;if(r in e.style)return!0;for(r=r.replace(/^[a-z]/,function(e){return e.toUpperCase()});i--;)if(t[i]+r in e.style)return!0;return!1}}()),t="animation transition".split(" "),r=t.length;r--;)e(t[r])||$("html").addClass("no-"+t[r])}},TFL.browser.init(),jQuery.browser||(jQuery.browser=TFL.browser),TFL.ie={isTrue:TFL.browser.msie,version:function(){return TFL.browser&&TFL.browser.version?TFL.browser.version.split(".")[0]:"0"},init:function(){if(this.isTrue){var e=this.mode(),t="ie ie"+this.version();9>e&&(t+=" oldie"),t+=" mode"+e,$("html").addClass(t),$(function(){TFL.ie.css3()})}},mode:function(e){if(this.isTrue){var t=parseInt(document.documentMode||this.version());return e?t===e:t}},css3:function(){this.isTrue&&this.mode()<9&&TFL.Loader.loadJs(TFL.path+"js/tfl-ie.js",function(){TFL.tflIe.init()})}},TFL.ie.init(),TFL.tagBoolean=function(e,t,r){var i,a=$(t).attr(e);return i=r?"false"==a?!1:!0:"true"==a||e==a?!0:!1},TFL.preventCssRepeat=function(e,t){var r=$("head").addClass(e+"-css-loaded"),i=t;return"both"===r.css("clear")&&(i=""),r.removeClass(e+"-css-loaded"),!r.attr("class")&&r.removeAttr("class"),i},TFL.isCssLoaded=function(e){var t=e.substring(e.lastIndexOf("/")+1,e.lastIndexOf(".")).toLowerCase(),r=$("head").addClass("cssloaded-"+t),i=!1;return"both"===r.css("clear")&&(i=!0),r.removeClass("cssloaded-"+t),i},TFL.highchart=function(e){TFL.use("highchart",function(){TFL._highchart(e)})},TFL.highchartNew=function(e){TFL.use("highchartNew",function(){TFL._highchart(e)})},TFL.getTblPath=function(){var e="",t=location.host;switch(t){case"rd.tencent.com":e="http://rd.tencent.com/tdl/tbl/";break;case"tapd.tencent.com":case"om.tencent.com":e=location.protocol+"//tapd.tencent.com/tdl/tbl/";break;case"www.tapd.cn":e=location.protocol+"//tdl.tapd.cn/tbl/";break;case"smart.oa.com":e="http://smart.oa.com/~frankychen/tdl/tbl/";break;case"mac.oa.com":case"opel.oa.com":e="http://mac.oa.com/tdl/tbl/";break;case"lion.oa.com":e="http://lion.oa.com/"+location.pathname.split("/")[1]+"/tdl/tbl/";break;case"tiger.oa.com":e="http://tiger.oa.com/tdl/tbl/";break;case"leopard.oa.com":e="http://leopard.oa.com/tdl/tbl/";break;default:e="http://tdl.oa.com/tbl/"}return"undefined"!=typeof cloud_vpc_site&&cloud_vpc_site.length>1&&(e=location.protocol+"//tdl.tapd.cn/tbl/"),e},TFL.parseHash=function(e){var t=window.location.hash;if(0!==t.indexOf("#"))return!1;for(var r=t.split("#")[1].split("&"),i=r.length,a={},s=0;i>s;s++){var o=r[s].split("=")[0],n=r[s].split("=")[1];o&&n&&(a[o]=n)}return e?a[e]:a},TFL.getQueryArray=function(e,t){var r=t||document.location.search;if(!r||-1==r.indexOf("?"))return{};var i=r.substr(r.indexOf("?")+1),a=i.split("&"),e=void 0===e?!0:e,s={};for(var o in a){var n=a[o].split("=");if(!(n.length<2)){var l=decodeURIComponent(n[1].replace(/\+/g," "));(l||e)&&(s[decodeURIComponent(n[0])]=l)}}return s},TFL.getQueryValue=function(e,t){var r=t||document.location.search;if(!r||!e)return"";var i=new RegExp("[\\?&]"+encodeURIComponent(e)+"=[^&#]+","g"),a=r.match(i);return a?decodeURIComponent(a.pop().substr(1).split("=")[1].replace(/\+/g," ")):""},TFL.isDomainSetted=function(){return location.host.replace(/:\d+/,"")!==document.domain},TFL.getDomain=function(){return document.domain},TFL._version=function(){try{return{jquery:jQuery.fn.jquery,"jquery-ui":jQuery.ui?jQuery.ui.version:"还没加载...",IEmode:document.getElementsByTagName("meta")[1]&&document.getElementsByTagName("meta")[1].getAttribute("content")||"no meta"}}catch(e){return"something error"}},TFL.jq14=function(e){TFL.use("jq14",function(){jq14=jQuery.noConflict(!0),e&&e(jq14)})},TFL.htmlspecialchars_decode=function(e){var t={"&amp;":"&","&#37;":"%","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#40;":"(","&#41;":")","&#43;":"+","&#45;":"-","&#92;":"\\"};return e.replace(/&amp;|&#37;|&lt;|&gt;|&quot;|&#39;|&#40;|&#41;|&#43;|&#45;|&#92;/gi,function(e){return t[e]})},TFL.htmlspecialchars_encode=function(e){var t={"&":"&amp;","%":"&#37;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","(":"&#40;",")":"&#41;","+":"&#43;","-":"&#45;","\\":"&#92;"};return e.replace(/&|%|<|>|"|'|\(|\)|\+|-|\\/gi,function(e){return t[e]})},$.fn.dialog=function(e){var t=$(this);TFL.use("uiDialog",function(){t.dialog(e)})},$.fn.sortable=function(){var e=$(this),t=arguments;TFL.use("sortable",function(){$.fn.sortable.apply(e,[].slice.call(t))})},$.fn.DkSelect=function(e){var t=$(this);TFL.use("plugDkSelect",function(){t.DkSelect(e)})},$.fn.cluetip=function(e){var t=$(this);TFL.use("uiCluetip",function(){t.cluetip(e)})},window.t||(window.t=function(e){return e}),window.console||(window.console={log:function(){}}),function(e){var t=e+"js/",r=e+"css/";if(TFL.moduleConfigs={jqueryUiCore:{path:t+"jquery-ui-core.js"},uiDialog:{path:t+"ui.dialog.tapd.js",requires:["jqueryUiCore"]},dialog:{path:t+"tfl-dialog.js",requires:["uiDialog",r+"tfl-dialog.css"]},uiDatepicker:{path:t+"ui.datepicker.min.js",requires:["jqueryUiCore"]},datePicker:{path:t+"tfl-datepicker.js",requires:["uiDatepicker",r+"tfl-datepicker.css"]},datetimepicker:{path:t+"tfl-datetimepicker.js"},weekpicker:{path:t+"tfl-weekpicker.js"},localData:{path:t+"tfl-localdata.js"},uiCluetip:{path:t+"jquery.cluetip.js"},cluetip:{path:t+"tfl-cluetip.js",requires:[r+"tfl-cluetip.css"]},pinyinEngine:{path:t+"pinyinEngine.js"},plugDkSelect:{path:t+"dk_select.js"},dkSelect:{path:t+"tfl-dkselect.js",requires:[r+"tfl-dkselect.css"]},tSelect:{path:t+"tfl-tselect.js",requires:["dropdown"]},uSelect:{path:t+"tfl-uselect.js",requires:[r+"tfl-uselect.css"]},resizable:{path:t+"ui.resizable.js",requires:["jqueryUiCore"]},draggable:{path:t+"ui.draggable.js",requires:["jqueryUiCore"]},sortable:{path:t+"ui.sortable.js",requires:["jqueryUiCore"]},droppable:{path:t+"ui.droppable.js",requires:["jqueryUiCore"]},tab:{path:t+"tfl-tab.js",requires:["tabCss"]},tabCss:{path:TFL.preventCssRepeat("tab",r+"tfl-tab.css")},highchart:{path:t+"tfl-highchart.js"},highchartNew:{path:t+"tfl-highchartNew.js"},plugUserChooser:{path:t+"userchooser.js"},userChooser:{path:t+"tfl-userchooser.js",requires:[r+"tfl-dropdown.css"]},button:{path:t+"tfl-button.js"},ico:{path:r+"tfl-ico.css"},mainnav:{path:t+"tfl-mainnav.js",requires:[r+"tfl-mainnav.css"]},topnav:{path:t+"tfl-topnav.js",requires:[r+"tfl-topnav.css"]},sidebar:{path:t+"tfl-sidebar.js",requires:[r+"tfl-sidebar.css"]},step:{path:r+"tfl-step.css"},dropdown:{path:t+"tfl-dropdown.js",requires:[r+"tfl-dropdown.css"]},filter:{path:t+"tfl-filter.js",requires:[r+"tfl-filter.css","remove"]},tips:{path:t+"tfl-tips.js",requires:[r+"tfl-tips.css"]},progress:{path:r+"tfl-progress.css"},confirm:{path:t+"tfl-confirm.js",requires:[r+"tfl-dialog.css"]},field:{path:t+"tfl-field.js"},remove:{path:t+"tfl-remove.js"},editable:{path:t+"tfl-editable.js",requires:["field"]},editor:{path:t+"tfl-editor.js",requires:[r+"tfl-editor.css",r+"tfl-editor-content-style.css","tabCss","tips","htmlParser"]},gallery:{path:t+"tfl-gallery.js",requires:[r+"tfl-gallery.css"]},mask:{path:t+"tfl-mask.js"},pinyinuserchooser:{path:t+"tfl-pinyinuserchooser.js",requires:["typeahead"]},avatarlist:{path:t+"tfl-avatarList.js",requires:["typeahead","pinyinuserchooser"]},jquery17:{path:t+"jquery-1.7.2.min.extend.js"},typeahead:{path:t+"typeahead.bundle.js",requires:["jquery17"]},bubble:{path:t+"tfl-bubble.js"},loading:{path:t+"tfl-loading.js"},validate:{path:t+"tfl-validate.js"},formValidate:{path:t+"tfl-formValidate.js",requires:["localData"]},uiform:{path:t+"tfl-uiform.js"},template:{path:t+"tfl-template.js"},Notification:{path:t+"tfl-notification.js"},guide:{path:t+"tfl-guide.js",requires:["guideException"]},guideException:{path:t+"tfl-guideException.js"},placeholder:{path:t+"tfl-placeholder.js"},prettyPrint:{path:t+"prettify.js"},mathjax:{path:t+"mathjax/MathJax.js?config=TeX-AMS_HTML",requires:[r+"mathjax.css"]},mermaid:{path:t+"mermaid.js"},markdownEngine:{path:t+"markdown-engine.js",requires:["md5","prettyPrint","mermaid","mathjax"]},md5:{path:t+"md5.js"},markdown:{path:t+"tfl-markdown.js",requires:[r+"tfl-markdown.css",r+"tfl-editor-content-style.css","markdownEngine","VDom"]},radioSelect:{path:t+"tfl-radioSelect.js"},base64:{path:t+"tfl-base64.js"},htmlParser:{path:t+"tfl-htmlparser.js"},lazyload:{path:t+"tfl-lazyload.js"},VDom:{path:t+"virtual-dom.js"}},jQuery.fn.jquery.split(".")[1]>=9){var i=t+"jquery/jqueryui-1.10.4/";$.extend(TFL.moduleConfigs,{jqueryUiCore:{path:i+"jquery.ui.core.mix.js"},uiDialog:{path:t+"ui.dialog.tapd2.js",requires:["jqueryUiCore","draggable"]},uiDatepicker:{path:i+"jquery.ui.datepicker.js",requires:["jqueryUiCore"]},resizable:{path:i+"jquery.ui.resizable.js",requires:["jqueryUiCore"]},draggable:{path:i+"jquery.ui.draggable.js",requires:["jqueryUiCore"]},droppable:{path:i+"jquery.ui.droppable.js",requires:["jqueryUiCore"]},sortable:{path:i+"jquery.ui.sortable.js",requires:["jqueryUiCore"]}})}}(TFL.path);
TFL.widget("button",{init:function(){this.preventResubmit(),this._bindIeActive(),$("body").delegate("[prevent-resubmit='true']","click",function(){TFL.button.disable(this)}).delegate(".btn.disabled","mouseenter",function(){$(this).removeAttr("onclick")})},preventResubmit:function(){$("[prevent-resubmit-form='auto']").not("[resubmit-init='true']").submit(function(t){var e=$(this),i=$(document.activeElement).closest(".btn");$(window).on("beforeunload",function(){if(i.length){var t;i.find('[type="submit"], [type="button"]').length&&!i.attr("data-loading-text")&&(t="auto"),TFL.button._disableBtn(i,t)}e.find(".btn").each(function(){TFL.button._disableBtn(this)})})}).attr("resubmit-init","true"),$("[prevent-resubmit-form='true']").not("[resubmit-init='true']").submit(function(){TFL.button.disableGroup(this),$(this).attr("resubmit-init","true")}),$("[prevent-resubmit-dialog='true']").not("[resubmit-init='true']").submit(function(){TFL.button._disableDialog(this),$(this).attr("resubmit-init","true")})},_disableBtn:function(t,e){var t=$(t);if(!t.attr("btn-disabled")&&!t.hasClass("btn-copy")){var i=t.clone(),n=i.attr("id")?i.attr("id")+"_copy":"",a=i.attr("href")?"javascript:;":"",e="undefined"!=typeof e?e:i.attr("data-loading-text");if(n&&i.attr("id",n),a&&i.attr("href",a),i.addClass("btn-copy disabled").removeAttr("prevent-resubmit").removeAttr("onclick").find("button,input").removeAttr("name").attr("disabled",!0),e)if(0===e.indexOf(".loading")){var o=e.replace(/\./gi," ");i.append('<i class="'+o+'"></i>')}else{var r=i.is("input, button")?i:i.find("input, button, a"),s=r.is("input")?"val":"html";"auto"===e&&(e=r[s]()+"..."),r[s](e)}t.hide().trigger("disabled").attr("btn-disabled","true"),i.insertBefore(t)}},disableGroup:function(t){$(t).find(".btn").each(function(){TFL.button._disableBtn(this)})},disable:function(t,e){$(t).hasClass("btn")||$(t).is("input[type=button],input[type=submit],button")?TFL.button._disableBtn(t,e):TFL.button.disableGroup(t)},enable:function(t){if($(t).hasClass("btn")||$(t).is("input[type=button],input[type=submit],button")){var e=$(t);e.prev(".btn-copy").remove(),e.show().removeClass("disabled").removeAttr("btn-disabled")}else{var i=t||"body",n=$(i);n.find(".btn-copy").remove(),n.find(".btn[btn-disabled]").show().removeClass("disabled").removeAttr("btn-disabled")}},_disableDialog:function(t){var e=$("#tdialog-buttonwrap",parent.document);e.length&&e.attr("iframe-control")&&parent.TFL.button.disableGroup("#tdialog-buttonwrap"),$("#tdialog-buttonwrap").length&&TFL.button.disableGroup("#tdialog-buttonwrap")},_bindIeActive:function(){if($.browser.msie){var t=$("body");t.delegate(".btn","mousedown",function(){$(this).addClass("active")}).delegate(".btn","mouseup",function(){$(this).removeClass("active")})}}},!0);
TFL.widget("dialog",{init:function(){TFL.use("uiDialog",function(){TFL.dialog._bindEvent()})},_bindEvent:function(){var e="[data-control='dialog'],[data-control='dialog-simple'],.tapdbox";$("body").undelegate(e,"click",TFL.dialog._init).delegate(e,"click",TFL.dialog._init)},_init:function(){var e=$(this);if(e.hasClass("disabled"))return!1;var t=TFL,i=e.attr("title")||e.attr("name")||"",a=t.tagBoolean("data-escape-title",e,!1),o=e.attr("href")||e.attr("url"),l=t.tagBoolean("useiframe",e,!0),r=t.tagBoolean("useiframebtn",e,!0),n=t.tagBoolean("resizeiframe",e,!1),s=t.tagBoolean("lightweight",e,!1),d="true"==e.attr("modal")?"white":!1,g=e.attr("btns")||"",c=t.tagBoolean("fullscreen",e,!0),u=e.attr("offset")||"",f=e.attr("loadingType")||2,m=t.tagBoolean("resizable",e,!1),h=e.attr("data-id")||"",p=e.attr("customClass"),b=t.tagBoolean("hideanimation",e,!1),v=t.tagBoolean("clickOutsideClose",e,!1);return a&&(i=t.htmlspecialchars_encode(i)),"dialog-simple"==e.attr("data-control")?(b=t.tagBoolean("hideanimation",e,!0),TFL.dialog.show({simple:!0,url:o,minHeight:80,modal:d,useIframe:l,dataBtn:g,useIframeBtn:r,lightWeight:s,resizeIframe:n,offset:u,loadingType:f,trigger:e,hideAnimation:b,resizable:m,draggable:!1,id:h,customClass:p,clickOutsideClose:v})):TFL.dialog.show({title:i,url:o,useIframe:l,dataBtn:g,useIframeBtn:r,fullscreen:c,hideAnimation:b,resizable:m,loadingType:f,id:h,customClass:p,clickOutsideClose:v}),this.blur(),TFL.dropdown&&TFL.dropdown.clearMenus(),!1},show:function(e){try{if(!e||!e.url||e.simple&&$(e.trigger).hasClass("rela-dialog-open"))return;e.simple&&$(".rela-dialog-open").removeClass("rela-dialog-open");var t={simple:!1,title:"",url:"",width:630,height:440,minHeight:150,modal:!0,useIframe:!0,useIframeBtn:!0,dataBtn:"",lightWeight:!1,resizeIframe:!1,trigger:null,fullscreen:!0,offset:"",hideAnimation:!1,resizable:!1,draggable:!0,sticky:!1,clickOutsideClose:!1,zIndex:1e3,loadingType:2},i=jQuery.extend(t,e),a=i.url.replace(/^.+\?/,""),o=this._parseQuery(a),l=1*o.width||i.width,r=o.height,n="auto"==r?"auto":1*r||i.height,s=o.zIndex||i.zIndex,d=o.position,g=i.id?i.id:i.simple?"tdialog-simple":"tdialog",c=g+"-loading",u=g+"-iframe",f=TFL.ie.mode(6)?!0:!1,m=document,h=$(m);i.resizable&&TFL.use("resizable"),i.simple&&($(i.trigger).addClass("rela-dialog-open").unbind("tdialog-simple-close").bind("tdialog-simple-close",function(){$(this).removeClass("rela-dialog-open")}),i.arrowPosition=d),!$("#"+g).length&&$("<div></div>").attr("id",g).appendTo("body");var p=$("#"+g);i.useIframeBtn?p.removeAttr("useiframebtn"):p.attr("useiframebtn","false"),i.simple&&p.html("").css("overflow",""),!$("#"+c).length&&p.html("<div id='"+c+"' class='strip-loading"+i.loadingType+"'></div>"),i.simple&&i.dataBtn?$("#"+c).css("margin-top","-23px"):$("#"+c).css("margin-top",""),p.dialog("destroy").dialog({title:i.title,width:l,height:n,minHeight:i.minHeight,position:d,simple:i.simple,lightWeight:i.lightWeight,trigger:i.trigger,arrowPosition:i.arrowPosition,buttons:i.dataBtn,modal:i.modal,bgiframe:f,resizable:i.resizable,draggable:i.draggable,fullscreen:i.fullscreen,offset:i.offset,hideAnimation:i.hideAnimation,id:g,customClass:i.customClass,zIndex:s,dragStop:function(e,t){h.trigger(g+"-dragstop").trigger("dialog_drag_stop")},close:function(e,t){var a=$("#"+u);a.length?a.attr("src","").removeAttr("loaded"):p.html("").css("overflow",""),h.trigger(g+"-close").trigger("tapdbox_remove"),i.simple&&$(i.trigger).trigger("tdialog-simple-close"),h.unbind("click.__closeDialog")},open:function(e,t){h.trigger(g+"-open").trigger("tapd_box_opened"),i.sticky&&$(e.target).dialog("widget").parent().css({position:"fixed"}).position({my:"center",at:"center",of:window}),i.clickOutsideClose&&setTimeout(function(){h.unbind("click.__closeDialog").bind("click.__closeDialog",function(e){$(e.target).closest("#"+g).length||!p.dialog("isOpen")||TFL.dialog.stopClose||(p.dialog("close"),h.unbind("click.__closeDialog")),TFL.dialog.stopClose=!1})},500)}});var b=(new Date).getTime();if(i.url+=-1==i.url.indexOf("?")?"?rand="+b:"&rand="+b,i.tplId){var v=$("#"+i.tplId);if(0===v.length)throw new Error("there is no tpl used for TFL.dialog");p.css("overflow","auto"),p.html(v.html()),TFL.dialog._afterLoaded(i.dataBtn,g),setTimeout(function(){$(document).trigger("after.dialog.loaded")},0),i.tplCallback&&i.tplCallback.call()}else if(i.useIframe){var w=i.resizeIframe?"0":"100%",T=$("#"+u);T.length?T.attr("src",i.url):(T=$("<iframe style='visibility:hidden' allowtransparency='true' id='"+u+"' src='"+i.url+"' width='100%'  frameborder='0'></iframe>").attr("height",w),p.append(T),T.bind("load",function(){TFL.dialog._showIframe(g)})),clearTimeout(p.data("tc"));var _=setTimeout(function(){T.attr("loaded")||TFL.dialog._showIframe(g)},4e3);p.data("tc",_)}else p.load(i.url,function(){p.css("overflow","auto"),TFL.dialog._afterLoaded(i.dataBtn,g),$(document).trigger("after.dialog.loaded")})}catch(F){alert("出错啦："+F)}},height:function(e,t){var t=arguments[1]?arguments[1]:"tdialog";if(!e)return $("#"+t).height();var i=0;return $dialog=$("#"+t),e=$.trim(""+e),i="+"==e[0]||"-"==e[0]?$dialog.height()+parseInt(e)||0:e,$dialog.height(i)},close:function(e,t,i,a,o){var o=arguments[4]?arguments[4]:"tdialog";$("#"+o).dialog("close"),TFL.dialog._afterClose(e,t,i,a)},closeSimple:function(e,t,i,a,o){var o=arguments[4]?arguments[4]:"tdialog-simple";TFL.dialog.stopClose||($("#"+o).dialog("close"),TFL.dialog._afterClose(e,t,i,a)),TFL.dialog.stopClose=!1},followScroll:function(e,t){e=$(e),t=$(t);var i,a=24;e.unbind("scroll").bind("scroll",function(){i&&i.length||(i=$(".dialog-simple:last"));$(this);if(i.length&&i.is(":visible")){var o=t.offset().top,l=e.offset().top;o+a>l?i.css("top",o+a):i.css("top",l);var r=l+e.height();o+a>r&&i.css("top",r)}})},_afterClose:function(e,t,i,a){if(e)if(t){var o=/http:\/\//i,l=/https:\/\//i;"string"!=typeof t||0!=t.search(o)&&0!=t.search(l)?window.location.reload():window.location.href=t}else window.location.reload();if(TFL.tips){var a=a||"Operate successfully";i&&TFL.tips.showFlash(a,!1)}return!1},_showIframe:function(e){var t=$("#"+e+"-buttonwrap"),i=$("#"+e+"-iframe");""!==i.attr("src")&&i.attr("loaded",!0),t.attr("iframe-control")?(t.find(".btn-copy").remove(),t.find(".btn").show()):($("#"+e+"-loading").remove(),i.css("visibility","visible"),t.find(".btn").removeClass("disabled").unbind("click").click(function(t){t.preventDefault(),TFL.dialog._doIframe(this,e)}),t.attr("iframe-control",!0))},_afterLoaded:function(e,t){e&&($("#"+t+"-buttonwrap").find(".btn").removeClass("disabled").unbind("click").click(function(e){e.preventDefault();var t=new Function("return "+$(this).attr("name"))();t.call(this)}),TFL.button&&TFL.button.preventResubmit())},_doIframe:function(e,t){if("false"==$("#"+t).attr("useiframebtn")){var i=new Function("return "+e.name)();i()}else{var a=document.getElementById(t+"-iframe").contentWindow.document,t=e.name;a.getElementById(t).click()}},_parseQuery:function(e){var t={};if(!e)return t;for(var i=e.split(/[;&]/),a=0;a<i.length;a++){var o=i[a].split("=");if(o&&2==o.length){var l=unescape(o[0]),r=unescape(o[1]);r=r.replace(/\+/g," "),t[l]=r}}return t}},!0);
TFL.widget("dropdown",{defaults:{object:"",eventType:"hover",delegate:"body",maxWidth:!1,maxHeight:!1,useReverse:!0,open:null,delay:0,close:null},_init:function(){var e=this,o=e.options;o.object?"hover"===o.eventType?e._bindHover(o.delegate,o.object):"click"===o.eventType&&e._bindClick(o.delegate,o.object+"> .dropdown-toggle"):(e._bindHover(o.delegate,"[data-dropdown = 'hover']"),e._bindClick(o.delegate,"[data-dropdown = 'click'] > .dropdown-toggle"))},_bindHover:function(e,o){var t=this;$(e).delegate(o,"mouseenter",function(){TFL.dropdown.clearMenus();var e=$(this),o=parseInt(e.attr("delay"))||t.options.delay;clearTimeout(e.data("t"));var d=setTimeout(function(){e.addClass("dropdown-open"),t._show(e),t._trigger("open",e)},o);e.data("t",d)}).delegate(o,"mouseleave",function(){var e=$(this),o=parseInt(e.attr("out-delay"))||parseInt(e.attr("delay"))||t.options.delay;clearTimeout(e.data("t"));var d=setTimeout(function(){e.removeClass("dropdown-open").trigger("reverse-reset"),t._trigger("close",e)},o);e.data("t",d)}).delegate(o+"> .dropdown-toggle","click",function(){return!1})},_bindClick:function(e,o){var t=this;$(e).delegate(o,"click",function(){var e=$(this),o=e.parent(),d=o.hasClass("dropdown-open");if(!e.hasClass("disabled"))return TFL.dropdown.clearMenus(),d||(o.addClass("dropdown-open"),o.hasClass("btn-dropdown")&&e.addClass("active"),t._show(o),t._trigger("open",o)),!o.hasClass("edit-control")&&o.hasClass("select-dropdown")&&TFL.use("tSelect",function(){TFL.tselect._init(o)}),!1}),$(o).parent().bind("dropdownclose",function(){t.options.close&&t.options.close(this);var e=$(this);e.find("li.drop-hover-item").removeClass("drop-hover-item")}),$(e).delegate(o,"keydown",function(e,o){var t=$(this).parent(),d=t.find("li.drop-hover-item"),n=e.which?e.which:o.keycode;return 40==n&&(t.hasClass("dropdown-open")||$(this).click(),d.length<=0?t.find("li").first().addClass("drop-hover-item"):(d.removeClass("drop-hover-item"),d.next().addClass("drop-hover-item")),t.trigger("item-hover-selected")),38==n&&d.length>0&&(d.removeClass("drop-hover-item"),d.prev().addClass("drop-hover-item"),t.trigger("item-hover-selected")),13==n&&d.length>0?(d.find("a").click(),!1):void 0})},_show:function(e){var o=e.find(".dropdown-menu").length?e.find(".dropdown-menu"):$("body > .select-dropdown").find(".dropdown-menu"),t=o.find("ul"),d=this.options,n=e.hasClass("btn-dropdown"),r=e.hasClass("select-dropdown"),s=parseInt(e.attr("maxwidth"))||d.maxWidth,i=parseInt(e.attr("maxheight"))||d.maxHeight,a={"overflow-x":"hidden","overflow-y":"auto"};if(n){var l=e.find(".dropdown-toggle").outerWidth();if(l>o.outerWidth()){var p=o.outerWidth()-t.outerWidth();t.css("min-width",l-p)}}if(i&&t.css({"max-height":i,"overflow-x":"hidden","overflow-y":"auto"}),s&&!r&&(o.css({"max-width":s}),t.css(a)),TFL.ie.mode(7)&&!r&&(s||i)){t.css({"overflow-x":"","overflow-y":""});var c=t.width();t.css(a),s&&c>s?t.css("min-width",s-6):t.css("min-width",c)}if(d.useReverse){if(e.hasClass("dropdown-up"))return;var h=0;if(e.data("dropdown-container")){var v=$(e.data("dropdown-container"));h=v.offset().top+v.height()}else h=document.documentElement.clientHeight;var u=o.height(),w=o.offset().top-$(document).scrollTop()+u+5;w>=h&&u+5<o.offset().top&&e.addClass("dropdown-up"),e.unbind("reverse-reset").bind("reverse-reset",function(){$(this).removeClass("dropdown-up")})}e.hasClass("dropdown-up-force")&&!e.hasClass("dropdown-up")&&e.addClass("dropdown-up")}},!0,!0),TFL.dropdown.clearMenus=function(){$(".dropdown-open").each(function(){var e=$(this);e.removeClass("dropdown-open").trigger("dropdownclose").trigger("reverse-reset"),e.hasClass("btn-dropdown")&&e.find(".btn").removeClass("active")})},TFL.dropdown.init=function(){TFL.dropdown(),$("html").bind("click",function(e){return $(e.target).closest(".tselect-region").length?!1:void TFL.dropdown.clearMenus()})};
TFL.widget("tips",{preloadInstance:null,preloadReferred:0,init:function(){$("body").undelegate("[data-close = 'tips']","click",TFL.tips._initClose).delegate("[data-close = 'tips']","click",TFL.tips._initClose)},_initClose:function(){$(this).parent().fadeOut(200,function(){$(this).trigger("tipsclose").remove()})},showFlash:function(e,s,a){$("#flashMessage").hide();var t=$("#flash_message"),i=void 0==arguments[1]?!0:arguments[1],n=void 0==arguments[2]?8e3:arguments[2];if(t.length<=0&&(t=$('<span id="flash_message" style="display: none;" />'),$("body").append($('<div class="msgbox" />').append(t))),clearTimeout(t.data("time")),t.html(e).fadeIn(500),i){var o=setTimeout(function(){t.fadeOut(500)},n);t.data("time",o)}},hideFlash:function(){$("#flashMessage,#flash_message").hide()},showPreload:function(e){return null!==this.preloadInstance?void(this.preloadReferred+=1):(this.preloadInstance=1,void setTimeout(function(){var s=$("<div id='preload'></div>"),a=e||"正在加载,请稍候...";s.html(a).appendTo($("body")),s.dialog({autoOpen:!1,modal:!0,resizable:!1,draggable:!1,closeOnEscape:!1,width:280,height:80,minHeight:1,bgiframe:!0}),s.prev().remove(),s.dialog("open"),this.preloadInstance=s},50))},hidePreload:function(e){this.preloadReferred>1?this.preloadReferred-=1:(this.preloadReferred=0,this.preloadInstance=null,e?setTimeout(function(){$("#preload").dialog("close").remove()},parseInt(e)):$("#preload").dialog("close").remove())},showMessage:function(e,s,a){var s=void 0==s?"success":s,t=s+"-message",i=void 0==arguments[2]?1e3:arguments[2];$message=$("#"+t),$messageIcon=$('<span class="font font-'+s+'" />'),$message.hide(),$message.length<=0&&($message=$('<span id="'+t+'" class="community-message" style="display: none;" />'),$(".msg-content .msgbox").append($message)),clearTimeout($message.data("time")),$message.html(e).prepend($messageIcon).fadeIn(500);var n=setTimeout(function(){$message.fadeOut(500)},i);$message.data("time",n)}},!0);
TFL.widget("formValidate",{defaultOptions:{skipFocus:!1,beforeValidate:!1,submitBtn:"",skipTips:!1},defaultMessage:{error:"输入错误",valueMissing:{auto:"必填项不能为空",checkbox:"请从选项中至少选择一个",radio:"请从选项中选择一个",select:"请从列表中选择一项"},typeMismatch:{auto:"输入的类型不合法",email:"请输入合法的电子邮件","email-multiple":"请输入用分号分隔的电子邮件",tel:"请输入合法的电话号码",url:"请输入合法的网址",number:"请输入一个数字",integer:"请输入一个整数",digits:"请输入一个数字,不可超过10000,且最多两位小数",month:"请输入月份，例如：2017-3",week:"请输入周，例如：2017-w1",date:"请输入日期，例如：2017-1-7",time:"请输入时间，例如：14:30",datetime:"请示日期和时间，例如：2017-1-7 14:30",color:"请输入7位颜色值，例如：#000000",hanzi:"请输入一个中文",alphanumeric:"请输入一个字母或数字",alphabet:"请输入一个字母"},tooLong:"输入值最大长度为{$maxlengths}个字符",tooShort:"输入值最小长度为{$minlengths}个字符",rangeUnderflow:"输入值必须大于或等于{$min}",rangeOverflow:"输入值必须小于或等于{$max}",patternMismatch:"输入的格式不合法"},constraintAttributes:"type name data-type maxlengths minlengths required min max step pattern placeholder",methodMsgAttributes:{patternMismatch:"pattern-msg",rangeOverflow:"max-msg",rangeUnderflow:"min-msg",tooLong:"maxlengths-msg",tooShort:"minlengths-msg"},validityStatus:!1,init:function(t,e,i){var a=this,r=t?$(t):$("#page-content").find("form");a.defaultOptions=$.extend({},a.defaultOptions,i),a.bindSubmitBtn(r),a.bindFormValidity(r,e)},bindFormValidity:function(t,e){var i=this,a=$(t);if(a.is("form")){var r=i._getInputs(a);r.each(function(){$(this).bind("change.formValidate.tfl",function(){i.checkFieldValidity(this)}).bind("blur.formValidate.tfl",function(){i.checkFieldValidity(this)}).bind("keyup.formValidate.tfl",function(){i.checkFieldValidity(this)})}),a.bind("submit.formValidate.tfl",function(t,r){var n=i._getInputs(a),l=!0,s=!0,o=[];$(n.get().reverse());if(i.defaultOptions.beforeValidate&&e&&e(),n.each(function(){var t=(this.name,!1);t=i.checkFieldValidity(this),t||(l=!1,o.push(this))}),o.length){var d=$(o[0]);i.checkFieldValidity(d),i.defaultOptions.skipFocus?$(d).trigger("focusout"):$(d).focus().trigger("focusout")}if(i.validityStatus=l,!l)return l;if(s=e&&e(),"undefined"!=typeof s&&""!==s&&!s)return s;var u=a.find(".form-action-bottom .btn-primary");if(u.length){var c=u.attr("id");if(a.data("clickedButton","#"+c),!i.loginTypeValidity(a))return!1}var f=a.find("#update_status_btn");return f.length&&(a.data("clickedButton","#update_status_btn"),!i.loginTypeValidity(a))?!1:(TFL.button.disableGroup(a),TFL.button._disableDialog(),"manual"==r&&(l=!1),l)})}else a.each(function(){$(this).bind("change.formValidate.tfl",function(){i.checkFieldValidity(this)}).bind("blur.formValidate.tfl",function(){i.checkFieldValidity(this)}).bind("keyup.formValidate.tfl",function(){i.checkFieldValidity(this)})})},bindSubmitBtn:function(t){var e=this,i=$(t),a=e.defaultOptions.submitBtn;if(a.length)for(var r=a.split(" "),n="",l=0;l<r.length;l++)n=r[l],$(n).bind("click",function(){i.is("form")?i.submit():""})},getValidityStatus:function(t){var e=this,i=$(t);return i.trigger("submit.formValidate.tfl","manual"),e.validityStatus},loginTypeValidity:function(t){var e="1"==TFL.localData.get("isLogin");return e?(TFL.localData.set("isLogin","0"),!0):(TFL.use("UserAccess",function(){TFL.UserAccess.init(t),TFL.UserAccess.check_user_status(t)}),!1)},unbindFormValidity:function(t){var e=$(t);e.unbind("submit.formValidate.tfl")},checkFieldValidity:function(t){var e=this,i=$(t),a=i.val(),r=e.constraintAttributes.split(" "),n=e._getAttrs(i,r),l=e.coreValidate,s={},o=!0;if(i.hasClass("editor-source-obj")){var d=i.attr("id");a=TFL.editor.getInstance(d).html(),a=$.trim(a.replace(/<(?!img|embed).*?>/gi,"").replace(/&nbsp;/gi," ").replace(/\r\n|\n|\r/,"")),$(TFL.editor.getInstance(d).doc.body).unbind("blur.formValidate.tfl").bind("blur.formValidate.tfl",function(){e.checkFieldValidity(i)&&i.data("isValid",!0)&&e.hideValidError(i)}).unbind("keyup.formValidate.tfl").bind("keyup.formValidate.tfl",function(){e.checkFieldValidity(i)&&i.data("isValid",!0)&&e.hideValidError(i)})}for(var u in l)s[u]=l[u](i,a,n);for(var c in s)if(s[c]){o=!1;break}return i.hasClass("lazyeditor-loader")&&i.attr("required")&&(o=!1,s.valueMissing=!0),i.attr("no-validate")&&(o=!0),o?i.data("isValid",!0):i.data("isValid",!1),o?e.hideValidError(i):e.dealValidMessage(i,s),o},dealValidMessage:function(t,e){var i=this,a=$(t),r=a.attr("type"),n=i.defaultMessage,l=a.attr("data-type"),s="";for(var o in e)e[o]&&(o in n?"valueMissing"==o?s=r in n[o]?n[o][r]:n[o].auto:"typeMismatch"==o?s=l in n[o]?n[o][l]:n[o].auto:i._validMessageCustom(a,o)?s=i._validMessageCustom(a,o):(s=n[o],s=i._parseMessage(a,s)):s=n.error);i.showValidError(a,s)},showValidError:function(t,e){var i=this,a=$(t),r=a.attr("type"),n=a.attr("name"),l=a.attr("position"),s=$("#invalid-tips").length?$("#invalid-tips"):$(i.validUiHelper()),o=a.zIndex()>99?a.zIndex():99;if(("radio"==r||"checkbox"==r)&&(a=$($('input[type="'+r+'"][name="'+n+'"]').get().reverse())),a.hasClass("editor-source-obj")&&(a=a.closest(".tfl-editor-wrapper")),a.is(":hidden")){var d=a.parent().children(":visible").first()[0];"undefined"==typeof d&&(d=a.closest(".select-dropdown")[0])}var u="undefined"==typeof d?a:$(d),c=u.offset(),f=u.outerWidth(),p=u.outerHeight(),h=32>p?(32-p)/2:0;$("#invalid-tips").length||i.defaultOptions.skipTips||$("body").append(s),s.css({position:"absolute",top:c.top-h,"z-index":o+1}).find(".cluetip-inner").text(e);var g=$(window).width(),m=$(document).width(),v=s.width();if("undefined"!=typeof l&&/(right|top|left|bottom)/.test(l)){var b="vali-clue-"+l+"-jtip";switch(s.attr("class","cluetip cluetip-jtip"),s.addClass(b),l){case"top":s.css({top:c.top-s.outerHeight()-5,left:c.left,right:"auto"});break;case"right":s.css({left:c.left+f+5,right:"auto"});break;case"left":s.css({left:c.left-v-5,right:"auto"});break;case"bottom":s.css({top:c.top+p+5,left:c.left,right:"auto"})}}else c.left+f+v>g?1e3>m?(s.css({top:p+c.top+5,left:c.left+f-v,right:"auto"}),s.removeClass("vali-clue-right-jtip").addClass("vali-clue-bottom-jtip")):(s.css({right:g-c.left+5,left:"auto"}),s.removeClass("vali-clue-right-jtip").addClass("vali-clue-left-jtip")):(s.css({left:c.left+f+5,right:"auto"}),s.removeClass("vali-clue-left-jtip").addClass("vali-clue-right-jtip"));a.removeClass("valid").addClass("invalid"),u.removeClass("valid").addClass("invalid"),a.bind("focusin.formValidate.tfl",function(){s.hide()}).bind("focusout.formValidate.tfl",function(){a.data("isValid")||s.show()}),u.bind("click.formValidate.tfl",function(){s.hide()}),a[0].addEventListener("DOMNodeRemovedFromDocument",function(){s.hide()})},hideValidError:function(t){var e=$(t),i=e.attr("type"),a=e.attr("name"),r=$("#invalid-tips");if(e.is(":hidden")){var n=e.parent().children(".invalid");n.removeClass("invalid").addClass("valid")}e.attr("select-hack")&&e.closest(".select-dropdown").removeClass("invalid").addClass("valid"),("radio"==i||"checkbox"==i)&&(e=$('input[type="'+i+'"][name="'+a+'"]'),e.each(function(){$(this).data("isValid",!0)})),e.closest(".tfl-editor-wrapper").length&&e.closest(".tfl-editor-wrapper").removeClass("invalid").addClass("valid"),e.removeClass("invalid").addClass("valid"),r.remove()},validUiHelper:function(){return'<div id="invalid-tips" class="cluetip cluetip-jtip vali-clue-right-jtip"><div class="cluetip-outer"><div class="cluetip-inner"></div></div><div class="cluetip-arrows cluetip-arrows-border"></div><div class="cluetip-arrows"></div></div>'},typeValidate:{email:function(t,e){var i="^[a-z0-9._%-]+@([a-z0-9-]+\\.)+[a-z]{2,4}$",a=new RegExp(i,"ig");return a.test(t)},emailMultiple:function(t,e){var i="^[a-z0-9._%-]+@([a-z0-9-]+\\.)+[a-z]{2,4}(;[a-z0-9._%-]+@([a-z0-9-]+\\.)+[a-z]{2,4})*$",a=new RegExp(i,"ig");return a.test(t)},tel:function(t){var e="^\\d([0-9-\\s])*\\d$",i=new RegExp(e);return i.test(t)},url:function(t){var e="^(http|https|ftp)?(\\:\\/\\/)?[_a-z0-9\\-\\.]+\\.[a-z]{2,3}(:[a-z0-9]*)?\\/?([a-z0-9\\-\\._\\?\\,\\'\\/\\\\\\+&amp;%\\$#\\=~])*$",i=new RegExp(e,"ig");return i.test(t)},number:function(t){var e="^\\-?\\d+(\\.\\d+)?$",i=new RegExp(e);return i.test(t)},integer:function(t){var e="^([+-]?)\\d+$",i=new RegExp(e);return i.test(t)},digits:function(t){var e="^[0-9]{0,4}\\.[0-9]{1,2}$|^[0-9]{0,4}$",i=new RegExp(e);return i.test(t)},month:function(t){var e="^\\d{4}[-\\.\\/](([0]?[1-9])|([1][012]))$",i=new RegExp(e);return i.test(t)},week:function(t){var e="^\\d{4}[-\\.\\/]?w(([0]?[1-9])|([5][0-3])|([1-4][0-9]))$",i=new RegExp(e);return i.test(t)},date:function(t){var e="^\\d{4}[-\\.\\/](([0]?[1-9])|([1][012]))[-\\.\\/](([0]?[1-9])|([3][01])|([12][0-9]))$",i=new RegExp(e);return i.test(t)},time:function(t){var e="^((2[0-4])|([01][0-9])):((60)|([0-5][0-9]))$",i=new RegExp(e);return i.test(t)},datetime:function(t){var e="^\\d{4}[-\\.\\/](([0]?[1-9])|([1][012]))[-\\.\\/](([0]?[1-9])|([3][01])|([12][0-9])) ((2[0-4])|([01][0-9])):((60)|([0-5][0-9]))$",i=new RegExp(e);return i.test(t)},color:function(t){var e="^#[a-f0-9]{6}$",i=new RegExp(e);return i.test(t)},hanzi:function(t){var e="^[Α-￥]+$",i=new RegExp(e);return i.test(t)},alphanumeric:function(t){var e="^[0-9a-zA-Z]+$",i=new RegExp(e);return i.test(t)},alphabet:function(t){var e="^[a-zA-Z]+$",i=new RegExp(e);return i.test(t)}},coreValidate:{valueMissing:function(t,e,i){if(null===i.required||"false"===i.required||i.required===!1||"0"===i.required)return!1;if("radio"==i.type||"checkbox"==i.type){var a=TFL.formValidate._findGroup(t),r=!1;return a.filter('[required], [required=""]').length&&a.each(function(){return $(this).is(":checked")?void(r=!0):void 0}),!r}return""===$.trim(e)||$.browser.msie&&$.trim(e)==i.placeholder?!0:!1},typeMismatch:function(t,e,i){if(""===e||!i["data-type"])return!1;var a=i["data-type"],r=TFL.formValidate.typeValidate;return"email-multiple"==a&&(a="emailMultiple"),a in r?!r[a](e,i):!1},patternMismatch:function(t,e,i){if(""===e||!i.pattern)return!1;var a=i.pattern,r=new RegExp(a);return!r.test(e)},tooLong:function(t,e,i){if(""===e||!i.maxlengths)return!1;var a=i.maxlengths,r=e.length;return r>a?!0:!1},tooShort:function(t,e,i){if("checkbox"===i.type){var a=TFL.formValidate._findGroup(t);if(!a.filter("[minlengths]").length)return!1;var r=parseInt(a.filter("[minlengths]").eq(0).attr("minlengths")),n=!1,l=0;return a.each(function(){return $(this).is(":checked")&&(l++,l>=r)?void(n=!0):void 0}),!n}if(""!==e&&i.minlengths){var r=parseInt(i.minlengths);return e.length<r?!0:!1}return!1},rangeUnderflow:function(t,e,i){if(""===e||!i.min)return!1;var a=i.min;return isNaN(e)||parseFloat(e)<parseFloat(a)?!0:!1},rangeOverflow:function(t,e,i){if(""===e||!i.max)return!1;var a=i.max;return isNaN(e)||parseFloat(e)>parseFloat(a)?!0:!1}},_findGroup:function(t){if(t.is(":checkbox, :radio")){var e;return e=t.closest("form").length?t.closest("form"):$("body"),t.attr("name")?e.find('input[name="'+t.attr("name")+'"]'):t}return t},_getInputs:function(t){return $(t).find(":input:not([type=button], [type=submit], [type=reset])")},_getAttrs:function(t,e){for(var i=e.length,a={},r="";i-- >0;)r=e[i],a[r]=this._getAttr(t,r);return a},_getAttr:function(t,e){if(0===$(t).length)return!1;var e=e.toLowerCase(),i=$(t)[0],a=i.getAttribute(e);return a},_validMessageCustom:function(t,e){var i,a,r=this,n=r.methodMsgAttributes;$(t);return i=n[e]?n[e]:"",a=r._getAttr(t,i)?r._getAttr(t,i):""},_parseMessage:function(t,e){var i=$(t);return e.indexOf("$")>=0&&(e=e.replace(/\{\$([a-zA-Z0-9_\.]+)\}/g,function(t){var e=t.replace(/[\{\}\$]/g,"");return i.attr(e)})),e}});
TFL.widget("localData",{isLocalStorage:window.localStorage?!0:!1,set:function(o,e,t){this.isLocalStorage?window.localStorage.setItem(o,e):t?$.cookie(o,e,t):$.cookie(o,e)},get:function(o){return this.isLocalStorage?window.localStorage.getItem(o):$.cookie(o)},remove:function(o){this.isLocalStorage?window.localStorage.removeItem(o):$.cookie(o,null)}}),window.localStorage||$.isFunction($.cookie)||(TFL.register("cookie",{jsUrl:TFL.path+"js/jquery.cookie.js"}),TFL.localData.requireWidgets="cookie");
TFL.widget("cluetip",{init:function(){TFL.use("uiCluetip",function(){TFL.cluetip._bindEvent()})},_bindEvent:function(){var t="[data-control='cluetip']";$("body").delegate(t,"mouseenter",TFL.cluetip._init).delegate(t,"focus",TFL.cluetip._init)},_init:function(t){var i=$(this);if(!i.attr("cluetip-init")){var e={splitTitle:"|",showTitle:!1,sticky:!1,local:!1,activation:"hover",positionBy:"auto",position:"right",tracking:!1,mouseOutClose:!1,width:200,height:"auto",leftOffset:10,dropShadowSteps:6,cluezIndex:1101,theme:"default",titleAttribute:"title",arrows:!0,maxWidth:2e3,minWidth:0,maxHeight:2e3,minHeight:0,clean:!1};if(i.attr("rel")&&(e.splitTitle=""),i.attr("data-title")&&(e.titleAttribute="data-title"),TFL.tagBoolean("arrows",i,!0)||(e.arrows=!1),i.attr("maxwidth")&&(e.maxWidth=i.attr("maxwidth")),i.attr("minwidth")&&(e.minWidth=i.attr("minwidth")),i.attr("maxheight")&&(e.maxHeight=i.attr("maxheight")),i.attr("minheight")&&(e.minHeight=i.attr("minheight")),i.attr("data-clean")&&(e.clean=i.attr("data-clean")),TFL.tagBoolean("local",i,!1)&&(e.local=!0),TFL.tagBoolean("sticky",i,!1)&&(e.sticky=!0,e.mouseOutClose=!0),TFL.tagBoolean("closeico",i,!1)&&(e.sticky=!0,e.showTitle=!0),("click"==i.attr("activation")||"focus"==i.attr("activation"))&&(e.activation=i.attr("activation")),"fixed"==i.attr("positionby")&&(e.positionBy="fixed"),i.attr("position")&&(e.position=i.attr("position"),("top"==i.attr("position")||"bottom"==i.attr("position"))&&(e.positionBy="bottomTop")),TFL.tagBoolean("tracking",i,!1)&&(e.tracking=!0),i.attr("tipwidth")&&(e.width=i.attr("tipwidth")),i.attr("tipheight")&&(e.height=parseInt(i.attr("tipheight")),e.height>1e3&&(e.height="auto")),i.attr("offsetx")?e.leftOffset=parseInt(i.attr("offsetx")):"bottomTop"==e.positionBy&&(e.leftOffset=0),i.attr("offsety")&&(e.topOffset=parseInt(i.attr("offsety"))),"default"!=i.attr("theme")&&(e.theme=i.attr("theme")),"richeditor"==i.attr("tipobject")){var a=i.find("iframe"),o=a.contents().find("body");e.locateObject=i,e.activation="click",e.dropShadowSteps=-5;var l=a.height()-parseInt(o.css("padding-top"))-parseInt(o.css("padding-bottom"))-parseInt(o.css("margin-top"))-parseInt(o.css("margin-bottom"));o.css("height",l).attr("title",i.attr("title")).cluetip(e),i.attr("title",""),$(document).unbind("click",TFL.cluetip.cluetipHide).bind("click",TFL.cluetip.cluetipHide)}else i.cluetip(e);if(i.attr("cluetip-init",!0),"hover"==e.activation)if($.browser.msie&&(e.tracking||!e.splitTitle&&!e.local));else{var c=jQuery.Event("mouseover");c.pageX=t.pageX,c.pageY=t.pageY,i.trigger(c)}}},autoOpen:function(t){var i={relaObject:null,title:"",url:"",html:"",width:200,closeico:!1,position:"right",className:"",valign:"top",hoverShow:!1},e=$.extend(i,t),a=$("<div></div>").addClass("cluetip cluetip-jtip cluetip-autoopen "+e.className).css("width",e.width),o=$("<div></div>").addClass("cluetip-outer"),l=$("<h3></h3>").addClass("cluetip-title"),c=$("<div><a href='javascript:;'>×</a></div>").addClass("cluetip-close"),n=$("<span></span>").addClass("cluetip-title-text"),s=$("<div></div>").addClass("cluetip-inner"),p=$("<div></div>").addClass("cluetip-arrows");e.closeico&&l.append(c)&&this.bindClose(c.find("a")),e.title&&n.html(htmlspecialchars_encode(e.title))&&l.append(n),o.append(l).append(s),a.append(o).append(p),$(e.relaObject).data("tfl-cluetip-autoopen",a);var r=function(){var t,i,o,l=$(e.relaObject),c=l.offset(),n=l.outerWidth(),s=l.outerHeight(),p=a.outerWidth(),r=a.outerHeight(),d=p-n,u=c.left,h=c.left-d/2,f=function(){switch(e.valign){case"top":i=c.top-5,o+=" clue-valign-top";break;case"middle":i=c.top-(r-s)/2,o+=" clue-valign-middle";break;case"bottom":i=c.top-(r-s)+5,o+=" clue-valign-bottom";break;case"auto":}};switch(e.position){case"left":t=u-p-15,i=c.top-5,o="clue-left-jtip",f();break;case"right":t=u+n+15,i=c.top-5,o="clue-right-jtip",f();break;case"top":t=h,i=c.top-r-10,o="clue-top-jtip";break;default:case"bottom":t=h,i=c.top+s+10,o="clue-bottom-jtip"}a.css({left:t,top:i}).addClass(o)},d=function(){a.appendTo("body"),r(),e.onshow&&e.onshow(a)};e.url?s.load(e.url,function(){d()}):(s.html(htmlspecialchars_encode(e.html)),d()),e.hoverShow&&(a.hide(),$(e.relaObject).hover(function(){r(),a.show()},function(){a.hide()}))},bindClose:function(t){$(t).unbind("click").click(function(){$(this).closest(".cluetip-autoopen").remove()})},closeAutoOpen:function(t){var i=$(t).data("tfl-cluetip-autoopen");i&&(i.remove(),$(t).data("tfl-cluetip-autoopen",null))}},!0),TFL.cluetip.cluetipHide=function(){$("#cluetip").attr("doc-click-hide")&&$(document).trigger("hideCluetip.cluetip")};
var init_dk_selects=function(){};TFL.widget("dkselect",{init:function(){TFL.use("plugDkSelect",function(){TFL.dkselect._bindEvent()})},_bindEvent:function(){var t=".tfl-dkselect";$("body").delegate(t,"mouseover",TFL.dkselect._init)},_init:function(t){if(!TFL.ie.mode(6)){var e=$(this);if(!e.attr("enhanced")){var n={};TFL.tagBoolean("inputplus",e,!0)||(n.input_plus=!1),"undefined"!=typeof e.attr("colorblock")&&(n.color_block=e.attr("colorblock")),e.DkSelect(n)}}}},!0);
TFL.widget("confirm",function(){var i=arguments;if(i.length)"object"==typeof i[0]?TFL.confirm.show(i[0],i[1],i[2],i[3]):TFL.confirm.show(t("Tapd_Confirm"),i[0],i[1],i[2]);else{var n="[data-control='confirm'],.tapd-confirm";$("body").undelegate(n,"click",TFL.confirm._init).delegate(n,"click",TFL.confirm._init)}},!0),TFL.widget("alert",function(i,n){var e={title:t("Tapd_Alert"),sure:null};$.isPlainObject(n)?$.extend(e,n):e.fn1=n,TFL.confirm.show(e.title,i,e.sure,"__ALERT__")}),TFL.confirm._init=function(){var i,n=$(this),e=n.attr("href"),o=n.attr("tip"),r=n.attr("callback"),c=n.attr("local"),a=n.attr("onopen"),d=TFL.tagBoolean("lightweight",n,!1),l="";if(r||e){if(c?l=$(c).attr("need_back",!0).show():o&&(o=$("<div/>").text(o).html(),l=o),i=d?n:t("Tapd_Confirm"),TFL.confirm.show(i,l,function(){if(r)try{var t=new Function("return "+r)();t(n)}catch(i){parent.tapdconfirm_response?parent.tapdconfirm_response(n):window.tapdconfirm_response&&tapdconfirm_response(n)}else window.location.href=e}),a){var f=new Function("return "+a)();f(n)}return TFL.dropdown&&TFL.dropdown.clearMenus(),!1}},TFL.confirm.show=function(i,n,e,o){var r=$("#tconfirm"),c=$("#tconfirm-content"),a=$(document);r.length||(r=$("<div id='tconfirm'></div>"),$("body").append(r)),c.length||(c=$("<div id='tconfirm-content'></div>"),r.append('<div id="tconfirm-icon"><i class="font font-warning"></i></div>'),r.append(c)),c.html(n);var d={};d[t("sure")]=function(){e&&e(),r.dialog("close")},"__ALERT__"!=o&&(d[t("cancel")]=function(){o&&o(),r.dialog("close")});var l={width:400,minHeight:150,title:"",simple:!1,lightWeight:!1,trigger:null,open:function(){var t=$(this).closest(".ui-dialog");1===t.find(".ui-dialog-buttonset .btn").length&&t.find(".ui-dialog-close").hide()}};"object"==typeof i?$.extend(l,{width:300,minHeight:100,simple:!0,lightWeight:!0,trigger:i}):l.title=i,r.dialog({width:l.width,minHeight:l.minHeight,title:l.title,simple:l.simple,lightWeight:l.lightWeight,trigger:l.trigger,modal:"white",resizable:!1,customClass:"dialog-confirm",buttons:d,open:l.open,close:function(t,i){"object"==typeof n&&$(n).attr("need_back")&&$(n).hide().appendTo("body"),r.dialog("destroy"),a.trigger("tconfirm-close")}}),a.trigger("tconfirm-open"),$("#tconfirm").next().find(".btn:first-child").addClass("btn-danger")},TFL.confirm.init=function(){TFL.use("uiDialog",function(){TFL.confirm()}),document.ondragstart=function(t){try{var i=$(t.target);if("confirm"==i.attr("data-control")||i.hasClass("tapd-confirm"))return!1}catch(t){}}};
TFL.widget("datepicker",{init:function(){TFL.use("uiDatepicker",function(){var e="[data-control='date'], .tapd-new-date";$("body").delegate(e,"focus",TFL.datepicker._init)}),$(document).bind("dialogClose",function(){$("#ui-datepicker-div").hide()})},_init:function(e){var t=$(this);if(!t.attr("date-init")){var a=t.attr("mindate")||null,i=t.attr("maxdate")||null,n=t.attr("close-callback"),d=t.attr("select-callback"),r=t.attr("date-to"),o=t.attr("date-from"),s=n?function(e,t){var a=new Function("return "+n)();a(e,t)}:null,c=null,u=null,l=null,p=!1;"undefined"!=typeof tui_content_skin&&"lego"===tui_content_skin&&(p=!0),c=d?function(e,a){t.removeClass("input-error");var i=new Function("return "+d)();i(e,a),a.input.change(),t.trigger("onDateSelect")}:function(e,a){t.removeClass("input-error"),a.input.change(),t.trigger("onDateSelect")};var f=window.navigator.userAgent,k=f.indexOf("MSIE "),h=!1;(k>0||f.match(/rv:([\d.]+)\) like Gecko/)||f.indexOf("Edge")>-1)&&(h=!0),u=r||o?function(e,a){var i,n,d=r?r:o,s=$("#"+d);if(s.length)i=s;else if($("input[name='"+d+"']").length)i=$("input[name='"+d+"']");else if(t.closest("table").find('[data-editable-field="'+d+'"]').length){var c=t.closest("table").find('[data-editable-field="'+d+'"]');c.each(function(e,a){if($(this).closest(".tfl-editable").attr("id")===t.closest(".tfl-editable").attr("id"))if($(this).is("th")){var e=$(this).closest("tr").find("th").index($(this));i=t.closest("tr").find("td").eq(e)}else i=$(this).is("td")?t.closest("td").siblings('[data-editable-field="'+d+'"]'):$(this)})}n=r?"sDate":"eDate",i&&TFL.datepicker._beforeShow(n,t,i),a.dpDiv.css("margin-top",""),setTimeout(function(){TFL.datepicker._showQuickDates(e),h&&$(e).blur()},1)}:function(e,t){t.dpDiv.css("margin-top",""),setTimeout(function(){TFL.datepicker._showQuickDates(e),h&&$(e).blur()},1)},l=function(e,t,a){setTimeout(function(){h&&$(a.input).blur(),TFL.datepicker._showQuickDates(a.input)},1)},s=s?s:function(){t.removeClass("input-error")},t.bind("keyup",function(){var e=new RegExp("^\\d{4}[-\\.\\/](([0]?[1-9])|([1][012]))[-\\.\\/](([0]?[1-9])|([3][01])|([12][0-9]))$");e.test(t.val())?t.removeClass("input-error"):t.addClass("input-error"),setTimeout(function(){TFL.datepicker._showQuickDates(t[0])},1)}),t.bind("dateChange",function(e,t){var a=$(e.target),i=$.datepicker._newInst(a);c(t,i)}),TFL.datepicker._config(t,{minDate:a,maxDate:i,showButtonPanel:p,onClose:s,onChangeMonthYear:l,onSelect:c,beforeShow:u})}},_config:function(e,t){var a={dateFormat:"yy-mm-dd",showAnim:"fadeIn",duration:"fast",nextText:"›",prevText:"‹",changeYear:!1,changeMonth:!1,selectOtherMonths:!0,showOtherMonths:!0,monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthNamesShort:["1","2","3","4","5","6","7","8","9","10","11","12"],dayNamesMin:["日","一","二","三","四","五","六"],showButtonPanel:!1},i=$(e);t=$.extend({},a,t),i.datepicker(t).attr("date-init",!0);var n=new RegExp("^((?:(?!0000)[0-9]{4}([-/.])(?:(?:0?[1-9]|1[0-2])([-/.])(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])([-/.])(?:29|30)|(?:0?[13578]|1[02])([-/.])31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.])0?2([-/.])29)|(?:(?!0000)[0-9]{4}([-/.]?)(?:(?:0[1-9]|1[0-2])([-/.]?)(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])([-/.]?)(?:29|30)|(?:0[13578]|1[02])([-/.]?)31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)02([-/.]?)29))$");return i.blur(function(){""==i.val()||n.test(i.val())||i.val("")}),i},_beforeShow:function(e,t,a){var i=t.val(),n=a.is("input")?a.val():"--"==$.trim(a.text())?"":$.trim(a.text());"eDate"==e?""!==n?t.datepicker("option","minDate",n):t.datepicker("option","minDate",null):t.unbind("onDateSelect").bind("onDateSelect",function(){var e=a.is("input")?a.val():"--"==$.trim(a.text())?"":$.trim(a.text());TFL.datepicker._compareDay(t.val(),e)<0&&setTimeout(function(){a.is("input")?($(a).attr("date-init")||$(a).trigger("focus"),setTimeout(function(){a.datepicker("show")},10)):a.dblclick()},0)}),""==n&&t.datepicker("option","defaultDate",null),""==i&&""!==n&&t.datepicker("option","defaultDate",n)},_showQuickDates:function(e){var t=$(e),a=t.datepicker("widget").find(".ui-datepicker-buttonpane").hide();if(!a.length)return!1;t.datepicker("widget").addClass("enhanced-buttonpane");var i,n,d,r,o,s;i=t.datepicker("option","minDate"),n=new Date,d=$.datepicker.formatDate("yy-mm-dd",n),r=new Date,r.setDate(n.getDate()+1),o=$.datepicker.formatDate("yy-mm-dd",r),s=$.datepicker.formatDate("yy-mm-dd",new Date(864e5*(5-n.getDay())+n.getTime()));var c=$("<button>",{text:"今天",click:function(){if($(this).hasClass("ui-state-disabled"))return!1;var e=new Date;t.datepicker("setDate",e).trigger("onDateSelect").trigger("dateChange",t.val()),t.datepicker("widget").find(".ui-datepicker-buttonpane").hide(),setTimeout(function(){t.datepicker("hide"),$("#ui-datepicker-div").hide()},10)}}),u=$("<button>",{text:"明天",click:function(){return $(this).hasClass("ui-state-disabled")?!1:(t.datepicker("setDate","+1d").trigger("onDateSelect").trigger("dateChange",t.val()),t.datepicker("widget").find(".ui-datepicker-buttonpane").hide(),void setTimeout(function(){t.datepicker("hide"),$("#ui-datepicker-div").hide()},10))}}),l=$("<button>",{text:"本周五",click:function(){if($(this).hasClass("ui-state-disabled"))return!1;var e=new Date,a=e.getDay(),i=new Date(864e5*(5-a)+e.getTime());t.datepicker("setDate",i).trigger("onDateSelect").trigger("dateChange",t.val()),t.datepicker("widget").find(".ui-datepicker-buttonpane").hide(),setTimeout(function(){t.datepicker("hide"),$("#ui-datepicker-div").hide()},10)}}),p=$("<button>",{text:"清空",click:function(){$.datepicker._clearDate(e)}});a&&(a.html(""),c.appendTo(a).addClass("ui-state-default ui-datepicker-current ui-datepicker-button"),u.appendTo(a).addClass("ui-state-default ui-datepicker-current ui-datepicker-button"),l.appendTo(a).addClass("ui-state-default ui-datepicker-current ui-datepicker-button"),p.appendTo(a).addClass("ui-state-default ui-datepicker-button")),i&&TFL.datepicker._compareDay(i,d)<0?c.addClass("ui-state-disabled"):c.removeClass("ui-state-disabled"),i&&TFL.datepicker._compareDay(i,o)<0?u.addClass("ui-state-disabled"):u.removeClass("ui-state-disabled"),i&&TFL.datepicker._compareDay(i,s)<0?l.addClass("ui-state-disabled"):l.removeClass("ui-state-disabled"),a.show()},_compareDay:function(e,t){if(!t||!e)return 1;var a=e.split("-"),i=t.split("-"),n=new Date(a[0],a[1],a[2]),d=new Date(i[0],i[1],i[2]);return Date.parse(d)-Date.parse(n)}},!0);
TFL.widget("datetimepicker",{init:function(){TFL.use("uiDatepicker",function(){var e='[data-control="datetime"]';$(document).delegate(e,"focus",TFL.datetimepicker._init)}),$(document).bind("dialogClose",function(){$("#ui-datepicker-div").hide()})},_init:function(){var e=$(this);e.attr("readonly",!0);var t=e.attr("mindate")||null,i=e.attr("maxdate")||null,a=e.attr("close-callback"),n=e.attr("select-callback"),r=e.attr("date-to"),d=e.attr("date-from"),c=a?function(e,t){var i=new Function("return "+a)();i(e,t)}:null,o=null,p=null,u=null,m=!1;TFL.datetimepicker.input=e,TFL.datetimepicker.ui=e.datepicker("widget"),TFL.datetimepicker.selectFun=n,"undefined"!=typeof tui_content_skin&&"lego"===tui_content_skin&&(m=!0),o=function(e,t){t.inline=!0,TFL.datetimepicker.datetime.date=TFL.datetimepicker._getDate(t.input),TFL.datetimepicker.update()},p=function(t,i){var a,n,c=TFL.datetimepicker.input;if(TFL.datetimepicker.lastVal=c.val(),r){var o=$("#"+r);a=o.length?o:$("input[name='"+r+"']"),n="sDate"}else if(d){var p=$("#"+d);a=p.length?p:$("input[name='"+d+"']"),n="eDate"}else a=$(),n="";TFL.datetimepicker._initDatetime(n,e,a),TFL.datetimepicker.update(!0)},u=function(e,t,i){TFL.datetimepicker.update()},c=function(e,t){var i=t.input;t.inline=!1,TFL.datetimepicker.cancelReady&&i.trigger("cancelDatetime")},TFL.datetimepicker._config(e,{minDate:t,maxDate:i,showButtonPanel:m,onClose:c,onChangeMonthYear:u,onSelect:o,beforeShow:p})},_config:function(e,t){var i={inline:!0,dateFormat:"yy-mm-dd",showAnim:"fadeIn",duration:"fast",nextText:"›",prevText:"‹",changeYear:!1,changeMonth:!1,selectOtherMonths:!0,showOtherMonths:!0,monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthNamesShort:["1","2","3","4","5","6","7","8","9","10","11","12"],dayNamesMin:["日","一","二","三","四","五","六"],showButtonPanel:!1},a=e;return t=$.extend({},i,t),a.datepicker(t),a},_getDateTime:function(e){if(/^\d{4}-\d{1,2}-\d{1,2}\s\d{1,2}:\d{1,2}$/gi.test(e)){var t=e.split(" ")[0],i=e.split(" ")[1],a=i.split(":"),n=a[0],r=a[1];return{date:t,hour:n,minute:r}}return null},_initDatetime:function(e,t,i){var a=t.val(),n=i.val();if(TFL.datetimepicker.datetime=TFL.datetimepicker._getDateTime(a),!TFL.datetimepicker.datetime){var r=new Date;TFL.datetimepicker.datetime={date:$.datepicker.formatDate("yy-mm-dd",r),hour:r.getHours()/10>=1?r.getHours().toString():"0"+r.getHours(),minute:r.getMinutes()/10>=1?r.getMinutes().toString():"0"+r.getMinutes()}}TFL.datetimepicker.relDatetime=TFL.datetimepicker._getDateTime(n),TFL.datetimepicker.dateType=e,TFL.datetimepicker.cancelReady=!0;var d=TFL.datetimepicker.relDatetime,c=d?d.date:null;TFL.datetimepicker._setDateDisabled(c,e)},_showQuickDates:function(){var e=TFL.datetimepicker.input,t=TFL.datetimepicker.ui,i=t.find(".ui-datepicker-buttonpane").hide();if(!i.length)return!1;t.addClass("enhanced-buttonpane");var a=$("<button>",{text:"今天",click:function(){if($(this).hasClass("ui-state-disabled"))return!1;var t=new Date;e.datepicker("setDate",t),TFL.datetimepicker.datetime.date=TFL.datetimepicker._getDate(),TFL.datetimepicker.update()}}),n=$("<button>",{text:"明天",click:function(){return $(this).hasClass("ui-state-disabled")?!1:(e.datepicker("setDate","+1d"),TFL.datetimepicker.datetime.date=TFL.datetimepicker._getDate(),void TFL.datetimepicker.update())}}),r=$("<button>",{text:"本周五",click:function(){if($(this).hasClass("ui-state-disabled"))return!1;var t=new Date,i=t.getDay(),a=new Date(864e5*(5-i)+t.getTime());e.datepicker("setDate",a),TFL.datetimepicker.datetime.date=TFL.datetimepicker._getDate(),TFL.datetimepicker.update()}}),d=$("<button>",{text:"清空",click:function(){e.data("datepicker");e.val(""),e.datepicker("hide"),e.trigger("afterDatetime")}});i&&(i.html(""),a.appendTo(i).addClass("ui-state-default ui-datepicker-current ui-datepicker-button"),n.appendTo(i).addClass("ui-state-default ui-datepicker-current ui-datepicker-button"),r.appendTo(i).addClass("ui-state-default ui-datepicker-current ui-datepicker-button"),d.appendTo(i).addClass("ui-state-default ui-datepicker-button")),i.show()},_showTime:function(){var e=$("<select>",{attr:{"class":"hour"},html:function(){for(var e="",t=0;24>t;t++)e+=10>t?"<option>0"+t+"</option>":"<option>"+t+"</option>";return e},change:function(){TFL.datetimepicker.datetime.hour=$(this).val(),TFL.datetimepicker.update()}}),t=$("<select>",{attr:{"class":"minute"},html:function(){for(var e="",t=0;60>t;t++)e+=10>t?"<option>0"+t+"</option>":"<option>"+t+"</option>";return e},change:function(){TFL.datetimepicker.datetime.minute=$(this).val()}});e.find("option:eq("+TFL.datetimepicker.datetime.hour+")").prop("selected",!0),t.find("option:eq("+TFL.datetimepicker.datetime.minute+")").prop("selected",!0),$container=$('<div class="timeCon"></div>').append(e).append(t),TFL.datetimepicker.ui.append($container)},_showButtonPane:function(){var e=TFL.datetimepicker.input,t=TFL.datetimepicker.ui,i=e.data("datepicker"),a=$("<button>",{text:"确认",click:function(t){if(TFL.datetimepicker.selectFun){var a=new Function("return "+TFL.datetimepicker.selectFun)();a(TFL.datetimepicker.date,i)}var n=TFL.datetimepicker.datetime.hour,r=TFL.datetimepicker.datetime.minute,d=TFL.datetimepicker.datetime.date;return null==n?(alert("您选择的小时是不可用的，请重新选择"),!1):null==r?(alert("您选择的分钟是不可用的，请重新选择"),!1):(e.val(d+" "+n+":"+r),TFL.datetimepicker.cancelReady=!1,e.datepicker("hide"),e.trigger("afterDatetime"),void i.input.change())}}),n=$('<span class="btn btn-primary"></span>').append(a);t.find(".timeCon").append(n)},update:function(e){var t=TFL.datetimepicker.datetime,i=TFL.datetimepicker.relDatetime,a=TFL.datetimepicker.dateType,n=TFL.datetimepicker.input,r=i?i.date:null,d=r?r:t.date;e&&!n.datepicker("getDate")&&(n.datepicker("setDate",d),TFL.datetimepicker.datetime.date=d),TFL.datetimepicker._setLastVal(e),setTimeout(function(){0===TFL.datetimepicker.ui.find(".timeCon").length&&(TFL.datetimepicker._showTime(),TFL.datetimepicker._showButtonPane()),TFL.datetimepicker._setTimeDisabled(t,i,a),TFL.datetimepicker._selectAbledOpt(),TFL.datetimepicker._showQuickDates(),TFL.datetimepicker._setPosition()},0)},_selectAbledOpt:function(){var e=TFL.datetimepicker.ui,t=e.find(".hour"),i=e.find(".minute");t.find("option:selected").prop("disabled")&&(t.find("option").eq(TFL.datetimepicker.relDatetime.hour).prop("selected",!0),t.change(),TFL.datetimepicker.datetime.hour=TFL.datetimepicker.relDatetime.hour),i.find("option:selected").prop("disabled")&&(i.find("option").eq(TFL.datetimepicker.relDatetime.minute).prop("selected",!0),TFL.datetimepicker.datetime.minute=TFL.datetimepicker.relDatetime.minute)},_setPosition:function(){var e=TFL.datetimepicker.input,t=TFL.datetimepicker.ui,i=t.find(".timeCon"),a=e.offset().top,n=t.offset().top;t.css("margin-top",""),parseInt(t.css("top"))>i.outerHeight()&&a>n&&t.css("margin-top",-1*i.outerHeight()+"px")},_getDate:function(){var e=TFL.datetimepicker.input,t=e.data("datepicker");return year=t.currentYear,month=t.currentMonth+1,day=t.currentDay,0==year&&(year=t.selectedYear,month=t.selectedMonth+1,day=t.selectedDay),month=month/10>=1?month:"0"+month,day=day/10>=1?day:"0"+day,year+"-"+month+"-"+day},_setLastVal:function(e){TFL.datetimepicker.input.val(TFL.datetimepicker.lastVal)},_setMinHour:function(e){for(var t=TFL.datetimepicker.ui,i=t.find(".hour")[0].options,a=0;a<i.length&&e>a;a++)$(i[a]).prop("disabled",!0)},_setMinMin:function(e){for(var t=TFL.datetimepicker.ui,i=t.find(".minute")[0].options,a=0;a<i.length&&e>a;a++)$(i[a]).prop("disabled",!0)},_setMaxHour:function(e){for(var t=TFL.datetimepicker.ui,i=t.find(".hour")[0].options,a=0;a<i.length;a++)a>e&&$(i[a]).prop("disabled",!0)},_setMaxMin:function(e){for(var t=TFL.datetimepicker.ui,i=t.find(".minute")[0].options,a=0;a<i.length;a++)a>e&&$(i[a]).prop("disabled",!0)},_ableTime:function(e){var t=TFL.datetimepicker.ui,i=t.find(".hour")[0].options,a=t.find(".minute")[0].options;if("both"===e||"hour"===e)for(var n=0;n<i.length;n++)$(i[n]).prop("disabled",!1);if("both"===e||"min"===e)for(var n=0;n<a.length;n++)$(a[n]).prop("disabled",!1)},_compareDayTime:function(e,t){return e&&t?e.date!=t.date?0:e.hour!=t.hour?1:2:-1},_setTimeDisabled:function(e,t){var i=TFL.datetimepicker.datetime,e=TFL.datetimepicker.relDatetime,t=TFL.datetimepicker.dateType,a=TFL.datetimepicker._compareDayTime(i,e);TFL.datetimepicker._ableTime("both"),0!=a&&-1!=a&&("sDate"==t?((1==a||2==a)&&TFL.datetimepicker._setMaxHour(e.hour),2==a&&TFL.datetimepicker._setMaxMin(e.minute)):"eDate"==t&&((1==a||2==a)&&TFL.datetimepicker._setMinHour(e.hour),2==a&&TFL.datetimepicker._setMinMin(e.minute)))},_setDateDisabled:function(e,t){var i=TFL.datetimepicker.input;"eDate"==t?i.datepicker("option","minDate",e):"sDate"==t&&i.datepicker("option","maxDate",e)}},!0);
TFL.widget("daterangepicker",{inputElm:null,dpDiv:null,init:function(){var e='[data-control="daterangepicker"]';$(e).bind("click",TFL.daterangepicker.showRangePicker),$(document).bind("dialogClose",function(){$("#ui-datepicker-div").hide()})},showRangePicker:function(e){var a=e.target;if($(a).attr("hasDataRangePicker"))return!1;inputElm=a;var t=a.offsetLeft+a.offsetWidth-410;dpDiv=$("<div></div>"),$(dpDiv).attr("style","position:absolute;top:100%;display:block;z-index:10;background-color:#ffffff;border:1px solid #c3c6c7;border-radius:3px;width:410px;"),$(dpDiv).offset({left:t}),$(dpDiv).addClass("daterangepicker-div");var n=$("<div></div>"),i=$('<div id="daterange-begin" style="display:inline"></div>'),r=$('<div id="daterange-end" style="display:inline"></div>');$(n).append(i),$(n).append(r);var d=$('<div align="right" style="margin:4px 0;"></div>'),c=$('<a href="javascript:;" class="recent-days" days-num="7"><span style="margin-right:8px;font-size:12px;">最近7天</span></a>'),p=$('<a href="javascript:;" class="recent-days" days-num="14" style="margin-right:200px;"><span style="font-size:12px;">最近14天</span></a>'),s=$('<a href="javascript:;" class="btn btn-primary" id="daterange-confirm"><span style="font-size:12px;">确认</span></a>'),o=$('<a href="javascript:;" class="btn" id="daterange-cancel"><span style="font-size:12px;">取消</span></a>');d.append(c),d.append(p),d.append(s),d.append(o),dpDiv.append(n),dpDiv.append(d),$(a).after(dpDiv),$(a).attr("hasDataRangePicker","true"),TFL.use("uiDatepicker",function(){TFL.daterangepicker._init("daterange-begin",$(a).attr("date-begin")),TFL.daterangepicker._init("daterange-end",$(a).attr("date-end"),$(a).attr("date-begin"))}),$("#daterange-confirm").bind("click",TFL.daterangepicker.setRange),$("#daterange-cancel").bind("click",TFL.daterangepicker.cancel),$(".recent-days").bind("click",TFL.daterangepicker.recentDays),$(document).on("mousedown",function(e){$(e.target).closest(".daterangepicker-div").length||$(e.target).attr("id")==$(a).attr("id")||TFL.daterangepicker.cancel(e)})},hideRangePicker:function(e){$(inputElm).removeAttr("hasDataRangePicker"),$(dpDiv).remove()},cancel:function(e){TFL.daterangepicker.hideRangePicker(e)},setRange:function(e){var a=inputElm,t=$("#daterange-begin").datepicker({dateFormat:"yy-mm-dd"}).val(),n=$("#daterange-end").datepicker({dateFormat:"yy-mm-dd"}).val();if($(a).attr("date-begin",t),$(a).attr("date-end",n),$(a).val(t+" ~ "+n),$(a).attr("confirm-callback")){var i=new Function($(a).attr("confirm-callback"));i()}TFL.daterangepicker.hideRangePicker(e)},recentDays:function(e){var a=$(e.target).closest(".recent-days"),t=$(a).attr("days-num");(!t||0>=t)&&(t=7);var n=new Date,i=new Date;i.setDate(n.getDate()-t+1);var r=$.datepicker.formatDate("yy-mm-dd",i),d=$.datepicker.formatDate("yy-mm-dd",n);$("#daterange-begin").datepicker("setDate",r),$("#daterange-end").datepicker("setDate",d),$("#daterange-end").datepicker("option",{minDate:r}),$("#daterange-begin").datepicker("refresh"),$("#daterange-end").datepicker("refresh")},_init:function(e,a,t){var n=$("#"+e);if(!n.attr("date-init")){var i=function(){if("daterange-begin"==$(this).attr("id")){var e=$(this).datepicker({dateFormat:"yy-mm-dd"}).val();$("#daterange-end").datepicker("option",{minDate:e}),$("#daterange-end").datepicker("refresh")}};TFL.daterangepicker._config(n,{defaultDate:a,onSelect:i,minDate:t})}},_config:function(e,a){var t={dateFormat:"yy-mm-dd",showAnim:"fadeIn",duration:"fast",nextText:"›",prevText:"‹",changeYear:!1,changeMonth:!1,selectOtherMonths:!0,showOtherMonths:!0,monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthNamesShort:["1","2","3","4","5","6","7","8","9","10","11","12"],dayNamesMin:["日","一","二","三","四","五","六"],showButtonPanel:!1,inline:!0},n=$(e);a=$.extend({},t,a),n.datepicker(a);var i=new RegExp("^((?:(?!0000)[0-9]{4}([-/.])(?:(?:0?[1-9]|1[0-2])([-/.])(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])([-/.])(?:29|30)|(?:0?[13578]|1[02])([-/.])31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.])0?2([-/.])29)|(?:(?!0000)[0-9]{4}([-/.]?)(?:(?:0[1-9]|1[0-2])([-/.]?)(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])([-/.]?)(?:29|30)|(?:0[13578]|1[02])([-/.]?)31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)02([-/.]?)29))$");return n.blur(function(){""==n.val()||i.test(n.val())||n.val("")}),n}},!0);
TFL.widget("field",{create:function(e,t,a,r,n,i){switch(e){case"text":case"int":case"smallint":case"integer":case"float":return this.createText(t,a,n);case"number":return this.createNumber(t,a,n);case"textarea":return this.createTextarea(t,a,n);case"date":return this.createDate(t,a,i);case"datetime":return this.createDatetime(t,a);case"date-between":return this.createDateBetween(t,a);case"datetime-between":return this.createDatetimeBetween(t,a);case"select":return this.createSelect(t,a,r,n);case"dkselect":return-1!==t.indexOf("custom_field_")?this.createTSelectMultiple(t,a,r,n,i):this.createDkSelect(t,a,r,n,i);case"dkselect-editable":return this.createDkSelectEditable(t,a,r,n);case"tselect":return this.createTSelect(t,a,r,n);case"multi_select":case"tselect-multiple":return this.createTSelectMultiple(t,a,r,n,i);case"checkbox":return this.createCheckbox(t,a,r);case"radio":return this.createRadio(t,a,r);case"userchooser":return this.createUserChooser("1",t,a,r);case"pinyinuserchooser":return this.createUserChooserPinyin("1",t,a,r);case"mixchooser":return this.createUserChooser("3",t,a,r);case"avatarlist":return this.createAvatarList(t,a,r);case"tree_select":return this.createTreeSelectText(t,a,n,r);case"digits":return this.createDigits(t,a);default:return}},initAppend:function(e,t){var e=$(e),a=$("<select id='field-recycled"+this.getRecycleId()+"'></select>").hide().insertAfter(e);e.data("recycled",a),e.change(function(){var e=$(this),r=e[0].selectedIndex,n=e.find("option").eq(r),i=n.attr("field-type"),c=e.val(),s=n.attr("default"),d=decodeURIComponent(n.attr("options")),o=n.attr("field-id"),l=TFL.field.create(i,c,s,d,o),u=n.attr("field-label");t(l,{type:i,name:c,value:s,id:o,label:u}),l&&(n.appendTo(a),e.val("empty").blur())})},showAppendItem:function(e,t){var t=$(t),a=$(t).data("recycled");a&&a.find("option").each(function(){var a=$(this);return e==a.val()?(a.appendTo(t),void t.val("empty").blur()):void 0})},createText:function(e,t,a){var r=$("<input type='text'/>");return this._setting(r,e,t,a)},createNumber:function(e,t,a){var r=$("<input type='number'/>");return this._setting(r,e,t,a)},createTreeSelectText:function(e,t,a,r){var n=$("<input type='hidden' id='TreeChooserWrap' class='tree-chooser' data-nodes='"+encodeURIComponent(r)+"' >");return this._setting(n,e,t,a)},createTextarea:function(e,t,a){var r=$("<textarea></textarea>");return r.bind("keydown",function(e){13==e.keyCode&&e.stopPropagation()}),this._setting(r,e,t,a)},createDate:function(e,t,a){!TFL.datepicker&&TFL.use("datePicker");var r=a?a.defaultDate:"",n=$("<input type='text'/>").attr("data-control","date");return""!==r&&(t=r),this._setting(n,e,t)},createDatetime:function(e,t){!TFL.datepicker&&TFL.use("datetimePicker");var a=$("<input type='text'/>").attr("data-control","datetime");return this._setting(a,e,t)},createDateBetween:function(e,t){!TFL.datepicker&&TFL.use("datePicker");var a=$("<input type='text' class='date-between'/>").attr("data-control","date"),r=$("<input type='text' class='date-between'/>").attr("data-control","date");if(e&&(a.attr({name:e+"[begin]","date-to":e+"[end]"}),r.attr({name:e+"[end]","date-from":e+"[begin]"})),t&&-1!=t.indexOf("|")){var n=t.split("|");a.val(n[0]),r.val(n[1])}var i=$([]).add(a).add($("<span class='date-between-to'>to</span>")).add(r);return i},createDatetimeBetween:function(e,t){!TFL.datetimepicker&&TFL.use("datetimePicker");var a=$("<input type='text' class='date-between'/>").attr("data-control","datetime"),r=$("<input type='text' class='date-between'/>").attr("data-control","datetime");if(e&&(a.attr({name:e+"[begin]","date-to":e+"[end]"}),r.attr({name:e+"[end]","date-from":e+"[begin]"})),t&&-1!=t.indexOf("|")){var n=t.split("|");a.val(n[0]),r.val(n[1])}var i=$([]).add(a).add($("<span class='date-between-to'>-</span>")).add(r);return i},createDigits:function(e,t){var a=$("<input type='text' class='digits'/>"),r=$("<input type='text' class='digits'/>");e&&(a.attr({name:e+"[begin]"}),r.attr({name:e+"[end]"}));var n=$([]).add(a).add($("<span class='date-between-to'>to</span>")).add(r);return n},createSelect:function(e,t,a,r){return this._createSelect(1,e,t,a,r)},createDkSelect:function(e,t,a,r,n){return this._createSelect(2,e,t,a,r,n)},createDkSelectEditable:function(e,t,a,r){return this._createSelect(3,e,t,a,r)},createTSelect:function(e,t,a,r){return this._createTSelect(0,e,t,a,r)},createTSelectMultiple:function(e,t,a,r,n){return this._createTSelect(1,e,t,a,r,n)},createCheckbox:function(e,t,a){return this._createGroup("checkbox",e,t,a)},createRadio:function(e,t,a){return this._createGroup("radio",e,t,a)},createUserChooser:function(e,t,a,r){if(isCloud)return this.createUserChooserPinyin(e,t,a,r);!TFL.userchooser&&TFL.use("userChooser"),r&&"undefined"!==r&&"object"!=typeof r&&(r=$.parseJSON(r)),"--"==a&&(a="");var n=t.replace(/\[|\]/g,""),a=a?a:"",i=r&&r.data_source_url||"",c=r&&r.data_source_url_params||"",s=$("<input type='text'/>").attr({"data-control":"pinyinuserchooser",id:n,name:t,"chooser-type":e}).val(a);return i&&s.attr({"data-src-path":i,"data-src-param":c}),s},createUserChooserPinyin:function(e,t,a,r){r&&"undefined"!==r&&"object"!=typeof r&&(r=$.parseJSON(r)),"--"==a&&(a="");var n=t.replace(/\[|\]/g,""),a=a?a:"",i=r&&r.data_source_url||"",c=r&&r.data_source_url_params||"",s=$("<input type='text'/>").attr({"data-control":"pinyinuserchooser",id:n,name:t,"chooser-type":e}).val(a);return i&&s.attr({"data-src-path":i,"data-src-param":c}),s},createAvatarList:function(e,t,a){var r=e.replace(/\[|\]/g,""),t=t?t:"",n=a&&a.data_source_url||"",i=a&&a.data_source_url_params||"",c=$("<div />").attr({id:r,name:e,"class":"tfl-avatar-list","data-avatar-showAddBtn":!0}).val(t);return n&&c.attr({"data-src-path":n,"data-src-param":i}),TFL.avatarList.init(c),c},_setting:function(e,t,a,r){return t&&e.attr("name",t),"undefined"!=typeof a&&(e[0].value=a),TFL.browser.is("ie")&&0!=e.children("option").length&&""==a&&(e.children("option")[0].selected=!0),r&&e.attr("id",r),e},_createSelect:function(e,t,a,r,n,i){var c=$("<select></select>");if(2==e)for(var s in i)c.attr(s,i[s]);if((2==e||3==e)&&!TFL.dkselect&&TFL.use("dkSelect"),2==e&&c.addClass("tfl-dkselect"),3==e&&c.addClass("tfl-dkselect editable"),r&&"undefined"!==r){var d="",o=this.getKeys(r);r=this._jsonDecode(r);for(var l=0;l<o.length;l++){var u=o[l],p=r[u];if(""!==u){var h=$("<option></option>");h.attr({value:u,title:p}),h.text(p),c.append(h)}else d='<option value="" title="空">'+p+"</option>"}d&&c.prepend(d)}return this._setting(c,t,a,n)},_createTSelect:function(e,t,a,r,n,i){!TFL.tselect&&TFL.use("tSelect");var c=$("<div></div>").addClass("select-dropdown").attr("data-dropdown","click"),s=$("<div></div>").addClass("dropdown-toggle"),d=$("<span></span>").addClass("select-dropdown-panel"),o=$("<i></i>").addClass("font font-arrow-down"),l=$("<div></div>").addClass("dropdown-menu"),u=$("<ul></ul>").appendTo(l);$("<div></div>").addClass("dropdown-shadow").appendTo(l);if(n&&c.attr("id",n),r&&"undefined"!==r&&"null"!=r){var p=this.getKeys(r);if(r=this._jsonDecode(r),a&&c.attr("value",a),0==e){t&&c.attr("name",t);for(var h="",f=0;f<p.length;f++){var v=p[f],m=r[v];if(""!==v){var y=$("<li></li>"),g=$("<a></a>");g.attr({href:"javascript:;",value:v,title:m}).text(m),v==a&&d.text(m),y.append(g),u.append(y)}else h='<li><a href="javascript:;" value="" title="空">'+m+"</a></li>"}h&&u.prepend(h)}else if(1==e){for(var b=[],_="|",x=i&&i.separator?i.separator:"|",T=a?a.split(_):"",f=0;f<p.length;f++){var v=p[f],y=$("<li></li>"),m=null!=r[v]?$("<div/>").text(r[v]).html():r[v],g=$("<label></label>").addClass("checkbox").attr("title",m),k=$("<input type='checkbox' class='font font-check-fill'/>");t&&k.attr("name",t+"["+v+"]"),k.val(v);for(var w=0,S=T.length;S>w;w++)v==T[w]&&b.push(m);g.append(k).append(m),y.append(g),u.append(y)}d.html(b.join(x)),c.attr("data-multiple","true"),c.attr("data-separator",x)}}return s.append(d).append(" ").append(o),c.append(s).append(l),c},_createGroup:function(e,t,a,r){var n=$([]);if("checkbox"==e){var i=[];a&&(i=a.split("|"))}if(r&&"undefined"!==r){var c=this.getKeys(r);r=this._jsonDecode(r);for(var s=0;s<c.length;s++){var d=c[s],o=$("<label></label>").addClass(e),l=$("<input type='"+e+"'>"),u="checkbox"==e?t+"["+$("<div/>").text(d).html()+"]":t;if(l=this._setting(l,u,d),"checkbox"==e)for(var p=0;p<i.length;p++)d==i[p]&&(l[0].checked=!0);else d==a&&(l[0].checked=!0);var h=null!=r[d]?$("<div/>").text(r[d]).html():r[d];o.append(l).append(h),n=n.add(o)}}return n},_jsonDecode:function(e,t){return"string"==typeof e?(t&&(e="["+e.replace(/\"\s*,\s*\"/,'"},{"')+"]"),$.parseJSON(e)):e},getKeys:function(e){if("string"==typeof e){for(var t=e.slice(2,-2),a=t.split('","'),r="",n=0;n<=a.length-1;n++)a[n]=a[n].replace(/(\\\"\:)?(\"\:\".*)/gi,function(e,t,a){return"undefined"==typeof t?"":t});return r='["'+a.join('","')+'"]',new Function("return "+r)()}var i=[];for(var c in e)"undefined"!=typeof c&&i.push(c);return i}}),TFL.field.recycleBinId=0,TFL.field.getRecycleId=function(){return++this.recycleBinId};
TFL.widget("filter",{init:function(){$("body").delegate(".filter-toggle","click",TFL.filter.toggle).delegate(".more-filters-toggle","click",TFL.filter.showMore)},toggle:function(e){var t=e?$(this):$(".filter-toggle");t.hasClass("filter-open")?t.removeClass("filter-open").find("i").attr("class","ico-plus-s"):t.addClass("filter-open").find("i").attr("class","ico-minus-s"),t.blur(),$(".filter-panel").toggle()},showMore:function(){var e=$(this),i=$(e.attr("condition-panel")),a=TFL.tagBoolean("check-all",e,!0);if(i.length)if(i.attr("panel-init"))$("#form_workspace_report").length>0&&i.trigger("options","trigger",e),i.dialog("open");else{var n=$(e.attr("filter-panel")),l=new Function("return "+e.attr("callback"))(),o=e.attr("panel-position")||"",r="-10",d=e.attr("load-url"),c={};if(c[t("sure")]=function(){TFL.filter._changeFields(i,n,l)},c[t("cancel")]=function(){i.dialog("close")},"left"==o&&(r=""),$("#form_workspace_report").length>0&&(i=i.dialog("destroy")),i.dialog({simple:!0,trigger:this,width:540,draggable:!1,resizable:!1,offset:r,arrowPosition:o,buttons:c,open:function(e){i.closest(".ui-dialog").find(".ui-dialog-buttonset .btn").first().addClass("btn-primary")}}),d){var f=$("<div/>").addClass("strip-loading2"),s=i.closest(".ui-dialog");TFL.button.disableGroup(s),i.append(f),i.load(d+"?r="+(new Date).getTime(),function(){a&&TFL.filter._setCheckAll(i),TFL.button.enable(s),i.trigger("condition-loaded")})}else a&&TFL.filter._setCheckAll(i);i.attr("panel-init",!0)}},_changeFields:function(e,t,i){e.dialog("close");var a=$([]),n={},l=[];e.find(":checkbox").each(function(){var e=$(this),i=e.attr("value");if(this.checked){if(a=a.add(e.parent()),!t.find("[field-name="+i+"]").length){var o=e.attr("field-type"),r=e.attr("default"),d=decodeURIComponent(e.attr("options")),c=e.attr("field-id"),f="",s=e.attr("field-title"),h=e.attr("field-label");f="checkbox"==o||"radio"==o?TFL.filter._createGroup(o,i,r,d,c):TFL.field.create(o,i,r,d,c),f.hasClass("select-dropdown")&&f.addClass("trigger-tselect"),l.push({obj:f,type:o,name:i,value:r,id:c,label:h,title:s})}}else{t.find("[field-name="+i+"]").length&&t.find("[field-name="+i+"]").remove();var p=parseInt(e.parent().attr("data-category"));n[p]||(n[p]=$([])),n[p]=n[p].add(e.parent())}}),i&&i(l),TFL.filter._fixRemoveTd(t);var o=e.find(".condition-content");o.each(function(e){0===e?$(o[e]).html(a):$(o[e]).html(n[e])})},_createGroup:function(e,t,i,a){var n=$([]);if("checkbox"==e){var l=[];i&&(l=i.split("|"))}if(a&&"undefined"!==a){var o=TFL.field.getKeys(a);a=TFL.field._jsonDecode(a);for(var r=0;r<o.length;r++){var d=o[r],c=$("<div></div>").addClass("input-group-div"),f=$("<input id='"+t+"_"+r+"' class='check-fill-large' type='"+e+"'>"),s="checkbox"==e?t+"["+$("<div/>").text(d).html()+"]":t;if(f=TFL.field._setting(f,s,d),"checkbox"==e)for(var h=0;h<l.length;h++)d==l[h]&&(f[0].checked=!0);else d==i&&(f[0].checked=!0);var p=null!=a[d]?$("<div/>").text(a[d]).html():a[d],u="<label for='"+t+"_"+r+"' class='"+e+"' title='"+p+"'>"+p+"</label>";c.append(f).append(u),n=n.add(c)}}return n},removeItem:function(e){e=$(e);var t=e.attr("field-name"),i=e.closest("[data-remove]"),a=$(i.attr("condition-panel"));a.length||(a=$(".condition-panel")),a.dialog("close");var n=a.find(".condition-content").eq(0),l=a.find(".condition-content").eq(1);n.find(":checkbox").each(function(){var e=$(this);if(e.attr("value")==t){this.checked=!1;var i=parseInt(e.parent().attr("data-category"));i||(i=1),l=a.find(".condition-content").eq(i),l.append(e.parent())}})},_setCheckAll:function(e){e.find("h2").hover(function(){var e=$(this);clearTimeout(e.data("timeout"));var t=setTimeout(function(){e.find("a").length||(e.append("<a href='javascript:;'>全选/反选</a>"),e.find("a").click(function(){$(this).blur();var t=e.next(),i=t.find("input[type='checkbox']");t.find("input[type='checkbox']:checked").length==i.length?i.each(function(){this.checked=!1}):i.each(function(){this.checked=!0})})),e.find("a").show()},100);e.data("timeout",t)},function(){var e=$(this);clearTimeout(e.data("timeout"));var t=setTimeout(function(){e.find("a").hide()},100);e.data("timeout",t)})},_fixRemoveTd:function(e){if("tr"==e.attr("data-remove")){var t=e.find("tr").eq(0);if(0===t.find(".tfl-remove-td").length){var i=$("<td></td>").addClass("tfl-remove-td");t.append(i)}}}},!0);
$.fn.extend({_val:function(t){var e=$(this);return"undefined"==typeof t?e.is(":input")?e.val():e.attr("value"):e.is(":input")?e.val(t):e.attr("value",t)}}),TFL.widget("editable",{init:function(){$("body").undelegate(".tfl-editable","mouseenter",TFL.editable._bind).delegate(".tfl-editable","mouseenter",TFL.editable._bind)},active:function(t){TFL.editable._bind.call(t)},_bind:function(){var t=$(this),e=0;if(!t.attr("editable-init")){var a="[data-editable]";t.delegate(".editable-click-area .editable-value, .editable-click-area .font-edit","click",function(t){t.stopPropagation();var i=+new Date;300>i-e||($(this).is("a")&&-1===["","--"].indexOf($(t.target).text().trim())||(t.preventDefault(),TFL.editable._edit($(this).parents(a))),$(this).hasClass("font-edit")&&(t.preventDefault(),TFL.editable._edit($(this).parents(a))))}).delegate(a,"click",TFL.editable._disableSelection).delegate(a+" a","click",TFL.editable._goHref).delegate(".editable-dropdown-label .font","click",function(t){var i=t.target;if(!$(i).is("i"))return!1;t.stopPropagation(),t.preventDefault();var d=+new Date;300>d-e||(e=d,TFL.editable._edit($(this).parents(a)))}),TFL.tagBoolean("editable-ico-show",t,!0)&&t.delegate(a,"mouseenter",TFL.editable._addEditableClass),$(document).keydown(function(t){t.ctrlKey&&(TFL.editable.onCtrlKey=!0)}).keyup(function(t){TFL.editable.onCtrlKey=!1}),t.attr("editable-init",!0);var i="[data-disabled-tip]";t.delegate(i,"mouseenter",function(){var t=$(this).attr("data-disabled-tip");$(this).attr("title")!==t&&$(this).attr("title",t)})}},_edit:function(t){var e=t,a=e.attr("data-editable");if("disabled"!=a){if(!e[0])return!1;if($("[data-editable]").hasClass("onedit")&&$("[data-editable].onedit").each(function(){TFL.editable._submit(t)}),"tselect"===a&&(a="dkselect",e.attr("data-editable",a)),!e.hasClass("onedit")){e.addClass("onedit");var i=""===$.trim(e.html())?"&nbsp;":e.html(),d=$('<div style="display:inline-block"></div>').addClass("edit-original").html(i),l=e.find(".editable-value"),r=decodeURIComponent(TFL.editable._getAttribute(e,"data-editable-options")),n=$(document.createElement("div")),s=e.attr("data-editable-value"),o=e.width(),c=e.data("editable-height"),u=e.data("editable-afterrender");void 0==s&&l.length>0&&(s=l.attr("data-editable-value")?l.attr("data-editable-value"):$.trim(l.text())),n.html(s),s=n.text();var f=TFL.editable._getAttribute(e,"data-editable-field");if("feature"==f){var b=TFL.editable._getAttribute(e,"data-filter-url");$.ajax({type:"POST",dataType:"json",url:b+"?r="+(new Date).getTime(),async:!1,data:"",success:function(t){1==t.success&&(r=t.data)}}).done(function(){"undefined"!=typeof headFloat&&window.headFloat.init()})}e.data("original-value",s).html("").append(d),d.css("visibility","hidden"),TFL.editable._createControl(e,d,a,s,r,o,c,u),e.trigger("onedit")}return!1}},_objToArray:function(t){var e=[];for(var a in t)""!=a&&e.push(t[a]);return e},_createControl:function(t,e,a,i,d,l,r,n){var s,o=r?r:t.is("td")?21:0===e.height()?21:e.height(),c=(t.is("td")?1:0,$("<div></div>").addClass("edit-control-wrap").css({height:o})),u=TFL.editable._getAttribute(t,"data-editable-setting"),f="tselect-multiple"==a,b="dkselect"==a,p="treeselect"==a,h="avatarlist"==a,v="userchooser"==a||"pinyinuserchooser"==a||"mixchooser"==a;if(u&&(u=$.parseJSON(decodeURIComponent(u))),p){var g=d;s=$('<input type="hidden">').val(i),c.append(s),t.prepend(c.css("position","absolute")),TFL.use("TreeChooser-hebe",function(){g=jQuery.parseJSON(g),"[object Object]"===Object.prototype.toString.call(g)&&(g=TFL.editable._objToArray(g));var e=TFL.TreeChooser();e.init(s,{filter:!0},g),e.$name.data("validation",1).addClass("edit-control").css({width:l-20}),c.find(".treechooser-wrap").css({position:"absolute",height:"28px","z-index":"500"}).bind("TreeChooserselect",function(){TFL.editable._submit(t)}).bind("TreeChooserclose",function(){TFL.editable._submit(t)}),setTimeout(function(){e.openPanel()},100)})}else if(f){var m=d,w=TFL.ie.mode()<8?29:25,_=100;s=TFL.field.create(a,"",i,m,void 0,u),s.data("validation",1).addClass("edit-control").css({position:"absolute"}),l-w>0&&(s.find(".select-dropdown-panel").css("min-width",l-w),TFL.ie.mode()>7&&s.css("min-width",l)),c.append(s),t.prepend(c.css("position","absolute")),TFL.editable._fixWidth(s),s.bind("tselect-change",function(){TFL.editable._validate(t,$(this)),TFL.editable._fixWidth(s)}).bind("dropdownclose",function(){TFL.editable._submit(t)}),TFL.ie.isTrue?TFL.editable._showTselectList(s):setTimeout(function(){TFL.editable._showTselectList(s)},_)}else if(b){var T=t.is("td")?125:160;T>l&&(l=T),s=TFL.field.create(a,"",i,d,"",u),s.data("validation",1).addClass("edit-control"),s.css("width",l),c.append(s),t.prepend(c.css("position","absolute")),s.trigger("mouseover"),s.bind("change",function(){TFL.editable._submit(t)}).bind("close.dkselect",function(){TFL.editable._submit(t)}),setTimeout(function(){s.next().click()},100)}else if(v){var F=v?TFL.editable._getAttribute(t,"data-editable-field")+(new Date).getTime():"",T=t.is("td")?60:160;T>l&&(l=T),s=TFL.field.create(a,F,i,d),s.attr("skin","old"),s.attr("autohide","false"),s.data("validation",1).addClass("edit-control").css({position:"absolute","z-index":"500",height:"28px",width:l-20}),c.append(s),t.prepend(c.css("position","absolute")),s.on("blur",function(){var e=TFL.editable._validate(t,$(this));return e?void($("#recent-user-panel").is(":visible")||setTimeout(function(){!$("#tat_table").length&&TFL.editable._submit(t)},150)):!1}).on("keyup",function(){TFL.editable._validate(t,$(this))}),TFL.pinyinuserchooser.active("#"+F,!0),setTimeout(function(){var t=s[0],e=i.length;t.value.length!=e&&(e=t.value.length),TFL.editable._setCaret(t,e),"undefined"!=typeof $("#"+F+"Value")&&$("#"+F+"Value").focus()},0)}else if(h){if(t.attr("data-avatar-editablereload"))return!1;e.css("visibility","visible");var L=TFL.editable._getAttribute(t,"data-editable-field"),x=TFL.editable._getAttribute(t,"data-editable-change"),y=TFL.editable._getAttribute(t,"editable-url"),C=t.closest("[data-editable-params]").data("editable-params");d=d&&"undefined"!==d?jQuery.parseJSON(d):{},t.addClass("tfl-avatar-list"),t.attr("data-avatar-users",i),t.attr("data-avatar-sendparams",JSON.stringify({"data[id]":C["data[id]"],"data[field]":L})),t.attr("data-avatar-sendkeyname","data[value]"),t.attr("data-avatar-hiddenname",""),t.attr("data-avatar-skin",enableAvatar?"new":"old"),t.attr("data-avatar-imgwidth",d.imgWidth),t.attr("data-avatar-imgheight",d.imgHeight),t.attr("data-avatar-sendurl",y),t.attr("data-avatar-imgbaseurl",fileBasePath+_workspace_id+"/users/avatar/"),t.attr("data-avatar-editauthority",!0),t.attr("data-avatar-autosubmit",!0),t.attr("data-avatar-defaultimg",fileBasePath+"img/avatar.jpg"),t.attr("data-avatar-callback-didchange",x),t.attr("data-avatar-editablereload",!0),d.data_source_url&&t.attr("data-src-path",d.data_source_url),d.data_source_url_params&&t.attr("data-src-param",d.data_source_url_params),d.chooser_type&&t.attr("chooser-type",d.chooser_type),TFL.avatarList.init(t),setTimeout(function(){t.find(".avatar:first").click().end().find(".avatar-text:first").click()},650)}else{var k=TFL.editable._getAttribute(t,"data-editable-field"),F="",A="",E="url"==a||"digits"==a||"int"==a||"float"==a||"integer"==a||"smallint"==a?"text":a,T=t.is("td")?60:160;T>l&&(l=T),("digits"==a||"int"==a)&&(i=TFL.editable._getDigitsUnit(i,"digits")),s=TFL.field.create(E,F,i,A,void 0,u),s.data("validation",1).addClass("edit-control").css({position:"absolute","z-index":"500",height:"28px",width:l-20}),"textarea"===E&&s.height(o).addClass("webkit-scrollbar"),"begin"==k?s.attr("date-to","due"):"due"==k&&s.attr("date-from","begin"),c.append(s),t.prepend(c.css({position:"absolute"})),"undefined"!=typeof n&&"undefined"!==window[n]&&window[n](),"date"!==a&&"datetime"!==a&&s.on("blur keyup",function(e){if("blur"!=e.type&&("keyup"!=e.type||13!=e.keyCode))return!1;if("text"==E||"textarea"==E){if("textarea"==E&&"keyup"==e.type)return!1;var a=TFL.editable._validate(t,$(this));if(!a)return!1;TFL.editable._submit(t)}}),setTimeout(function(){var e=s[0],d=i.length,l=+new Date;if(TFL.editable._setCaret(e,d),"date"==a)var r=setInterval(function(){if("true"==s.attr("date-init")){clearInterval(r),s.datepicker("show");var a=$("#ui-datepicker-div");a.removeAttr("onhover"),a.attr("mouseenter-init")||(a.mouseenter(function(){$(this).attr("onhover",!0)}).mouseleave(function(){$(this).removeAttr("onhover")}),a.attr("mouseenter-init",!0)),s.on("onDateSelect",function(){TFL.editable._validate(t,$(this));TFL.editable._submit(t)}).on("keyup",function(){a.removeAttr("onhover")}).on("blur",function(){if(+new Date-l<300)return void TFL.editable._setCaret(e,d);if(!a.attr("onhover")){var i=TFL.editable._validate(t,$(this));i&&TFL.editable._submit(t)}})}},50);else"datetime"===a&&s.bind("afterDatetime cancelDatetime",function(){var e=TFL.editable._validate(t,$(this));e&&TFL.editable._submit(t)})},0)}},_iconOffset:function(t,e){var a,i=t.find(".editable-value"),d=t.offset(),l=i.offset(),r=0,n="12px",s="normal",o=t.attr("data-editable-value"),c="tselect-multiple"==e,u="dkselect"==e||"tselect"==e,f="treeselect"==e,b="disabled"==e;r+="undefined"!=typeof l?l.left-d.left:0,n=i.css("font-size"),s=i.css("font-weight"),(!o||c||u||f||b)&&(o=i.text()),o=$.trim(o);var p=$("#tfl-editable-ruler");if(p.length||(p=$('<span class="display-none" id="tfl-editable-ruler"></span>'),$(document.body).append(p)),p.text(o).css({"font-size":n,"font-weight":s}),a=p.width()+r<t.width()&&i.height()<30?p.width()+r:t.is("[data-editable-use-real-width]")&&"true"==t.attr("data-editable-use-real-width")?t.width():t.width()<i.width()?t.width():i.width()+r,""===$.trim(o)){var h=i.prevAll(),v=0;h.each(function(){$(this).hasClass("font font-edit-fill")||(v=Math.max(v,$(this).offset().left+$(this).width()))}),a=Math.max(10,v-d.left)}return t.attr("class")&&t.attr("class").indexOf("priority-label-")>-1&&(a+=2*Number(i.css("padding-right").replace(/px/,""))),t.attr("class")&&t.attr("class").indexOf("severity-label-")>-1&&(a+=Number(i.css("padding-right").replace(/px/,""))),a},_blockOffset:function(t,e){var a,i=t.find(".editable-value"),d=t.offset(),l=(i.offset(),0),r="12px",n="normal",s=t.attr("data-editable-value"),o="tselect-multiple"==e,c="dkselect"==e||"tselect"==e,u="treeselect"==e,f="disabled"==e;r=i.css("font-size"),n=i.css("font-weight"),(!s||o||c||u||f)&&(s=i.text()),s=$.trim(s);var b=$("#tfl-editable-ruler");if(b.length||(b=$('<span class="display-none" id="tfl-editable-ruler"></span>'),$(document.body).append(b)),b.text(s).css({"font-size":r,"font-weight":n}),a=b.width()+l<t.width()&&i.height()<30?b.width()+l:t.is("[data-editable-use-real-width]")&&"true"==t.attr("data-editable-use-real-width")?t.width():t.width()<i.width()?t.width():i.width()+l,""===$.trim(s)){var p=i.prevAll(),h=0;p.each(function(){$(this).hasClass("font font-edit-fill")||(h=Math.max(h,$(this).offset().left+$(this).width()))}),a=Math.max(10,h-d.left)}return a},_addEditableClass:function(){var t=$(this),e=(t.find("a"),t.attr("data-editable")),a=t.attr("data-editable-title")||!1;if("disabled"!=e){var i=t.find(".editable-value");("treeselect"==e||"tselect"==e||"dkselect"==e||"tselect-multiple"==e)&&(t.hasClass("editable-dropdown-label")||t.addClass("editable-dropdown-label"),i.hasClass("no-dropdown-arrow")||0==i.find(".editable-dropdown-arrow").length&&(i.parent().hasClass("td-editable-dropdown")||i.css({position:"relative","padding-right":"27px"}),i.append('<i class="font font-arrow-down editable-dropdown-arrow"></i>'))),a&&0==t.find("i.font-edit").length&&(i.parent().hasClass("growing-title-inner")||i.parent().parent().hasClass("growing-title-inner")?(i.closest(".growing-title-inner").css({"padding-right":"30px","box-sizing":"border-box"}),i.css({position:"relative"}),i.parent().append('<i class="font font-edit"></i>')):(i.css({position:"relative","padding-right":"30px"}),i.append('<i class="font font-edit"></i>')));var d=t.attr("class"),l=t.attr("data-editable-value");d||(d=""),l||(l=""),d.indexOf("severity-label-")>-1||d.indexOf("priority-label-")>-1||t.addClass("editable-text-area"),t.addClass("editable-click-area")}},_showIcon:function(){var t=$(this),e=t.find(".edit-control-ico"),a=t.attr("data-editable");if(e.length)e.css("display","inline-block");else{var i=t.closest(".tfl-editable").attr("editable-ico-tip"),d="";d=i?i:t.is("td")?"可双击单元格空白处进行编辑":"";var l="font font-edit-fill text-primary";"disabled"==a&&(d=t.attr("data-disabled-tip")?t.attr("data-disabled-tip"):"不可编辑",l="ico-pen-s-disabled");var r=$("<a style='position:absolute;z-index:10;' title='"+d+"' class='"+l+" edit-control-ico' href='javascript:;'></a>");t.prepend(r),e=r}var n=TFL.editable._iconOffset(t,a);e.css({"margin-left":n}),t.trigger("edit-ico-show")},_hideIcon:function(){var t=$(this);t.find(".edit-control-ico").css("display","none"),t.trigger("edit-ico-hide")},_showTselectList:function(t){var e=t.find(".dropdown-toggle");e.click(),TFL.ie.isTrue&&e.click(function(t){t.stopPropagation()}),TFL.use("tSelect",function(){!t.attr("tselect-init")&&TFL.tselect._init(t)})},_disableSelection:function(){if(!$(this).find("input:text").length){var t=$("body");clearTimeout(t.data("editableSelection")),t.disableSelection();var e=setTimeout(function(){t.enableSelection()},500);t.data("editableSelection",e)}},_validate:function(t,e){var a=this,i=t.attr("data-editable"),d="tselect-multiple"==i,l=d?e.find(".dropdown-toggle"):e,r=!1;if("1"==TFL.editable._getAttribute(t,"required"))if(""===$.trim(e._val())){e.data("validation",0),r=!0;var n=a.defaultMessage.miss;a._showValidError(l,n),d&&e.find(".select-dropdown-panel").html("<i class='c-red2'>"+n+"</i>")}else e.data("validation",1),a._hideValidError();if(t.attr("data-max-length")){var s=t.attr("data-max-length");s<e.val().trim().length&&(e.data("validation",0),a._showValidError(l,"字符最大长度不能超过"+s))}if(!r){var o=i.toUpperCase();if(o in a.regExp){var c=a.regExp[o];if(""===e._val()||c.test(e._val()))e.data("validation",1),a._hideValidError();else{var n=a.defaultMessage[i];e.data("validation",0),a._showValidError(l,n)}}}return 1===e.data("validation")?!0:!1},_showValidError:function(t,e){var a=this,i=$(t),d=$("#inline-invalid-tips").length?$("#inline-invalid-tips"):$(a._validUiHelper()),l=i.offset(),r=i.outerWidth(),n=i.outerHeight(),s=32>n?(32-n)/2:0;$("#inline-invalid-tips").length||$("body").append(d),d.css({position:"absolute",top:l.top-s,"z-index":9999}).find(".cluetip-inner").text(e);var o=$(window).width(),c=d.width();l.left+r+c>o?(d.css({right:o-l.left+5,left:"auto"}),d.removeClass("clue-right-jtip").addClass("clue-left-jtip")):(d.css({left:l.left+r+5,right:"auto"}),d.removeClass("clue-left-jtip").addClass("clue-right-jtip")),i.removeClass("valid").addClass("invalid"),i.bind("focusin",function(){d.hide()}).bind("focusout",function(){i.data("validation")||d.show()})},_hideValidError:function(t){var e=$(t),a=$("#inline-invalid-tips");e.removeClass("invalid").addClass("valid"),a.hide()},_validUiHelper:function(){return'<div id="inline-invalid-tips" class="cluetip cluetip-jtip clue-right-jtip"><div class="cluetip-outer"><div class="cluetip-inner"></div></div><div class="cluetip-arrows cluetip-arrows-border"></div><div class="cluetip-arrows"></div></div>'},_submit:function(t){var e=t.closest(".tfl-editable"),a=TFL.editable._getAttribute(t,"editable-url"),i=e.attr("editable-fail-callback"),d=e.attr("editable-success-callback"),l=t.attr("data-editable"),r="userchooser"==l||"pinyinuserchooser"==l||"mixchooser"==l,n=r?t.find(".edit-control.tt-input"):t.find(".edit-control"),s=r?t.find(".edit-control-wrap").children('input[userchooser="true"]').val():$.trim(n._val()),o=t.find(".edit-control-wrap"),c=s!=t.data("original-value")&&n.data("validation");if("int"!==l&&"integer"!==l||""===s?"float"==l&&(s=Number(s).toFixed(2),n.val(s)):n.val(s),"treeselect"===l&&(s=n.next(".treechooser-id").val()),!r||t.data("original-value")+";"!==s&&t.data("original-value")!==s||(c=!1),a&&c){if(t.find(".edit-loading").length)return;var u=$('<div class="edit-loading" style="position:absolute;font-size:14px;line-height: '+t.outerHeight()/1.5+'px;"><span class="loading2"></span></div>'),f=t.closest("[data-editable-params]").attr("data-editable-params"),b=f?$.parseJSON(f):{},p={"data[field]":TFL.editable._getAttribute(t,"data-editable-field"),"data[value]":s},h=$.extend(b,p);o.hide(),t.prepend(u),$.ajax({type:"POST",url:a+"?r="+(new Date).getTime(),data:h,success:function(e){if(u.remove(),"string"==typeof e&&"-1"!=e.indexOf("ErrorCode")){if(TFL.editable._reset(t),i){var a=new Function("return "+i)();a(e.split(":")[1],t)}}else if(TFL.editable._setData(t,!0)._reset(t,e),d){var a=new Function("return "+d)();a(h)}}}).done(function(){"undefined"!=typeof headFloat&&window.headFloat.init()})}else this._setData(t,c)._reset(t)},_setData:function(t,e){if(e){var a,i=t.attr("data-editable")?t.attr("data-editable"):t.attr("data-editable-value"),d=0!=t.find(".editable-value").length?t.find(".editable-value"):t,l="tselect-multiple"==i,r="dkselect"==i,n="treeselect"==i,s="userchooser"==i||"pinyinuserchooser"==i||"mixchooser"==i,o=t.find(".edit-control"),c=TFL.tagBoolean("data-editable-ellipsis",t,!1);if(l)a=t.find(".select-dropdown-panel").text();else if(r)a=o.find("option:selected").text();else if(s)a=t.find(".edit-control-wrap").children('input[userchooser="true"]').val();else if("digits"==i){var u=TFL.editable._getDigitsUnit(t.data("original-value"),"unit");a="--"!=u?$.trim(o.val())+u:$.trim(o.val())}else a=$.trim(o.val());t.attr("data-editable-value",a),n&&t.attr("data-editable-value",o.next(".treechooser-id")._val()),l&&t.attr("data-editable-value",o._val()),r&&t.attr("data-editable-value",o._val()),"url"==i&&d.attr("href",a),"undefined"!=typeof d.attr("title")&&d.attr("title",a),c&&(a=TFL.editable._cutStr(a,70)),a=TFL.htmlspecialchars_encode(a),a=t.is("td")?a.replace(/\s/gi,"&nbsp;"):a.replace(/[\r\n]/gi,"<br/>").replace(/\s/gi,"&nbsp;"),d.html(a?a:"--"),t.trigger("setdata")}return this},_reset:function(t,e){var a=t.find(".edit-control-wrap"),i=t.find(".edit-original");a.remove(),i.parent().html(i.html()).removeClass("onedit");var d=TFL.editable._getAttribute(t,"data-editable-change");if(d){var l=new Function("return "+d)();l(t,e)}t.trigger("reset")},_goHref:function(t){if(TFL.editable.onCtrlKey)return!0;if("_blank"==$(this).attr("target"))return!0;t.preventDefault();var e=$(this),a=e.closest("[data-editable]");setTimeout(function(){if(!a.hasClass("onedit")){var t=e.attr("href");"--"==e[0].innerText||""==e[0].innerText||(window.location.href=t)}},300)},_fixWidth:function(t){var e=t.find(".select-dropdown-panel");e.width()>400&&(e.css("max-width",e.width()),TFL.ie.mode()>7&&t.css("max-width",e.width()+25))},_cutStr:function(t,e){for(var a=0,i=0;i<t.length;i++)if(a+=t.charCodeAt(i)>255?2:1,a>e){t=t.substring(0,i)+"...";break}return t},_getAttribute:function(t,e){var a,i=t.closest("tr"),d=t.closest(".tfl-editable").find("th").eq(t.closest("td").index());return t[0].getAttribute(e)?a=t[0].getAttribute(e):i.length&&i[0].getAttribute(e)?a=i[0].getAttribute(e):d.length&&d[0].getAttribute(e)?a=d[0].getAttribute(e):t.closest(".tfl-editable").length&&t.closest(".tfl-editable")[0].getAttribute(e)&&(a=t.closest(".tfl-editable")[0].getAttribute(e)),a},_setCaret:function(t,e){if(t.focus(),t.setSelectionRange)t.setSelectionRange(e,e);else if(t.createTextRange){var a=t.createTextRange();a.moveStart("character",e),a.collapse(),a.select()}},_getDigitsUnit:function(t,e){var a=t.replace(/\d+\.{0,1}\d*/,""),i=t.replace(a,"");return"unit"===e?a:i},float_call_back:function(t){var e=$(t).find(".editable-value"),a=parseFloat($(t).attr("data-editable-value"));isNaN(a)||(e.attr("title",a),e.html(a))},regExp:{EMAIL:new RegExp("^[a-z0-9._%-]+@([a-z0-9-]+\\.)+[a-z]{2,4}$","ig"),TEL:new RegExp("^\\d([0-9-\\s])*\\d$"),URL:new RegExp("(http[s]{0,1}|ftp)://[a-zA-Z0-9\\.\\-]+\\.([a-zA-Z]{2,4})(:\\d+)?(/[a-zA-Z0-9\\.\\-~!@#$%^&amp;*+?:_/=<>]*)?"),NUMBER:new RegExp("^\\-?\\d+(\\.\\d+)?$"),FLOAT:new RegExp("^\\-?\\d+(\\.\\d+)?$"),INTEGER:new RegExp("^([+-]?)\\d+$"),INT:new RegExp("^[0-9]{0,17}$"),SMALLINT:new RegExp("^[0-9]{1,4}$"),DIGITS:new RegExp("^[0-9]{0,4}\\.[0-9]{1,2}$|^[0-9]{0,4}$"),DATE:new RegExp("(([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})-(((0[13578]|1[02])-(0[1-9]|[12][0-9]|3[01]))|((0[469]|11)-(0[1-9]|[12][0-9]|30))|(02-(0[1-9]|[1][0-9]|2[0-8]))))|((([0-9]{2})(0[48]|[2468][048]|[13579][26])|((0[48]|[2468][048]|[3579][26])00))-02-29)")},defaultMessage:{auto:"输入的类型不合法",miss:"必填项不能为空",email:"请输入合法的电子邮件",tel:"请输入合法的电话号码",url:"请输入合法的网址",number:"请输入一个数字","float":"请输入一个数字",integer:"请输入一个整数","int":"请输入一个非负整数，且最多17位。",smallint:"请输入一个非负整数，且最多4位。",digits:"请输入一个数字，不可超过10000，且最多两位小数。",date:"请输入正确的日期"}},!0);
TFL.widget("remove",{init:function(){$("body").undelegate("[data-remove]","mouseenter",TFL.remove._init).delegate("[data-remove]","mouseenter",TFL.remove._init)},_init:function(e){var t=$(this);if(!t.attr("remove-init")){t.attr("remove-init",!0);var a=t.attr("data-remove");if("tr"==a){var i=t.find("thead"),n=t.find("tbody");if(i.length){var r=$("<th></th>").addClass("tfl-remove-th");i.find("tr").append(r)}n.find("tr").each(function(){var e=$("<td></td>").addClass("tfl-remove-td");$(this).append(e)})}t.delegate(a,"mouseover",TFL.remove._show).delegate(a,"mouseleave",TFL.remove._hide)}},_show:function(){var e=$(this);if("true"!=e.attr("not-remove")&&!e.parent().is("thead")&&!e.closest("table").parent().hasClass("dk_table_wrapper"))if($(".form-item .font-close-s").css("visibility","hidden"),e.find(".font-close-s").length)e.find(".font-close-s").css("visibility","visible");else{var t=$("<a class='font font-close-s' href='javascript:;'></a>"),a=e.closest("[data-remove]"),i=a.attr("data-remove"),n=a.attr("ico-append-to"),r=a.attr("onremove");if(t.click(function(){var e=$(this).closest(i),t=!0;if(r){var a=new Function("return "+r)();t=a(e),t=void 0==t?!0:t}t&&(e.trigger("onremove"),e.remove())}),"tr"==i){var o=e.find(".tfl-remove-td");if(o.length)o.append(t);else{var s=$("<td></td>").addClass("tfl-remove-td");s.append(t),e.append(s)}}else n?e.find(n).append(" ").append(t):e.append(" ").append(t)}},_hide:function(){var e=$(this);"true"==e.attr("not-remove")||e.parent().is("thead")||e.parent().parent().parent().hasClass("dk_select")||e.find(".font-close-s").css("visibility","hidden")}},!0);
TFL.widget("guide",{init:function(){var e=this;$("body").delegate(".cloud-guide-switch","click",function(){var t=$(".user_guide");0==t.length||t.is(":hidden")?e.openOnlineGuide():"1"==isFoldByRemember?e.rememberFold(!1):e.closeOnlineGuide()}),0!=$(".user_guide").length&&e._init(),$(document).on("onlineGuide.rendered",function(){e._init()})},_init:function(){if(0!=$(".user_guide").length){var e=this;TFL.use("guideException",function(){e._defineOptions(),e._bindEvents(),e.showOnlineGuide("slow"),e.updateMainGuide(e.options.mainItems.filter(".current"))})}},_defineOptions:function(){var e=this;this.options={guidePanel:$(".user_guide"),miniPanel:$(".mini-user-guide"),guideSwitch:$(".cloud-guide-switch"),guideInviteUser:$(".cloud-user-add")};var t=this.options.guidePanel;this.options.panelCloser=t.find(".close-panel"),this.options.panelMinier=t.find(".mini-panel"),this.options.miniPanelCloser=this.options.miniPanel.find(".icon-mini-close"),this.options.guideSub=t.find(".guide-sub"),this.options.subItems=t.find(".sub-item"),this.options.mainItems=t.find(".guide-side li"),this.options.subs=[],this.options.scrollTop=0,this.options.guideSub.each(function(t){var i=$(this),n=i.find(".sub-block"),s=i.find(".sub-item");e.options.subs[t]={subBlocks:n,subItems:s}})},_bindEvents:function(){var e=this,t=this.options.guidePanel;$(window).scroll(function(){e.updateStepAndguidePanelLocation()}),t.find(".guide-side ul").on("mousewheel",function(){var e=$(this).scrollTop();0==e?e+=3:e==$(this).outerHeight()&&(e-=3),$(this).scrollTop(e)}),this.options.panelCloser.on("click",function(){e.closeOnlineGuide(),$(".step-panel").remove()}),this.options.miniPanelCloser.on("click",function(){e.closeOnlineGuide(),$(".step-panel").remove()}),this.options.panelMinier.on("click",function(){e.rememberFold(!0)}),this.options.miniPanel.find(".mini-guide-content").on("click",function(){e.rememberFold(!1)}),$(document).on("click",function(){var t=$(".step-panel.current");if(0!=t.length){var i=t.attr("stepObj"),n=e._getStepObj(i);0!=n.length&&setTimeout(function(){n.is(":hidden")&&t.hide()},300)}}),this.options.mainItems.on("click",function(){var t=$(this).attr("menu-name"),i=e._getSubByMain($(this)),n=i.find(".sub-item:first");e.rememberItem(t,n,$(this),e.updateMainGuide)}),this.options.guideSub.delegate(".sub-item a","click",function(t){var i=e.options.mainItems.filter(".current").attr("menu-name"),n=$(this).closest(".sub-item");e.rememberItem(i,n,n,e.updateSubGuide)}).delegate(".exception .hasEnabled","click",function(e){var t=$(this).closest(".guide-sub"),i=t.find(".sub-item.current");i.find("a").trigger("click"),window.location.href=window.location.href}).delegate(".exception .skip","click",function(t){var i=$(this).closest(".guide-sub"),n=i.find(".sub-item.current");e._clickNextSubItem(n)}).delegate(".exception .exception-for-admins","mouseover",function(t){e.showExceptionAdmins($(this))}).delegate(".exception .exception-for-admins","mouseout",function(e){var t=$(this).closest(".exception").find(".exception-admins-block");t.remove()}),$(document).delegate(".step-panel .next-step","click",function(t){var i=$(this),n=i.closest(".step-panel"),s=e.options.stepPanels.index(n),o=e.options.subItems.filter(".current");if(i.hasClass("last-step"))e._clickNextSubItem(o);else{var a=e.options.stepPanels.eq(s+1);0!=a.length&&(n.hide(),e.showStepPanel(a))}}).delegate(".step-panel .prev-step","click",function(t){var i=$(this),n=i.closest(".step-panel"),s=e.options.stepPanels.index(n),o=e.options.stepPanels.eq(s-1);0!=o.length&&(n.hide(),e.showStepPanel(o))}).delegate(".step-panel .close-step-panel","click",function(e){var t=$(this),i=t.closest(".step-panel");i.hide()})},rememberItem:function(e,t,i,n){var s=this,o=t.attr("redirecturl"),a=t.attr("menu-name"),r=(new Date).getTime(),d=rememberOnlineGuideUrl+"/"+e+"/"+a+"?time="+r;$(this);d=encodeURI(d),$.get(d,function(e){e?s.judgeRedirect(i,n,o):console.log("error")})},rememberFold:function(e){var t=this,i=this.options.mainItems.filter(".current").attr("menu-name"),n=this.options.subItems.filter(".current").attr("menu-name"),s=(new Date).getTime(),o=rememberOnlineGuideUrl+"/"+i+"/"+n+"/";o+=e?"1":"0",o+="?time="+s,o=encodeURI(o),$.get(o,function(i){i?e?t.foldOnlineGuide():t.unfoldOnlineGuide():console.log("error")})},openOnlineGuide:function(){var e=this,t=openOnlineGuideUrl,i=initOnlineGuideUrl;(0===$(".user_guide").length||"none"===$(".user_guide").css("display"))&&$.get(t,function(t){t&&(0===$(".user_guide").length?$.get(i,function(e){var t=$(e);t.hide().appendTo($("body")),setTimeout(function(){$(document).trigger("onlineGuide.rendered")},10)}):(e.showOnlineGuide("slow"),e.updateMainGuide(e.options.mainItems.eq(0))))})},closeOnlineGuide:function(){var e=this,t=closeOnlineGuideUrl;return $.get(t,function(t){t?e.hideOnlineGuide("slow"):TFL.tips.showFlash("系统错误，关闭失败，请联系：TAPD热线",!0,1500)}),!0},showOnlineGuide:function(e){var t=this.options.guidePanel,i=this.options.miniPanel,n=this.options.guideSwitch,s=(this.options.guideInviteUser,$(window).width());t.show(),"1"==isFoldByRemember?(i.css("right","0px"),t.css({left:s+"px",bottom:0})):(i.css("right","-80px"),t.css("left","0px"),t.animate({opacity:1,bottom:0},e,"swing")),i.show(),n.addClass("on"),n.find("i").attr("class","font-public font-public-question question--on")},hideOnlineGuide:function(e){var t=this.options.guidePanel,i=this.options.miniPanel,n=this.options.guideInviteUser,s=this.options.guideSwitch;t.animate({opacity:0,bottom:-1*parseInt(t.css("height"))},e,function(){t.hide()}),i.hide(),s.removeClass("on"),s.find("i").attr("class","font-public font-public-question question--off"),n.find("i").attr("class","font-public font-public-invite"),isFoldByRemember="0"},foldOnlineGuide:function(){var e=this.options.guidePanel,t=$(".mini-user-guide"),i=$(window).width();e.animate({left:i+"px",opacity:0},"slow",function(){t.animate({right:"0px"},"slow"),isFoldByRemember="1"})},unfoldOnlineGuide:function(){var e=this.options.guidePanel,t=$(".mini-user-guide");e.animate({left:"0px",opacity:1},"slow",function(){t.animate({right:"-80px"},"slow"),isFoldByRemember="0"})},updateMainGuide:function(e){var t=this._getSubByMain(e),i=this.options.mainItems.index(e);this.options.guideSub.hide(),this.options.mainItems.removeClass("current"),e.addClass("current");var n=$(".guide-side ul")[0].clientHeight,s=$(".guide-side ul").offset().top,o=$(".guide-side li.current").offset().top,a=$(".guide-side li.current")[0].clientHeight;if(o+a-s>=n&&$(".guide-side ul").scrollTop(s+n/2),t){t.show();var r=t.find(".sub-item.current");0==r.length&&(r=t.find(".sub-item").eq(0)),r.length&&this.updateSubGuide(r)}this.layoutSub(i)},updateSubGuide:function(e){var t=e.closest(".guide-sub");this.options.subItems.removeClass("current"),e.addClass("current"),t.find(".exception").hide(),$(".step-panel").remove();var i=this.jugdeException(e);i?(t.find(".exception").show(),this.rememberFold(!1)):-1!=window.location.search.indexOf("online_guide")&&this.renderSteps(e)},jugdeException:function($subItem){var hasDependencyMenu=$subItem.attr("has-dependency-menu"),dependencyMenu=$subItem.attr("dependency-menu"),missingDependencyMenu=$subItem.attr("missing-dependency-menu"),hasStrongDependencyPemission=$subItem.attr("has-strong-dependency-pemission"),strongDependencyPemission=$subItem.attr("strong-dependency-pemission"),hasMenuSettingPermission=$subItem.attr("has-menu-setting-permission"),htmlDependencyDataCallback=$subItem.attr("html-dependency-data-callback"),dependencyData=$subItem.attr("dependency-data");if(missingDependencyMenu=$.parseJSON(missingDependencyMenu),null!=missingDependencyMenu&&missingDependencyMenu.length>0)return TFL.guideException.checkMenu($subItem,missingDependencyMenu,hasMenuSettingPermission),!0;if(!hasStrongDependencyPemission)return TFL.guideException.checkPermission($subItem,strongDependencyPemission),!0;try{if(""!=htmlDependencyDataCallback&&!eval("TFL.guideException."+htmlDependencyDataCallback+"($subItem ,'"+dependencyData+"')"))return!0}catch(exception){console.log(exception+" 系统错误，请联系：TAPD热线")}return!1},showExceptionAdmins:function(e){var t=e.attr("admins");adminArray=$.parseJSON(t),adminStr=adminArray.join(" "),$exception=e.closest(".exception-content"),$showDiv=$('<div class="exception-admins-block"></div>'),$pointer=$('<span class="exception-admins-pointer"></span>'),$content=$('<div class="exception-admins-content"></div>'),x=e.offset().left-$exception.offset().left+40,$content.text(adminStr),$showDiv.append($pointer,$content),$showDiv.appendTo($exception).css("left",x).show()},renderSteps:function(e){var t=e.attr("steps");if(t=$.parseJSON(t)){for(var i=t.length,n=0;i>n;n++){var s=t[n],o=s.step_name,a=s.html_selector,r=s.before_show,d=s.event_name,l=this.createStepPanel(o,n,i,a);this.appendStepPanel(l,a,r,d)}this.options.stepPanels=$(".step-panel"),this.showStepPanel(this.options.stepPanels.eq(0))}},createStepPanel:function(e,t,i,n){var s=(this._getStepObj(n),$('<div class="step-panel"></div>')),o=$('<span class="step-panel-pointer left"></span>'),a=$('<span class="step-panel-pointer right"></span>'),r=_base+"img/online_guide/wave.gif",d=$('<img class="step-panel-location" src="'+r+'"/>'),l=$('<span class="close-step-panel"><i class="ico-remove-white"></i></span>'),c=$('<div class="step-panel-content"></div>'),u=null,p=null,h='<div class="prev-step"><i class="icon-guide-arrow-left-white"></i>上一步</div>',f='<div class="next-step">下一步<i class="icon-guide-arrow-right-white"></i></div>',g='<div class="next-step last-step">下一步<i class="icon-guide-arrow-right-white"></i></div>';return 1!==i?(0===t?p=$(f):t===i-1?(u=$(h),p=$(g)):(u=$(h),p=$(f)),t+=1,c.text(t+"、"+e)):(c.text(e),p=$(g)),s.append(d,o,l,c,u,p,a),s},appendStepPanel:function(e,t,i,n){e.appendTo("body").hide(),e.attr({stepObj:t,beforeShow:i,eventName:n})},showStepPanel:function(e){var t=this,i=e.attr("stepObj"),n=e.attr("eventName"),s=this._getStepObj(i),o=e.attr("beforeShow"),a=function(){s=t._getStepObj(i),t._showStepPanel(e,s)};n&&$(document).off(n,a).on(n,a),o?("function"==typeof this[o]&&this[o].call(this,e),n||(s=t._getStepObj(i),this._showStepPanel(e,s))):this._showStepPanel(e,s)},_showStepPanel:function(e,t){return 0==t.length||t.is(":hidden")?!1:(this.options.stepPanels.removeClass("current"),e.show().addClass("current"),this.updateStepAndguidePanelLocation(),this.setPagePosition(e,t),void this.focusInStepObj(t))},setPagePosition:function(e,t){if(0!=t.length){var i=t.offset().left+t.outerWidth()+10,n=t.offset().top-60,s=t.outerHeight(),o=this.options.guidePanel.offset().top,a=$(window).outerWidth();n+s+60>o?(104>n&&(n=0),a>=i&&(i=0),window.scrollTo(i,n)):i>a&&window.scrollTo(i,0)}},changeGuideLocation:function(e,t){var i=this.options.guidePanel,n=$(document).height(),s=$(document).scrollTop(),o=$(window).height(),a=t;i.hasClass(e)&&(a=30),n-o-s>a?i.addClass(e):(30==a&&i.fadeOut("slow",function(){i.fadeIn("fast")}),i.removeClass(e))},updateStepAndguidePanelLocation:function(){var e=$(".step-panel"),t=e.filter(".current");if(0!=t.length){var i=this._getStepObj(t.attr("stepobj"));if($location=t.find(".step-panel-location"),$pointerLeft=t.find(".step-panel-pointer.left"),$pointerRight=t.find(".step-panel-pointer.right"),0==i.length)return;var n=37,s=i.offset().top,o=i.offset().left+i.outerWidth()+n,a=t.outerHeight(),r=this.options.guidePanel,d=$(window).height()-r.height();s+=(i.outerHeight()-$(".step-panel-location").outerHeight())/2,s+t.outerHeight()>$("body").height()&&(s-=10),o+t.outerWidth()>$(window).width()?($pointerLeft.hide(),$location.addClass("right").removeClass("left"),o=i.offset().left-t.outerWidth()-n):($pointerRight.hide(),$location.addClass("left").removeClass("right")),t.css({top:s,left:o}),"0"==isFoldByRemember&&(s+a>d?this.foldOnlineGuide():this.unfoldOnlineGuide())}},focusInStepObj:function(e){if(e.is("input:text"))e.focus();else if(e.hasClass("rich-editor")||e.parent().hasClass("rich-editor")){var t=e.find("iframe").contents().find("body");t.focus()}},_getSubByMain:function(e){var t=this.options.mainItems.index(e),i=this.options.guideSub.eq(t);return-1==t&&(i=null),i},_clickNextSubItem:function(e){var t=e.closest(".guide-sub"),i=t.find(".sub-item"),n=i.index(e),s=i.eq(n+1),o=this;if(0==s.length){var a=this.options.mainItems.filter(".current"),r=a.next("li");0!=r.length?r.trigger("click"):o.closeOnlineGuide()}else s.find("a").trigger("click")},_getStepObj:function(e){var t=$(e),i=null;if(0!=t.length&&t.is(":hidden")&&-1!=e.indexOf(":first")&&(e=e.replace(":first",""),0!=$(e).filter(":visible").length&&(t=$(e).filter(":visible"))),t.is("th")){var n=t.closest("tr").find("th").index(t),s=t.closest("table").find("tbody tr.rowNOTdone:first");i=s.find("td").eq(n)}else i=t;return i},layoutSub:function(e){var t=this.options.subs[e],i=t.subBlocks,n=t.subItems,s=this._getBlockHeight(),o=0,a=0,r=i.eq(a);n.each(function(){var e=$(this),t=e.height()+parseInt(e.css("margin-bottom"));o+t>s?(r=i.eq(++a),o=0+t):o+=t,e.appendTo(r)});var d=450*(a+1);$(".more-links").css("left",d+"px")},_getBlockHeight:function(){var e=this.options.guideSub,t=e.height(),i=19,n=30,s=49;return t-i-n-s},judgeRedirect:function(e,t,i){var n,s=this;n=-1!=this.options.mainItems.index(e)?s._getSubByMain(e).find(".sub-item:first"):e;var o=n.attr("has-strong-dependency-pemission"),a=$.parseJSON(n.attr("missing-dependency-menu"));if(null!=a&&0!=a.length||!o)t.call(this,e);else{var r=this.ifRedirect(i,t,e);1==r?window.location.href=_base+_workspace_id+"/"+i:2==r?(window.location.href=_base+_workspace_id+"/"+i,t.call(this,e)):t.call(this,e)}},ifRedirect:function(e){var t=window.location.href,e=$.trim(e),i=location.hash;return""!=e&&(e=_base+_workspace_id+"/"+e,t!=e)?(t=t.replace(i,""),-1!=e.indexOf("#")&&(e=e.substring(0,e.indexOf("#"))),t!=e?1:2):0},openListAction:function(e){var t=e.attr("stepObj"),i=this._getStepObj(t);if(0==i.length)return!1;var n=i.closest(".dropdown").find(".dropdown-toggle");n.trigger("click")},showBurnChart:function(e){var t=e.attr("eventName"),i=e.attr("stepObj"),n=this._getStepObj(i),s=$("#IterationSchedule");s.trigger("click"),0!=n.length?$(document).trigger(t):$(document).on("IterationSchedule.finished",function(){$("#StorySizeBurtdown").trigger("click"),$("#div_chart_subcontent_StorySizeBurtdown").load(function(){$(document).trigger(t)})})},showLaunchBurnChart:function(e){var t=e.attr("eventName"),i=e.attr("stepObj"),n=this._getStepObj(i),s=$("#tab-releaseschedule");s.trigger("click"),0!=n.length?$(document).trigger(t):$("#tab-releaseschedule-div").load(function(){$(document).trigger(t)})},openCardAdd:function(e){var t=$(".add-card-placeholder:first"),i=e.attr("stepObj"),n=this._getStepObj(i),s=this;return 0==n.length?!1:(cardAction.hideDetail(),n.closest(".add-card-wrap").delegate(".btn-ok","click",function(e){setTimeout(function(){s.updateStepAndguidePanelLocation()},150)}).delegate(".btn-cancel","click",function(t){e.hide()}).delegate(".control-add-card","keyup",function(e){var t=e.keyCode;$(".step-panel.current");13==t&&s.updateStepAndguidePanelLocation()}),void t.trigger("click"))},openCardDetail:function(e){var t=$(".card-event:first");return 0==t.length?!1:($(".add-card-placeholder, .card-event, .more-action, .list-header").on("mousedown",function(){e.hide()}),void t.trigger("click"))},viewCard:function(e){var t=this;setTimeout(function(){cardAction.hideDetail()},10),$(document).on("board.card.filtered",function(){var i=e.attr("stepObj"),n=t._getStepObj(i);(0==n.length||n.is(":hidden"))&&e.hide()})},openCardFilter:function(e){var t=$("#cardFilterBtn");return 0==t.length?!1:void t.trigger("click")},hideLaunchTitleCluetip:function(e){var t=($(".add-card-placeholder:first"),e.attr("stepObj")),i=this._getStepObj(t);0!=i.length&&i.removeAttr("data-control")}},!0);
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.template=t():e.template=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=20)}([function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(17),i=n(1),u=function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"object"===("undefined"==typeof e?"undefined":r(e))?t=e:t.source=e,t=i.$extend(t),e=t.source,t.debug&&(t.cache=!1,t.bail=!1,t.compileDebug=!0);var n=t.debuger,u=t.filename,a=t.cache,c=t.caches;if(a&&u){var l=c.get(u);if(l)return l}if(!e)try{var f=t.resolveFilename(u,t.root,t.extname);e=t.loader(f),t.filename=f,t.source=e}catch(p){var y={path:u,name:"CompileError",message:"template not found: "+p.message,stack:p.stack};if(t.bail)throw y;return n(y)}var m=new o(t),h=function v(e){try{return v.source(e)}catch(r){if(!t.compileDebug)return t.cache=!1,t.compileDebug=!0,s(t)(e);if(t.bail)throw r;return n(r)()}};try{h.source=m.build(),a&&u&&c.set(u,h)}catch(p){if(t.bail)throw p;return n(p)}return h.toString=function(){return h.source.toString()},h};e.exports=u},function(e,t,n){"use strict";var r=n(9),o=n(8),i=n(11),u=n(13),s=n(12),a=n(10),c=n(16),l=n(15),f=n(14),p={source:null,filename:null,rules:[c,l],escape:!0,debug:!1,cache:!0,compileDebug:!1,bail:!1,resolveFilename:f,compressor:null,debuger:r,loader:u,caches:o,root:"/",extname:".art",imports:{$each:a,$escape:i,$include:s}};p.$extend=function(e){var t=Object.create(this);for(var n in e)t[n]=e[n];return t},e.exports=p},function(e,t,n){"use strict";(function(t){e.exports=!1;try{e.exports="[object process]"===Object.prototype.toString.call(t.process)}catch(n){}}).call(t,n(7))},function(e,t,n){"use strict";var r={"abstract":!0,await:!0,"boolean":!0,"break":!0,"byte":!0,"case":!0,"catch":!0,"char":!0,"class":!0,"const":!0,"continue":!0,"debugger":!0,"default":!0,"delete":!0,"do":!0,"double":!0,"else":!0,"enum":!0,"export":!0,"extends":!0,"false":!0,"final":!0,"finally":!0,"float":!0,"for":!0,"function":!0,"goto":!0,"if":!0,"implements":!0,"import":!0,"in":!0,"instanceof":!0,"int":!0,"interface":!0,let:!0,"long":!0,"native":!0,"new":!0,"null":!0,"package":!0,"private":!0,"protected":!0,"public":!0,"return":!0,"short":!0,"static":!0,"super":!0,"switch":!0,"synchronized":!0,"this":!0,"throw":!0,"transient":!0,"true":!0,"try":!0,"typeof":!0,"var":!0,"void":!0,"volatile":!0,"while":!0,"with":!0,"yield":!0};e.exports=function(e){return r.hasOwnProperty(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=/((['"])(?:(?!\2|\\).|\\(?:\r\n|[\s\S]))*(\2)?|`(?:[^`\\$]|\\[\s\S]|\$(?!\{)|\$\{(?:[^{}]|\{[^}]*\}?)*\}?)*(`)?)|(\/\/.*)|(\/\*(?:[^*]|\*(?!\/))*(\*\/)?)|(\/(?!\*)(?:\[(?:(?![\]\\]).|\\.)*\]|(?![\/\]\\]).|\\.)+\/(?:(?!\s*(?:\b|[\u0080-\uFFFF$\\'"~({]|[+\-!](?!=)|\.?\d))|[gmiyu]{1,5}\b(?![\u0080-\uFFFF$\\]|\s*(?:[+\-*%&|^<>!=?({]|\/(?![\/*])))))|(0[xX][\da-fA-F]+|0[oO][0-7]+|0[bB][01]+|(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?)|((?!\d)(?:(?!\s)[$\w\u0080-\uFFFF]|\\u[\da-fA-F]{4}|\\u\{[\da-fA-F]+\})+)|(--|\+\+|&&|\|\||=>|\.{3}|(?:[+\-\/%&|^]|\*{1,2}|<{1,2}|>{1,3}|!=?|={1,2})=?|[?~.,:;[\](){}])|(\s+)|(^$|[\s\S])/g,t.matchToToken=function(e){var t={type:"invalid",value:e[0]};return e[1]?(t.type="string",t.closed=!(!e[3]&&!e[4])):e[5]?t.type="comment":e[6]?(t.type="comment",t.closed=!!e[7]):e[8]?t.type="regex":e[9]?t.type="number":e[10]?t.type="name":e[11]?t.type="punctuator":e[12]&&(t.type="whitespace"),t}},function(e,t,n){"use strict"},function(e,t,n){"use strict";var r=n(0),o=function(e,t,n){return r(e,n)(t)};e.exports=o},function(e,t,n){"use strict";var r,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r=function(){return this}();try{r=r||Function("return this")()||(1,eval)("this")}catch(i){"object"===("undefined"==typeof window?"undefined":o(window))&&(r=window)}e.exports=r},function(e,t,n){"use strict";var r={__data:Object.create(null),set:function(e,t){this.__data[e]=t},get:function(e){return this.__data[e]},reset:function(){this.__data={}}};e.exports=r},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(e){if("object"===("undefined"==typeof console?"undefined":r(console))){var t=e.stack;delete e.stack,e=JSON.stringify(e,null,4),console.error("Template Error: "+e+"\n\n"+t)}return function(){return"{Template Error}"}};e.exports=o},function(e,t,n){"use strict";var r=function(e,t){if(Array.isArray(e))for(var n=0,r=e.length;r>n;n++)t(e[n],n,e);else for(var o in e)t(e[o],o)};e.exports=r},function(e,t,n){"use strict";var r=function(e){var t=/&(?![\w#]+;)|[<>"']/g,n={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},r=function o(e){return"string"!=typeof e&&(e="function"==typeof e?o(e.call(e)):null===e?"":JSON.stringify(e)||""),e};return r(e).replace(t,function(e){return n[e]})};e.exports=r},function(e,t,n){"use strict";var r=function(e,t,r){var o=n(0);return r=r.$extend({filename:r.resolveFilename(e,r.root,r.extname,r.filename),source:null}),o(r)(t)};e.exports=r},function(e,t,n){"use strict";var r=n(2),o=function(e){if(r){var t=n(5);return t.readFileSync(e,"utf8")}var o=document.getElementById(e);return o.value||o.innerHTML};e.exports=o},function(e,t,n){"use strict";var r=n(2),o=function(e,t,o,i){if(r){var u=n(5),s=i?u.dirname(i):"";return u.extname(e)||(e+=o),u.resolve(t,s,e)}return e};e.exports=o},function(e,t,n){"use strict";var r={test:/{{([@#]?)(\/?)([\w\W]*?)}}/,use:function(e,t,n,r){var i=this,u=i.options,s=i.getEsTokens(r.trim()),a=s.map(function(e){return e.value}),c={},l=void 0,f=t?"raw":!1,p=n+a.shift(),y=function(e,t){console.warn("Template upgrade example:","{{"+e+"}}",">>>","{{"+t+"}}","\n",u.filename||"")};switch("#"===t&&y("#value","@value"),p){case"set":r="var "+a.join("");break;case"if":r="if("+a.join("")+"){";break;case"else":"if"===a[0]?(a.shift(),r="}else if("+a.join("")+"){"):r="}else{";break;case"/if":r="}";break;case"each":l=o(s),l.shift(),"as"===l[1]&&(y("each object as value index","each object value index"),l.splice(1,1));var m=l[0]||"$data",h=l[1]||"$value",v=l[2]||"$index";r="$each("+m+",function("+h+","+v+"){";break;case"/each":r="})";break;case"echo":p="print",y("echo value","value");case"print":case"include":l=o(s),l.shift(),r=p+"("+l.join(",")+")";break;default:if(-1!==a.indexOf("|")){for(var d=p,b=[],g=":",x=a.filter(function(e){return!/^\s+$/.test(e)});"|"!==x[0];)d+=x.shift();x.filter(function(e){return e!==g}).forEach(function(e){"|"===e?b.push([]):b[b.length-1].push(e)}),b.reduce(function(e,t){var n=t.shift();return t.unshift(e),r=n+"("+t.join(",")+")"},d)}else u.imports[p]?(y("filterName value","value | filterName"),l=o(s),l.shift(),r=p+"("+l.join(",")+")",f="raw"):r=""+p+a.join("");f||(f="escape")}return c.code=r,c.output=f,c}},o=function(e){for(var t=0,n=e.shift(),r=[[n]];t<e.length;){var o=e[t],i=o.type;"whitespace"!==i&&"comment"!==i&&("punctuator"===n.type&&"]"!==n.value||"punctuator"===i?r[r.length-1].push(o):r.push([o]),n=o),t++}return r.map(function(e){return e.map(function(e){return e.value}).join("")})};r._split=o,e.exports=r},function(e,t,n){"use strict";var r={test:/<%(#?)((?:==|=#|[=-])?)([\w\W]*?)(-?)%>/,use:function(e,t,n,r){var o={"-":"raw","=":"escape","":!1,"==":"raw","=#":"raw"};return t&&(r="//"+r),{code:r,output:o[n]}}};e.exports=r},function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(18),s=n(19),a=n(3),c="$data",l="$imports",f=function(e,t){return e.hasOwnProperty(t)},p=JSON.stringify,y=function(){function e(t){var n=this;o(this,e);var r=t.source;this.options=t,this.scripts=[],this.context={},this.internal={$out:'""',$line:'[0,0,0,""]',print:"function(){var text=''.concat.apply('',arguments);return $out+=text}",include:"function(src,data){return $out+=$imports.$include(src,data||"+c+",$imports.$options)}"},this.options.imports.$options=t,this.importContext("$out"),t.compileDebug&&this.importContext("$line"),this.getTplTokens(r,t.rules,this).forEach(function(e){e.type===s.TYPE_STRING?n.parseString(e):n.parseExpression(e)})}return i(e,[{key:"getTplTokens",value:function(){return s.apply(void 0,arguments)}},{key:"getEsTokens",value:function(e){return u(e)}},{key:"getVariables",value:function(e){var t=!1;return e.filter(function(e){return"whitespace"!==e.type&&"comment"!==e.type}).filter(function(e){return"name"!==e.type||t?(t="punctuator"===e.type&&"."===e.value,!1):!0}).map(function(e){return e.value})}},{key:"importContext",value:function(e){var t="",n=this.internal,r=this.context,o=this.options,i=o.imports;f(r,e)||e===c||e===l||a(e)||(t=f(n,e)?n[e]:f(i,e)?l+"."+e:c+"."+e,r[e]=t)}},{key:"parseString",value:function(e){var t=e.value,n=this.options,r=n.compressor;r&&(t=r(t));var o="$out+="+p(t);this.scripts.push({source:t,tplToken:e,code:o})}},{key:"parseExpression",value:function(e){var t=this,n=e.value,r=e.line,o=e.start,i=this.options,u=i.compileDebug,a=e.script,c=a.output,l=a.code.trim();if(c&&(l=escape===!1||c===s.TYPE_RAW?"$out+="+a.code:"$out+=$escape("+a.code+")"),u){var f=[r,o,p(n)].join(",");this.scripts.push({source:n,tplToken:e,code:"$line=["+f+"]"})}var y=this.getEsTokens(l);this.getVariables(y).forEach(function(e){return t.importContext(e)}),this.scripts.push({source:n,tplToken:e,code:l})}},{key:"checkExpression",value:function(e){for(var t=[[/^\s*?}.*?{?[\s;]*?$/,""],[/(^[\w\W]*?\s*?function\s*?\([\w\W]*?\)\s*?{[\s;]*?$)/,"$1})"],[/(^.*?\(\s*?[\w\W]*?=>\s*?{[\s;]*?$)/,"$1})"],[/(^[\w\W]*?\([\w\W]*?\)\s*?{[\s;]*?$)/,"$1}"]],n=0;n<t.length;){if(t[n][0].test(e)){var o;e=(o=e).replace.apply(o,r(t[n]));break}n++}try{return new Function(e),!0}catch(i){return!1}}},{key:"build",value:function(){var e=this.options,t=this.context,n=this.scripts,r=e.source,o=e.filename,i=e.imports,u='"use strict"',s="var "+Object.keys(t).map(function(e){return e+"="+t[e]}).join(","),a=n.map(function(e){return e.code}).join(";\n"),f="return $out",y=[u,s,a,f].join(";\n");if(e.compileDebug){var m="{"+["path:"+p(o),'name:"RuntimeError"',"message:e.message","line:$line[0]+1","start:$line[1]+1","source:$line[2]","stack:e.stack"].join(",")+"}";y="try{"+y+"}catch(e){throw "+m+"}"}y="function("+c+"){\n"+y+"\n}";try{return new Function(l,"return "+y)(i)}catch(h){for(var v=0,d=0,b=0,g=r;v<n.length;){var x=n[v];if(!this.checkExpression(x.code)){g=x.source,d=x.tplToken.line,b=x.tplToken.start;break}v++}throw{path:o,name:"CompileError",message:h.message,line:d+1,start:b+1,source:g,script:y,stack:h.stack}}}}]),e}();e.exports=y},function(e,t,n){"use strict";var r=n(4)["default"],o=n(4).matchToToken,i=n(3),u=function(e){var t=e.match(r).map(function(e){return r.lastIndex=0,o(r.exec(e))}).map(function(e){return"name"===e.type&&i(e.value)&&(e.type="keyword"),e});return t};e.exports=u},function(e,t,n){"use strict";var r="string",o="expression",i="raw",u="escape",s=function(e,t,n){for(var i=[{type:r,value:e,line:0,start:0,end:e.length}],u=function(e){for(var t=e.test.ignoreCase?"ig":"g",u=e.test.source+"|^$|[\\w\\W]",s=new RegExp(u,t),a=0;a<i.length;a++)if(i[a].type===r){for(var c=i[a].line,l=i[a].start,f=i[a].end,p=i[a].value.match(s),y=[],m=0;m<p.length;m++){var h=p[m];e.test.lastIndex=0;var v=e.test.exec(h),d=v?o:r,b=y[y.length-1],g=b||i[a],x=g.value;l=g.line===c?b?b.end:l:x.length-x.lastIndexOf("\n")-1,f=l+h.length;var w={type:d,value:h,line:c,start:l,end:f};if(d===r)b&&b.type===r?(b.value+=h,b.end+=h.length):y.push(w);else{var $=e.use.apply(n,v);w.script=$,y.push(w)}c+=h.split(/\n/).length-1}i.splice.apply(i,[a,1].concat(y)),a+=y.length-1}},s=0;s<t.length;s++)u(t[s]);return i};s.TYPE_STRING=r,s.TYPE_EXPRESSION=o,s.TYPE_RAW=i,s.TYPE_ESCAPE=u,e.exports=s},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(6),i=n(0),u=n(1),s=function(e,t){return"object"===("undefined"==typeof t?"undefined":r(t))?o({filename:e},t):i({filename:e,source:t})};s.render=o,s.compile=i,s.defaults=u,e.exports=s}])});
TFL.widget("pinyinuserchooser",{defaults:{id:"",chooserType:"1",dataSrcPath:"",dataSrcParam:""},_init:function(){var e=this;TFL.pinyinuserchooser.options=e.options,TFL.use("typeahead",function(){e._do_init()}),"undefined"==typeof isCloud&&(isCloud=!1)},_do_init:function(){if("undefined"!=typeof this.options&&this.options.id){var e=this,o=e.options,r=$("#"+o.id);if(TFL.pinyinuserchooser.blur_handlers=TFL.pinyinuserchooser.unable_blur(o.id),r.length&&!$("#"+o.id+"Value").length){o.name=r.attr("name")||"";var n=r.val()||"",t=!r.is("[hide-recentpanel]"),i=r.is("[data-blocked-user]");o.value=n,o.skin=r.attr("skin")&&"new"===r.attr("skin"),o.optionOffsetLeft=Number(r.attr("left")||0),o.optionOffsetTop=Number(r.attr("top")||0),r.attr("rencentusers-max-length")?o.usersMaxLength=r.attr("rencentusers-max-length"):o.usersMaxLength=10,r.attr({id:o.id+"Value",autocomplete:"off","userchooser-init":!0}).removeAttr("name"),r.val(n);var s=$("<input type='hidden'/>").attr({id:o.id,name:o.name,userchooser:"true"}).val(o.value);if(o.skin&&this._initChooserInput(r),i&&$("#"+o.id+"ShowCardValue").length>0){var a=$("#"+o.id+"ShowCardValue").val().split(";");""==a[a.length-1]&&a.pop();for(var u=a.length-1;u>=0;u--)a[u]=a[u].split("(")[0];TFL.pinyinuserchooser.blockUsers[o.id]=a,s.val(a.join(";")+";"),$("#"+o.id+"ShowCardValue").remove()}r.before(s),r.on("focus",function(){i&&r.css("vertical-align","0px"),0!=r.val().length&&r.val()!=TFL.pinyinuserchooser.config.loadingText&&";"!=r.val().slice(-1)&&r.val(r.val()+";"),!$(this).data("ieTypeaheadFocus")&&t&&e._showRecentUserPanel(),$(this).data("ieTypeaheadFocus",0),r.data("isDataLoad")||(r.data("isDataLoad",!0),e._getData())}).bind("mousedown",function(e){e.stopPropagation()}).bind("mouseup",function(e){TFL.pinyinuserchooser.selectionName=TFL.pinyinuserchooser.getSelectionName(r[0]),e.stopPropagation()}).bind("mouseout",function(e){TFL.pinyinuserchooser.selectionName=TFL.pinyinuserchooser.getSelectionName(r[0]),e.stopPropagation()}).bind("keydown",function(e){TFL.pinyinuserchooser.selectionName=TFL.pinyinuserchooser.getSelectionName(r[0]),TFL.pinyinuserchooser.enable_blur(o.id),TFL.pinyinuserchooser.hideRecentUserPanel()}).bind("keydown",function(e){13==e.keyCode?e.preventDefault():8==e.keyCode&&""===r.val()&&0!==$(".user-block-item").length&&TFL.pinyinuserchooser.removeUserItem(s)}).bind("blurred",function(e){i&&TFL.pinyinuserchooser.blockedUser($(this),s)}),r.parents(".showvalue").off("click.removeUserItem").delegate(".ico-remove-s","click.removeUserItem",function(e){TFL.pinyinuserchooser.removeUserItem(s,$(this).closest(".user-block-item"))}),o.isInline&&(r.bind("blur",function(e){TFL.pinyinuserchooser.enable_blur(o.id)}),r.focus()),i&&r.closest(".showvalue").find(".user-block-item-wrap").length>0&&e._initBlockUserSortable()}}},_initBlockUserSortable:function(){if("undefined"!=typeof this.options&&this.options.id){var e=this,o=e.options;$("#"+o.id);TFL.use("sortable",function(){var e=$("#"+o.id).closest(".showvalue"),r=e.find(".user-block-item-wrap"),n=$("#"+o.id),t={cursor:"move",handler:".user-block-item",stop:function(e,o){var t="",i=[],s=r.find(".user-block-item");s.each(function(e,o){var r=$(o).find("span").text().split("(")[0];i.push(r)}),t=i.join(";"),t=";"+t+";",n.val(t)}};r.sortable(t)})}},_replaceSelectionName:function(e){var o=this.options,r=$("#"+o.id+"Value"),n=$("#"+o.id);if(TFL.pinyinuserchooser.selectionName){for(var t=this._cleanNicks(TFL.pinyinuserchooser.selectionName),i=t.split(";"),s=this._cleanNicks(r.val()),a=0;a<i.length-1;a++)s=s.replace(i[a]+";","");0!=e.length&&(s+=e+";"),r.val(s),n.val(s)}},_cleanNicks:function(e){e=e.split(";");for(var o,r,n=[],t=0;t<e.length;t++)o=$.trim(e[t]),0!==o.length&&(r=-1!==o.indexOf("(")?o.indexOf("("):-1!==o.indexOf("（")?o.indexOf("（"):-1,o=0>r?o:o.substring(0,r),n.push(o));return n.push(" "),$.trim(n.join(";"))},_getData:function(){var self=this,options=self.options,varName,url="",dataObj={};self._disableCtl(),dataObj=TFL.pinyinuserchooser.getData(options),varName=dataObj.varName,url=dataObj.url,"undefined"==typeof eval("window."+varName)?loadJs(url,function(){self._initData(varName)}):self._initData(varName)},_disableCtl:function(){var e=this.options,o=$("#"+e.id+"Value");o.val()!=TFL.pinyinuserchooser.config.loadingText&&o.data("original-value",o.val()),o.val(TFL.pinyinuserchooser.config.loadingText).css("color","#9E9E9E").attr("readonly",!0),$.browser.msie&&o.blur()},_enableCtl:function(){var e=this.options,o=$("#"+e.id+"Value"),r="undefined"==typeof _workspace_id?0:_workspace_id;e.dataSrcPath&&(r=TFL.getQueryValue("workspace_id",e.dataSrcParam)),o.css("color","#000000").attr({"data-init":!0,readonly:!1}),o.val()==TFL.pinyinuserchooser.config.loadingText&&(o.val(o.data("original-value")),0!=o.val().length&&o.val()!=TFL.pinyinuserchooser.config.loadingText&&";"!=o.val().slice(-1)&&o.val(o.val()+";"));var n=$("#recent-user-panel");n.is(":visible")?o.focus():TFL.use("localData",function(){TFL.localData.get("recentUserInput"+r)||o.focus()});var t=o.attr("data-loaded-callback");if(t&&""!=t){var i=new Function("return "+t)();i()}},_initData:function(varName){var options=this.options,chooserType=TFL.pinyinuserchooser.getChooserType(options.chooserType),varName="window."+(varName||"_arr"+chooserType);if(!$("#"+options.id+"Value").attr("data-init")){if(this.typeaheadEle=TFL.pinyinuserchooser.setChooser(eval(varName),options,varName),"undefined"==typeof window._newarruserspinyin||options.dataSrcParam&&"1"==TFL.getQueryValue("disabled",options.dataSrcParam)){var users=eval(varName);TFL.pinyinuserchooser.getIdNickMap(users)}if(options.dataSrcParam&&"1"==TFL.getQueryValue("disabled",options.dataSrcParam))var users=eval(varName);this._enableCtl()}},_showRecentUserPanel:function(){var e=this,o=e.options,r=$("#recent-user-panel");r.hide();var n="undefined"==typeof _workspace_id?0:_workspace_id;if(o.dataSrcPath&&(n=TFL.getQueryValue("workspace_id",o.dataSrcParam)),r.attr("from-click-select"))return void r.removeAttr("from-click-select");if(!r.is(":visible")||r.data("relationInput")!=o.id){if(!r.length){var t=$("<div></div>").addClass("dropdown-menu").hide().attr("id","recent-user-panel"),i=$("<ul></ul>"),s=$("<div></div>").addClass("dropdown-shadow");t.append(i).append(s).appendTo("body"),t.mousedown(function(e){e.stopPropagation()})}TFL.pinyinuserchooser.unable_blur(o.id),$("#recent-user-panel").data("relationInput",o.id),TFL.use("localData",function(){var r=TFL.localData.get("recentUserInput"+n);if(r){var t=r.split(";"),i=$("<li class='recent-input-tt'><span>最近输入</span></li>"),s=$("#recent-user-panel"),a=s.find("ul");a.html(""),t.length>o.usersMaxLength&&(t.length=o.usersMaxLength);for(var u=0;u<t.length&&u<TFL.pinyinuserchooser.config.recentShowCount;u++)if(!("1"==o.chooserType&&"g_"==t[u].substring(0,2)||"2"==o.chooserType&&"g_"!==t[u].substring(0,2))&&t[u]&&0!=t[u].indexOf("(")){var c=t[u],l="",p=c.split("|");p.length>1?(id=p[1],c=p[0]):id="avatar_default",l=$("<li><a href='javascript:;'><img class='hidden-avatar-default'/><span>"+c+"</span></a></li>");var h=-1!==c.indexOf("(")?c.indexOf("("):-1!==c.indexOf("（")?c.indexOf("（"):-1;c=0>h?c:c.substring(0,h),TFL.pinyinuserchooser.modifyRow({ui:l,name:t[u],nick:c,workspaceID:n,id:id}),a.append(l)}0==a.find(".recent-input-tt").length&&a.prepend(i);var d=$(".tfl-userchooser").length?$(".tfl-userchooser"):$("#"+o.id+"Value");offsetTop=5,optionOffsetTop=Number(o.offsetTop||0),optionOffsetLeft=Number(o.offsetLeft||0),inputHei=d.outerHeight()-1,offset=d.offset(),inputWidth=d.outerWidth()-2,recentPanelTop=offset.top+inputHei+offsetTop,offset.top+inputHei+$("#recent-user-panel").outerHeight()>=$(document).outerHeight()&&$("#recent-user-panel").outerHeight()<offset.top&&(recentPanelTop=offset.top-$("#recent-user-panel").outerHeight()-offsetTop+optionOffsetTop),a.css("min-width",inputWidth),TFL.pinyinuserchooser.setPanelPosition(offset.left+optionOffsetLeft,recentPanelTop);var f=setInterval(function(){var e=d.offset();if((0!=e.left||0!=e.top)&&(e.top!=offset.top||e.left!=offset.left||$.browser.mozilla)){clearInterval(f);var o=e.top+inputHei+offsetTop;e.top+inputHei+$("#recent-user-panel").outerHeight()>=$(document).outerHeight()&&$("#recent-user-panel").outerHeight()<e.top&&(o=e.top-$("#recent-user-panel").outerHeight()-offsetTop),TFL.pinyinuserchooser.setPanelPosition(e.left+optionOffsetLeft,o)}},300);setTimeout(function(){clearInterval(f)},1e3),s.find("a").unbind("click").bind("click",function(r){r.preventDefault();var n=$("#"+o.id+"Value");ifDataInit=n.attr("data-init")?!0:!1,!ifDataInit&&n.css("color","#000000").attr("readOnly",!1);var t=n.val();";"!=t.substr(t.length-1,t.length)&&""!==t&&t!=TFL.pinyinuserchooser.config.loadingText&&(t+=";");var i=""===t||t==TFL.pinyinuserchooser.config.loadingText?"":t,s=$(this).find("span").text(),a=s,u=s.split("(")[0],c=TFL.pinyinuserchooser.selectionName;if(c){i=e._cleanNicks(i),c=e._cleanNicks(c);var l=i.replace(c,"");-1==l.indexOf(a)&&-1==l.indexOf(u)?e._replaceSelectionName(u):n.val(l)}else{var p=t.split(";");p.pop();var h="";if($.each(p,function(e,o){h=h+o.split("(")[0]+";"}),-1==h.indexOf(u)){if(ChooserInput.cursorSet){var d=[];i.split(";").forEach(function(e,o){o===ChooserInput.cursorIndex+1?(d.push(u),d.push(e)):d.push(e)}),d=d.join(";")}else var d=i+u;d=e._cleanNicks(d),n.val(d)}}TFL.pinyinuserchooser.selectionName="",$("#"+o.id+"Value").val(n.val()).focus(),$("#"+o.id).val(n.val()),o.skin&&(ChooserInput.setChooserInputVal(n.val()),$(".tfl-userchooser").click()),ifDataInit||window._setCaret&&_setCaret(n[0],n[0].value.length),"false"!=n.attr("autohide")&&setTimeout(function(){TFL.pinyinuserchooser.enable_blur(o.id),TFL.pinyinuserchooser.hideRecentUserPanel()},0)})}})}},_initChooserInput:function(e){$(".tfl-userchooser").remove();var o=$('<div class="tfl-userchooser"></div>'),r=this;$("body").append(o),setTimeout(function(){var n=e.offset(),t=10,i=window.scrollX;n.left+o.outerWidth()>window.innerWidth&&(n.left=window.innerWidth-o.outerWidth()-t+i),o.css({left:n.left-1+r.options.optionOffsetLeft,top:n.top-1+r.options.optionOffsetTop,opacity:1})},0),ChooserInput.setChooserInputVal(e.val()),o.click(function(n){$("#"+r.options.id+"Value").focus(),ChooserInput.changeChooserInputCurosrPos(n,o,e)}).delegate(".userchooser-user-btn","click",function(){var r=$(this).parents(".userchooser-user");ChooserInput.removeInputUser(e,r),ChooserInput.adjustChooserInputHeight(o)}).blur(function(r){o.remove(),$("#recent-user-panel").remove(),ChooserInput.clearCursorRecord(),e.blur()}),e.focus().keydown(function(r){var n=o.find(".userchooser-cursor-wrap").text();if(0===o.find(".userchooser-cursor-wrap .text").text().length&&13===r.keyCode)return o.blur(),!1;if(ChooserInput.firstInput&&ChooserInput.cursorSet&&ChooserInput.cursorIndex){var t=e.val().split(";").slice(0,ChooserInput.cursorIndex+1).join(";").length;t=t?t+1:0,ChooserInput.objInputSetCaret(e[0],t),ChooserInput.firstInput=!1}if(8===r.keyCode)if(n)o.find(".userchooser-cursor-wrap .text").text(n.substring(0,n.length-1));else{var i=o.find(".userchooser-cursor-wrap").prev();i.hasClass("userchooser-user")&&ChooserInput.removeInputUser(e,i)}else 1===r.key.length?o.find(".userchooser-cursor-wrap .text").text(n+r.key):13===r.keyCode&&(ChooserInput.firstInput=!0);ChooserInput.adjustChooserInputHeight(o)}).on("compositionend",function(e){var o=$(e.target);ChooserInput.compositionCache&&(o.val(ChooserInput.compositionCache),o.blur(),$(".tfl-userchooser").click()),ChooserInput.compositionCache=""}).on("compositionstart",function(e){ChooserInput.compositionCache=$(e.target).val()}),$("body").undelegate(":not(.tfl-userchooser)","click").delegate(":not(.tfl-userchooser)","click",function(){var e=$(this);return e.parents("#recent-user-panel").length||e.parents(".tt-dropdown-menu").length||e.parents(".tfl-userchooser").length?!1:void $(".tfl-userchooser").blur()})}},!0,!0);var ChooserInput={cursorIndex:0,cursorSet:!1,firstInput:!0,setChooserInputVal:function(e){window[TFL.pinyinuserchooser.getData().varName]&&(e=TFL.pinyinuserchooser.filterNickString(window[TFL.pinyinuserchooser.getData().varName],e));var o=$(".tfl-userchooser"),r=$(document.createDocumentFragment()),n=this,t=!1;n.cursorIndex++,e.split(";").forEach(function(e,o){e&&r.append($('<div class="userchooser-user"><span title="'+e+'">'+e+'</span><span class="userchooser-user-btn"><i class="font font-close-s"></i></span></div>')),n.cursorSet&&o===n.cursorIndex&&(t=!0,r.append($('<div class="userchooser-cursor-wrap"><span class="text"></span><span class="userchooser-cursor"></span></div>')))}),t||r.append($('<div class="userchooser-cursor-wrap"><span class="text"></span><span class="userchooser-cursor"></span></div>')),o.html(r[0]),this.adjustChooserInputHeight(o),this.clearCursorText(o)},adjustChooserInputHeight:function(e){e.children().each(function(o,r){var n=$(r);n.offset().top+n.outerHeight()>e.offset().top+e.outerHeight()&&e.outerHeight(e.outerHeight()+25)});var o=e.children().last();e.offset().top+e.outerHeight()-o.offset().top-o.outerHeight()>25&&e.outerHeight(e.outerHeight()-25)},removeInputUser:function(e,o){var r=o.find("span:first").text().replace(/\([^()]*\)/,""),n=e.val(),t=n.split(";"),i=0;t.forEach(function(e,o){e=e.replace(/\([^()]*\)/,""),e.indexOf(r)>-1&&(i=o)}),t.splice(i,1),o.remove(),setTimeout(function(){e.val(t.join(";"))},0)},clearCursorText:function(e){e.find(".userchooser-cursor-wrap .text").text("")},changeChooserInputCurosrPos:function(e,o,r){var n=$(e.target);if(n.hasClass("userchooser-user")||n.parents(".userchooser-user").length)return!1;this.cursorSet=!1,this.cursorIndex=0;var t=this;if(o.find(".userchooser-user").each(function(r,n){n=$(n);var i=e.clientY-n.offset().top,s=e.clientX-n.offset().left-n.outerWidth();!t.cursorSet&&20>=i&&i>0&&50>=s&&s>0&&(n.after(o.find(".userchooser-cursor-wrap").find(".text").text("").end()),t.cursorIndex=r,t.cursorSet=!0);var s=n.offset().left-e.clientX;!t.cursorSet&&20>=i&&i>0&&10>=s&&s>0&&(n.before(o.find(".userchooser-cursor-wrap").find(".text").text("").end()),t.cursorIndex=r-1,t.cursorSet=!0)}),this.cursorSet){var i=r.val().split(";").slice(0,this.cursorIndex+1).join(";").length;i=i?i+1:0,this.objInputSetCaret(r[0],i)}},objInputSetCaret:function(e,o){if(e.focus(),e.setSelectionRange)e.setSelectionRange(o,o);else if(e.createTextRange){var r=e.createTextRange();r.moveStart("character",o),r.collapse(),r.select()}},clearCursorRecord:function(){this.cursorSet=!1,this.cursorIndex=0}};TFL.pinyinuserchooser.setChooserInputVal=function(e){$(".tfl-userchooser").length&&ChooserInput.setChooserInputVal(e)},TFL.pinyinuserchooser.getIdNickMap=function(e){"undefined"!=typeof e&&(window._newarruserspinyin=[],$.map(e,function(e){window._newarruserspinyin[e[0]]=e}))},TFL.pinyinuserchooser.getBloodhoundData=function(e,o){"undefined"==typeof window.bloodhoundData&&(window.bloodhoundData=[]);var r=[];if("undefined"==typeof window.bloodhoundData[o]){for(var n=0;n<e.length;n++){var t=e[n];r.push({value:t[0]+" "+t[1]+" "+t[2]+" "+t[4]+" ",show:0===t[2].length?t[0]:t[0]+"("+t[2]+")"})}window.bloodhoundData[o]=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace(e.value)},queryTokenizer:Bloodhound.tokenizers.whitespace,local:r}),window.bloodhoundData[o].initialize()}return window.bloodhoundData[o]},TFL.pinyinuserchooser.setChooser=function(e,o,r){var n=o.id,t=(TFL.pinyinuserchooser.getChooserType(o.chooserType),"#"+n+"Value"),i=TFL.pinyinuserchooser.getBloodhoundData(e,r);TFL.pinyinuserchooser.bloodhound_users=i;var s=$(t).typeahead({hint:!0,highlight:!0,minLength:1,autoselect:!0},{name:"stats",displayKey:"show",source:i.ttAdapter()});return s.on("typeahead:closed",function(o,r){var i,a=s.val();a=a.split(";");for(var u=[],c=[],l=0;l<a.length;l++){i=a[l];var p=TFL.pinyinuserchooser.binSearch(e,i);if(-1!=p&&-1==$.inArray(i,u)){var h=0===e[p][2].length?e[p][0]:e[p][0]+"("+e[p][2]+")";u.push(h),c.push(e[p][0])}else if(-1==p&&isCloud){var d=i.indexOf("(");-1==d&&(d=i.indexOf("（"));var f=d>0?i.substring(0,d):i;TFL.pinyinuserchooser.bloodhound_users.get(f,function(e){if(e.length>0){var o=e[0].show,r=o.indexOf("(");-1==r&&(r=o.indexOf("（")),-1!=r?c.push(o.substring(0,r)):c.push(o),u.push(o)}})}}u.length>0&&(u.push(" "),c.push(" ")),i=u.join(";").trim(),c=c.join(";").trim(),s.val(i),$("#"+n).val(c),TFL.pinyinuserchooser.saveData($(t)[0]),s.trigger("blurred")}),s.on("typeahead:selected",function(e,o){}),s.on("typeahead:autocompleted",function(e,o){}),$("#recent-user-panel").is(":visible")||TFL.pinyinuserchooser.enable_blur(o.id),s},TFL.pinyinuserchooser.filterNickString=function(e,o){o=o.split(";");for(var r,n=[],t=[],i=0;i<o.length;i++){r=o[i];var s=TFL.pinyinuserchooser.binSearch(e,r);if(-1!=s&&-1==$.inArray(r,n)){var a=0===e[s][2].length?e[s][0]:e[s][0]+"("+e[s][2]+")";n.push(a),t.push(e[s][0])}}return t.join(";").trim()},TFL.pinyinuserchooser.saveData=function(e){TFL.use("localData",function(){var o=$(e);if(""!==o.val()){var r="undefined"==typeof _workspace_id?0:_workspace_id;o.data("srcParam")&&(r=TFL.getQueryValue("workspace_id",o.data("srcParam")));var n=TFL.localData.get("recentUserInput"+r)||"",t=o.val().split(";"),i="";""===t[t.length-1]&&(t=t.slice(0,t.length-1));for(var s=0,a=t.length;a>s;s++){var u=-1!==t[s].indexOf("(")?t[s].indexOf("("):-1!==t[s].indexOf("（")?t[s].indexOf("（"):-1,c=0>u?t[s]:t[s].substring(0,u);if(window._newarruserspinyin[c])var l=window._newarruserspinyin[c][3];else var l="";var p=t[s]+"|"+l;if(i=p+";"+i,-1!=n.indexOf(p)){var h=p+";",d=-1!=n.indexOf(h)?h:p;d=";"==d?"":d,n=n.replace(d,"")}}";"!=i.substring(i.length-1,i.length)&&(i+=";");for(var f=(i+n).split(";"),v=[],y=0,T=f.length;T>y;y++)y<TFL.pinyinuserchooser.config.storageCount&&""!==f[y]&&$.inArray(f[y],v)<0&&v.push(f[y]);TFL.localData.set("recentUserInput"+r,v.join(";"),{path:"/"})}})},TFL.pinyinuserchooser.beforeActive=function(){var e=$(this);e.attr("userchooser-init")||TFL.pinyinuserchooser.active(e,!1)},TFL.pinyinuserchooser.active=function(e,o){TFL.use("typeahead",function(){var r=$(e);r.each(function(){var e=$(this);if(!e.attr("userchooser-init")){var r=e.attr("id")||"",n=e.attr("chooser-type")||"1",t=e.attr("data-src-path")||"",i=e.attr("data-src-param")||"";TFL.pinyinuserchooser({id:r,chooserType:n,dataSrcPath:t,dataSrcParam:i,isInline:o})}})})},TFL.pinyinuserchooser.init=function(){TFL.use("typeahead",function(){var e="[data-control='pinyinuserchooser'],[data-control='userchooser']",o=$("body");TFL.pinyinuserchooser.beforeActive(),o.delegate(e,"mouseenter",TFL.pinyinuserchooser.beforeActive),o.delegate(e,"focus",TFL.pinyinuserchooser.beforeActive),$("html").mousedown(function(){TFL.pinyinuserchooser.hideRecentUserPanel()})})},TFL.pinyinuserchooser.getChooserType=function(e){var o="userspinyin";if(isCloud)return o="userspinyin";switch(e){case"3":o="usersandadgroupspinyin";break;case"2":o="adgroups";break;case"4":o="usersoaandv";break;default:o="userspinyin"}return o},TFL.pinyinuserchooser.getDefaultSrcPath=function(){var e="";if(isCloud)TFL.path&&(e=-1!=TFL.path.indexOf("tiger.oa.com")||-1!=TFL.path.indexOf("lion.oa.com")?"http://tiger.oa.com/tapd3_cloud/":"undefined"!=typeof cloud_vpc_site&&cloud_vpc_site.length>1?location.protocol+"//"+cloud_vpc_site+"/":location.protocol+"//www.tapd.cn/");else if(TFL.path)if(-1!=TFL.path.indexOf("tdl.oa.com"))e="http://tapd.oa.com/";else if(-1!=TFL.path.indexOf("lion.oa.com")||-1!=TFL.path.indexOf("tiger.oa.com"))e="http://tiger.oa.com/tapd3/";else{TFL.path.substring(7,TFL.path.length-1).split("/")[0];e=-1!=TFL.path.indexOf("tdl.tapd.tencent.com")?location.protocol+"//tapd.tencent.com/":"http://tapd.oa.com/"}return e},TFL.pinyinuserchooser.dataSrcParam=function(){return"?workspace_id="+("undefined"==typeof _workspace_id?0:_workspace_id)},TFL.pinyinuserchooser.hideRecentUserPanel=function(){var e=$("#recent-user-panel");e.length>0&&e.hide()},TFL.pinyinuserchooser.setPanelPosition=function(e,o){var r=$("#recent-user-panel");setTimeout(function(){r.css({left:e,top:o,display:"block"})},0)},TFL.pinyinuserchooser.config={loadingText:"loading...",storageCount:window.localStorage?10:5,recentShowCount:window.localStorage?10:5},TFL.pinyinuserchooser.getSelectionName=function(e){var o,r,n="";if(e.setSelectionRange)o=e.selectionStart,r=e.selectionEnd,n=o!=r?e.value.substring(o,r):"";else if(document.selection){var t=document.selection.createRange(),i=document.body.createTextRange();i.moveToElementText(e),n=t.text}if(""===n)return"";for(var s=n.split(";"),a="",u=e.value.split(";"),c=0,l=s.length;l>c;c++){var p=s[c];if(0!=p.length)for(var h=0,d=u.length;d-1>h;h++){var f=u[h];-1!=f.indexOf(p)&&-1==a.indexOf(f)&&(a+=f+";")}}return a},TFL.pinyinuserchooser.binSearch=function(e,o){if(0===o.trim().length)return-1;var r,n=0,t=e.length-1,i=o.indexOf("(");-1==i&&(i=o.indexOf("（"));for(var s=i>0?o.substring(0,i).toLowerCase():o.toLowerCase();t>=n;){if(e[n][0].toLowerCase()==o.toLowerCase())return n;if(e[t][0].toLowerCase()==o.toLowerCase())return t;r=Math.floor((n+t)/2);var a=e[r][0].indexOf("(");-1==a&&(a=e[r][0].indexOf("（")),a=-1==a?e[r][0].length:a;var u=e[r][0].substring(0,a).toLowerCase();if(s==u)return r;u>s?t=r-1:n=r+1}return-1},TFL.pinyinuserchooser.unable_blur=function(e){var o=$("#"+e).data("events")&&$("#"+e).data("events").blur;if("undefined"!=typeof o&&o.length>0)for(var r=0;r<o.length;r++)TFL.pinyinuserchooser.blur_handlers.push(o[r].handler);return $("#"+e).unbind("blur"),TFL.pinyinuserchooser.blur_handlers},TFL.pinyinuserchooser.enable_blur=function(e){TFL.pinyinuserchooser.blur_handlers.length>0&&($.each(TFL.pinyinuserchooser.blur_handlers,function(o,r){$("#"+e+"Value").blur(r)}),TFL.pinyinuserchooser.blur_handlers=[])},TFL.pinyinuserchooser.getDisplayObj=function(e){var o=$("#"+e),r=o;return"hidden"==o.attr("type")&&(r=$("#"+e+"Value")),r},TFL.pinyinuserchooser.getVarNameSuffix=function(e){function o(o){for(var r=0,n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n),r|=0;return r}var r=0,n="",t=e;do r=o(t),n=TFL.pinyinuserchooser._varNameHash[r];while(!1);return r=0>r?"_"+-r:""+r,TFL.pinyinuserchooser._varNameHash[r]=e,r},TFL.pinyinuserchooser.getVarName=function(e){var o=$(e),r=TFL.pinyinuserchooser.getChooserType(o.data("chooserType")),n=o.data("srcParam"),t="undefined"==typeof _workspace_id?0:_workspace_id,i="_arr"+r;return n&&(t=TFL.getQueryValue("workspace_id",n)||t,i="_arr_"+t+"_"+r+TFL.pinyinuserchooser.getVarNameSuffix(n)),i},TFL.pinyinuserchooser._varNameHash={},TFL.pinyinuserchooser.modifyRow=function(e){},TFL.pinyinuserchooser.blockedUser=function(e,o,r){var n,t,i,s,a=$(".user-block-item"),u=o.attr("id"),c=e.parents(".showvalue").find(".user-block-item").last(),l="undefined"==typeof r?e.val().split(";"):r;for(a.hide(),i=0;i<l.length;i++)s=l[i].split("(")[0],"undefined"==typeof TFL.pinyinuserchooser.blockUsers[u]&&(TFL.pinyinuserchooser.blockUsers[u]=[]),0!==l[i].length&&-1==$.inArray(s,TFL.pinyinuserchooser.blockUsers[u])&&(n=$('<span class="user-block-item"></span>'),t=$("<span></span>").text(l[i]),n.append(t).append('<i class="ico-remove-s"></i>'),0==c.length?e.parents(".showvalue").find(".user-block-item-wrap").length>0?e.parents(".showvalue").find(".user-block-item-wrap").prepend(n):e.parents(".showvalue").prepend(n):c.after(n),c=n,TFL.pinyinuserchooser.blockUsers[u].push(s),"undefined"==typeof r&&"function"==typeof TFL.pinyinuserchooser.blockedUserCallBack[u]&&TFL.pinyinuserchooser.blockedUserCallBack[u](s));a.show(),o.val(TFL.pinyinuserchooser.blockUsers[u].join(";")+";"),e.val("")},TFL.pinyinuserchooser.removeUserItem=function(e,o){var r=e.attr("id"),o="undefined"!=typeof o?o:$("#"+r+"Value").parents(".showvalue").find(".user-block-item").last(),n=o.text().split("(")[0];o.remove();var t=$.inArray(n,TFL.pinyinuserchooser.blockUsers[r]);t>-1&&(TFL.pinyinuserchooser.blockUsers[r].splice(t,1),e.val(TFL.pinyinuserchooser.blockUsers[r].join(";")+";"),"function"==typeof TFL.pinyinuserchooser.removeBlockedUserCallBack[r]&&TFL.pinyinuserchooser.removeBlockedUserCallBack[r](n))},TFL.pinyinuserchooser.removeUserItemByName=function(e,o){var r=o.attr("id");$("#"+r+"Value").parents(".showvalue").find(".user-block-item span").each(function(){var n=$(this).text(),t=n.split("(")[0];if($.inArray(n,e)>-1){$(this).closest(".user-block-item").remove();var i=$.inArray(t,TFL.pinyinuserchooser.blockUsers[r]);TFL.pinyinuserchooser.blockUsers[r].splice(i,1),o.val(TFL.pinyinuserchooser.blockUsers[r].join(";")+";")}})},TFL.pinyinuserchooser.blur_handlers=new Array,TFL.pinyinuserchooser.selectionName="",TFL.pinyinuserchooser.blockUsers=[],TFL.pinyinuserchooser.blockedUserCallBack=[],TFL.pinyinuserchooser.removeBlockedUserCallBack=[],TFL.pinyinuserchooser.defaultTimestamp=(new Date).getTime(),TFL.pinyinuserchooser.getData=function(e){var o=e||TFL.pinyinuserchooser.options;o||(o={});var r=o.chooserType?TFL.pinyinuserchooser.getChooserType(o.chooserType):TFL.pinyinuserchooser.getChooserType(),n=o.dataSrcPath||TFL.pinyinuserchooser.getDefaultSrcPath(),t=o.dataSrcParam||TFL.pinyinuserchooser.dataSrcParam(),i="undefined"==typeof _workspace_id?0:_workspace_id,s="",a="_arr"+r;isCloud&&t&&(i=TFL.getQueryValue("workspace_id",t)||i,a="_arr_"+i+"_"+r+TFL.pinyinuserchooser.getVarNameSuffix(t),s="/"+a);var u="";if(u=isCloud?n+"js/"+r+".js"+s+t:n+"js/"+r+".js"+t,isCloud){var c=TFL.getQueryValue("r",u);""==c&&(u+=""==t?"?":"&",u+="undefined"!=typeof userChooserVersion&&userChooserVersion!==!1?"r="+userChooserVersion:"r="+TFL.pinyinuserchooser.defaultTimestamp)}return isCloud||o.dataSrcParam&&"1"==TFL.getQueryValue("disabled",o.dataSrcParam)&&(a+="_all"),{varName:a,url:u}},TFL.pinyinuserchooser.getMatchData=function(query,cb){function initData(varName){var options=TFL.pinyinuserchooser.options,chooserType=TFL.pinyinuserchooser.getChooserType(options.chooserType),varName="window."+(varName||"_arr"+chooserType),users=TFL.pinyinuserchooser.getBloodhoundData(eval(varName),varName),match=users.get(query);return match}var dataObj=TFL.pinyinuserchooser.getData(),varName=dataObj.varName,url=dataObj.url;"undefined"==typeof eval("window."+varName)?loadJs(url,function(){cb(initData(varName))}):cb(initData(varName))},TFL.pinyinuserchooser.getWorkspaceID=function(e){var o=$(e).data("srcParam"),r="undefined"==typeof _workspace_id?0:_workspace_id;return o&&(r=TFL.getQueryValue("workspace_id",o)||r),r};
TFL.widget("pinyinuserchooser.avatar",{isDelay:!1,getAvatar:function(t,e,r,i,n){if(0==isCloud)var a=_base+r+"/users/avatar/"+e.replace(/\([^\)]*\)/g,"");else var n=n||this.getAvatarVersion(e),a=_base+_workspace_id+"/users/avatar/"+t+"?t="+n;var s=$('<img src="'+a+'">'),o="";s.load(function(){o='<img src="'+a+'">',i.trigger("cloudAvatarImg.loaded",[o,a])}).error(function(){var t=/[A-Za-z0-9_\.]/,r="";r=t.test(e)?e.substr(0,2):e.substr(-2,2),o='<i style="font-style: normal;" class="avatar-text-default" title="'+e+'">'+r+"</i>",i.trigger("cloudAvatarImg.loaded",[o])})},getAvatarVersion:function(t){Date.prototype.toISOString||!function(){function t(t){var e=String(t);return 1===e.length&&(e="0"+e),e}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+t(this.getUTCMonth()+1)+"-"+t(this.getUTCDate())+"T"+t(this.getUTCHours())+":"+t(this.getUTCMinutes())+":"+t(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}();var e=(new Date).toISOString().substr(0,10);return"undefined"!=typeof window._newarruserspinyin&&t in window._newarruserspinyin&&6==window._newarruserspinyin[t].length&&(e=window._newarruserspinyin[t][5]),e}}),TFL.pinyinuserchooser.modifyRow=function(t){var e=t.ui,r=t.nick,i=t.id,n=t.workspaceID;e.on("cloudAvatarImg.loaded",function(t,e,r){var i=$(this).find("a");return void 0!=r&&i.find("img").length>0?void i.find("img").attr("src",r).removeClass("hidden-avatar-default"):(i.find("img").remove(),void i.prepend(e))}),TFL.pinyinuserchooser.avatar.getAvatar(i,r,n,e)};
TFL.widget("avatarList",{init:function(a){"string"==typeof a||"undefined"==typeof a?this.list=a?$(a).find('.tfl-avatar-list,[data-editable="avatarlist"]'):$('.tfl-avatar-list,[data-editable="avatarlist"]'):"object"==typeof a&&a[0]&&1===a[0].nodeType&&(this.list=a),this.cacheUrlInfo||(this.cacheUrlInfo={}),this.imgLazyLoadQueue||(this.imgLazyLoadQueue=[]),this.imgLoadingMap||(this.imgLoadingMap={}),this.loadQueue?this.loadQueue=!0:this.initImgLazyLoadQueue(),this.initUserImg()},initUserImg:function(){var a=this;this.list.each(function(t,e){var i=a.initOptionByDom($(e));i&&i.showAddBtn&&$(e).addClass("show-button"),a.initUsersData(i),$(e).addClass("tfl-avatar-list"),a.mountUserImg($(e))}),this.initAction()},initUsersData:function(a,t){window.isLoadingUsersData||setTimeout(function(){var a=TFL.avatarList.userSourceData[TFL.pinyinuserchooser.getWorkspaceID()],e=a.varName,i=a.url;("undefined"==typeof window._newarruserspinyin||"undefined"==typeof window[e])&&(window.isLoadingUsersData=!0,loadJs(i,function(){return"undefined"==typeof window[e]?!1:(window.isLoadingUsersData=!1,void(t&&t()))}))},200)},cutNickName:function(a){var t=/[A-Za-z0-9_\.]/,e="";return e=t.test(a)?a.substr(0,2):a.substr(-2,2)},initImgLazyLoadQueue:function(){function a(a,i){t.imgLoadingMap[i]=!0;var r=$("<img />");r.load(function(){e--,delete t.imgLoadingMap[i],t.cacheUrlInfo[i]=!0,t.replaceTmpTag(a,i)}).error(function(){e--,delete t.imgLoadingMap[i],t.cacheUrlInfo[i]=!1}),r.attr("src",i)}var t=this,e=0;setInterval(function(){for(;t.imgLazyLoadQueue.length>0;){var i=t.imgLazyLoadQueue.shift();if(t.cacheUrlInfo[i.url])t.replaceTmpTag(i.user,i.url);else{if(e>=5||t.imgLoadingMap[i.url]){t.imgLazyLoadQueue.push(i);break}e++,a(i.user,i.url)}}},1e3)},findImgTagByCache:function(a,t){var e=this,i=[],r=[];return a.split(";").forEach(function(a){if(!a)return!1;if(a=a.replace(/\([^()]*\)/g,""),""!=a.trim()){var n=t.imgBaseUrl+a;if("undefined"!=typeof e.cacheUrlInfo[n]){var d;if(e.cacheUrlInfo[n])d='<img avatar-default-img-name="'+a+'" style="width:'+t.width+"px;height:"+t.height+'px;" src="'+n+'" title="'+a+'" /></div>';else{var s=e.cutNickName(a);d='<i style="line-height:30px; font-style: normal; width:'+t.width+"px;height:"+t.height+'px;" class="avatar-text-default" avatar-default-img-name="'+a+'" title="'+a+'">'+s+"</i>"}r.push(d)}else i.push(a)}}),{list:r,users:i}},replaceTmpTag:function(a,t){$('.one-user-avatar[avatar-default-img-name="'+a+'"][real-img-src="'+t+'"]').each(function(){var e=$(this).width(),i=$(this).height(),r='<img avatar-default-img-name="'+a+'" style="width:'+e+"px;height:"+i+'px;" src="'+t+'" title="'+a+'" />';$(this).replaceWith(r)})},reload:function(a,t){var e=$(a);e.data("avatar-users",t),this.mountUserImg(e)},send:function(a,t){var e=this,i={},r=a.val(),n=t.data("defaults");"loading..."===r&&(r="");var d=TFL.avatarList.userSourceData[TFL.pinyinuserchooser.getWorkspaceID()],s=TFL.pinyinuserchooser.filterNickString(window[d.varName],r);return i[n.sendKeyName]=s,i[n.sendKeyName]||("object"!=typeof n.data||0!==n.data.length)&&n.data?(t.data("avatar-users",i[n.sendKeyName]),t.data("editable-value")&&t.data("editable-value",i[n.sendKeyName]),n.sendParams&&$.extend(!0,i,n.sendParams),void(n.autoSubmit&&(a.remove(),t.html('<span class="loading2"></span>'),$.post(n.sendUrl+"?time="+ +new Date,i).success(function(a){e.mountUserImg(t),n.callBack.didChange.call(t,i[n.sendKeyName])}).done(function(){"undefined"!=typeof headFloat&&window.headFloat.init()})))):(e.mountUserImg(t),!1)},loadUserList:function(a,t){var e=this;if(["string","number"].indexOf(typeof a.data)>-1){if(!a.imgBaseUrl)throw new Error("缺少参数：data-avatar-imgBaseUrl");"number"==typeof a.data&&(a.data+="");var i=this.findImgTagByCache(a.data,a);if(0==i.users.length)t(i.list);else{var r=i.users,n=[];r.forEach(function(t){function i(){var e="";return window[d.varName]&&"[object Array]"===Object.prototype.toString.call(window[d.varName])?(window[d.varName].forEach(function(i){i[0]===t&&(e=a.imgBaseUrl+i[3])}),e||(e=a.imgBaseUrl+t)):e=a.imgBaseUrl+t,e}if(""!=t.trim()){var r;if(isCloud){var d=TFL.avatarList.userSourceData[TFL.pinyinuserchooser.getWorkspaceID()],s="";s=window[d.varName]&&"[object Array]"===Object.prototype.toString.call(window[d.varName])?i():a.imgBaseUrl+t}else var s=a.imgBaseUrl+t;if("undefined"!=typeof e.cacheUrlInfo[s])if(e.cacheUrlInfo[s])r='<img class="one-user-avatar" avatar-default-img-name="'+t+'" style="width:'+a.width+"px;height:"+a.height+'px;" src="'+s+'" title="'+t+'" />';else{var l=e.cutNickName(t);r='<i style="line-height:30px; font-style: normal; width:'+a.width+"px;height:"+a.height+'px;" class="one-user-avatar avatar-text-default" avatar-default-img-name="'+t+'" title="'+t+'">'+l+"</i>"}else if(e.imgLoadingMap[s]||e.imgLazyLoadQueue.push({defaults:a,user:t,url:s}),""!=a.defaultImg)r='<img class="one-user-avatar" avatar-default-img-name="'+t+'" real-img-src="'+s+'" style="width:'+a.width+"px;height:"+a.height+'px;" src="'+a.defaultImg+'" title="'+t+'" />';else{var l=e.cutNickName(t);r='<i style="line-height:30px; font-style: normal; width:'+a.width+"px;height:"+a.height+'px;" class="one-user-avatar avatar-text-default" avatar-default-img-name="'+t+'" real-img-src="'+s+'" title="'+t+'">'+l+"</i>"}n.push(r)}}),t(i.list.concat(n))}}else t(a.data)},mountUserImg:function(a){function t(t){for(var n=0;t&&n<t.length;n++)e.callBack.willMountEachUser.call(a[0]),t[n]&&e.editAuthority&&n<e.maxNum?r.appendChild($('<div class="avatar" style="width:'+e.width+"px;height:"+e.height+'px;">'+t[n]+"</div>")[0]):t[n]&&!e.editAuthority&&n<e.maxNum&&r.appendChild($('<div class="avatar disabled" style="width:'+e.width+"px;height:"+e.height+'px;">'+t[n]+"</div>")[0]),e.callBack.didMountEachUser.call(r.children[r.childElementCount-1]),(t.length>e.maxNum||t.length<=e.maxNum)&&n>0&&(r.children[r.children.length-1].style.marginLeft=-1*e.width/2+"px");var d=t.length?e.width:0;t.length>e.maxNum&&r.appendChild($('<div class="avatar avatar-points" title="'+i+'" style="width:'+e.width+"px;height:"+e.height+"px;margin-left: "+-1*d/2+'px;"></div>')[0]),0!=e.editAuthority&&(0!==d?r.appendChild($('<div class="avatar avatar-add-user" style="width:'+e.width+"px;height:"+e.height+"px;margin-left: "+-1*d/2+'px;"></div>')[0]):r.appendChild($('<div class="avatar avatar-add-user" style="width:'+e.width+"px;height:"+e.height+'px;"></div>')[0])),r.appendChild($('<input value="'+i.replace(/\([\u4e00-\u9fa5]+\)/g,"")+'" type="hidden" name="'+e.hiddenName+'" />')[0]),a.find(".editable-value").length&&!a.attr("data-avatar-editableinit")&&"avatarlist"===a.data("editable")?(a.find(".editable-value").html(r),a.attr("data-avatar-editableinit",!0)):(!a.attr("data-avatar-editableinit")||a.attr("data-avatar-editablereload"))&&a.html(r)}var e=this.initOptionByDom(a),i="string"!=typeof e.data?String("object"==typeof e.data?"":e.data):e.data;if(!e)return!1;if(a.data("defaults",e),"old"===e.skin)return e.initText?["string","number"].indexOf(typeof e.data)>-1&&e.data?a.find(".editable-value").length&&!a.attr("data-avatar-editableinit")&&"avatarlist"===a.data("editable")?(a.find(".editable-value").html('<span class="avatar-text" >'+e.data+'</span><input value="'+i.replace(/\([\u4e00-\u9fa5]+\)/g,"")+'" type="hidden" name="'+e.hiddenName+'"  autohide="false" rencentusers-max-length="'+e.recentUsers+'"/>').attr("title",e.data),a.attr("data-avatar-editableinit",!0)):(!a.attr("data-avatar-editableinit")||a.attr("data-avatar-editablereload"))&&a.html('<span class="avatar-text" >'+e.data+'</span><input value="'+i.replace(/\([\u4e00-\u9fa5]+\)/g,"")+'" type="hidden" name="'+e.hiddenName+'" />').attr("title",e.data):a.find(".editable-value").length&&!a.attr("data-avatar-editableinit")&&"avatarlist"===a.data("editable")?(a.find(".editable-value").html('<span class="avatar-text" >--</span>').attr("title",e.data),a.attr("data-avatar-editableinit",!0)):(!a.attr("data-avatar-editableinit")||a.attr("data-avatar-editablereload"))&&a.html('<span class="avatar-text" >--</span>').attr("title",e.data):(a.html('<input name="'+e.hiddenName+'" type="text"  value="'+i.replace(/\([\u4e00-\u9fa5]+\)/g,"")+'" id="'+e.id+'" data-control="pinyinuserchooser" autohide="false" rencentusers-max-length="'+e.recentUsers+'">'),TFL.pinyinuserchooser.active("#"+e.id)),!1;var r=document.createDocumentFragment();r.children=r.children?r.children:r.childNodes,this.loadUserList(e,t),e.callBack.didMountUserList.call(a,e)},initAction:function(){var a=".tfl-avatar-list .avatar, .tfl-avatar-list .avatar-text",t=$(document),e=this;t.undelegate(a,"click").delegate(a,"click",function(a){function t(){var a=s.data;"string"==typeof a&&(a=a.replace(/\([^()]*\)/g,""));var t=o.val().replace(/\([^()]*\)/g,"");a!==t&&"loading..."!=t?s.autoSubmit?o.hasClass("j-submit-locked")||(o.addClass("j-submit-locked"),e.send(o,r)):(o.remove(),r.data("avatar-users",t),e.mountUserImg(r)):(o.remove(),e.mountUserImg(r))}if(a.stopPropagation(),"false"===$(this).parent().attr("data-avatar-editauthority"))return!1;var i=$(this).closest(".tfl-avatar-list"),r=i,n="avatarInput",d=r.children().length*r.children().first().outerWidth()-(r.children().length-1)*r.children().first().outerWidth()/2,s=r.data("defaults"),l="new"===s.skin?0:1;d=1==l?"100%":d;var o=$('<input rencentusers-max-length="'+s.recentUsers+'" id="'+n+'" skin="'+s.skin.trim()+'" top="'+s.offsetTop+'" left="'+s.offsetLeft+'" data-control="pinyinuserchooser" style="width: '+d+"px;height: 22px;opacity: "+l+';" autohide="false"/>');return 0==s.editAuthority?!1:(("new"===s.skin||s.initText)&&r.html(o.val(s.data)),e.initPinyinChooserSource(i,o),o.on("blur",function(){return $(".tfl-userchooser").length?!1:void($("#recent-user-panel").is(":visible")||t())}),$(document).off("blur",".tfl-userchooser").on("blur",".tfl-userchooser",function(){t()}),TFL.pinyinuserchooser.active("#"+n,!0,s.autoSubmit),setTimeout(function(){e.inputSetCaret(o[0],$("#"+n+"Value").val().length),$("#"+n+"Value").focus()},0),void s.callBack.didMountInput.call(i,s))})},inputSetCaret:function(a,t){if(a.focus(),a.setSelectionRange)a.setSelectionRange(t,t);else if(a.createTextRange){var e=a.createTextRange();e.moveStart("character",t),e.collapse(),e.select()}},initPinyinChooserSource:function(a,t){var e=a.parent("[data-editable]"),i={};if(1==e.length){if(i=decodeURIComponent(TFL.editable._getAttribute(e,"data-editable-options")),!i||"undefined"===i)return;i=jQuery.parseJSON(i),"mixchooser"==e.attr("data-editable")&&(i.chooser_type=3)}i.data_source_url=a.attr("data-src-path")||i.data_source_url,i.data_source_url_params=a.attr("data-src-param")||i.data_source_url_params,i.chooser_type=a.attr("chooser-type")||i.chooser_type;var r=i.data_source_url||"",n=i.data_source_url_params||"",d=i.chooser_type||"1";return t.attr("chooser-type",d),t.attr("data-src-path",r),t.attr("data-src-param",n),i},initOptionByDom:function(a){var t=a.data("avatar-callback-willmounteachuser"),e=a.data("avatar-callback-didmounteachuser"),i=a.data("avatar-callback-didmountuserlist"),r=a.data("avatar-callback-didmountinput"),n=a.data("avatar-callback-didchange"),d=TFL.pinyinuserchooser.getWorkspaceID(),s={id:a.data("avatar-id")||"pinyinuserchooser"+Math.floor(1e4*Math.random()),width:a.data("avatar-imgwidth")||32,height:a.data("avatar-imgheight")||32,maxNum:a.data("avatar-maxnum")||3,offsetTop:Number(a.data("avatar-offsettop")||0),offsetLeft:Number(a.data("avatar-offsetleft")||0),data:a.data("avatar-users")||a.data("editable-value"),imgBaseUrl:a.data("avatar-imgbaseurl")||fileBasePath+d+"/users/avatar/",sendUrl:a.data("avatar-sendurl"),sendKeyName:a.data("avatar-sendkeyname"),skin:a.data("avatar-skin")||(enableAvatar?"new":"old"),recentUsers:a.data("avatar-recentusers")||"",showAddBtn:a.data("avatar-showaddbtn"),sendParams:a.data("avatar-sendparams"),editAuthority:a.data("avatar-editauthority"),initText:void 0!=a.data("avatar-inittext")?a.data("avatar-inittext"):!0,autoSubmit:void 0==a.data("avatar-autosubmit")?!0:a.data("avatar-autosubmit"),hiddenName:a.data("avatar-hiddenname")||"avatarListName",defaultImg:a.data("avatar-defaultimg")||(isCloud?"":_base+"img/avatar.jpg"),chooserType:a.attr("chooser-type"),dataSrcPath:a.data("src-path"),dataSrcParam:a.data("src-param"),callBack:{willMountEachUser:t?new Function("return "+t)():function(){},didMountEachUser:e?new Function("return "+e)():function(){},didMountUserList:i?new Function("return "+i)():function(){},didMountInput:r?new Function("return "+r)():function(){},didChange:n?new Function("return "+n)():function(){}},$dom:a};TFL.avatarList.userSourceData||(TFL.avatarList.userSourceData={}),TFL.avatarList.userSourceData[d]||(TFL.avatarList.userSourceData[d]=TFL.pinyinuserchooser.getData(s)),void 0===s.editAuthority&&(s.editAuthority=!0,a.attr("data-avatar-editauthority",!0)),s.data&&"--"!==s.data||(s.data=[]),"string"==typeof s.sendParams&&(s.sendParams=JSON.parse(decodeURIComponent(s.sendParams)));try{"string"==typeof s.data&&(s.data=JSON.parse(s.data))}catch(l){return s}return s}},!0);
TFL.widget("progressBar",{init:function(t,s){t||(t=$("#Contentprogress"),0==t.length&&(t=$(".tfl-progress"))),s||(s="0%"),t.each(function(){var t=$(this).attr("data-progress"),r=$(this).attr("data-hiddenPersent"),a=$(this).attr("data-init");if(!a){(!t||t.length<2)&&(t=s);var i=36-8*t.length+"px",e=t;"true"==r&&(t="",i="5px");var n=t+"<div class='progress' style='margin-left:"+i+"'><div class='progress-bar' style='width:"+e+"'></div></div>";$(this).addClass("progress-wrap"),"0%"==t&&$(this).css("color","#8091a5"),$(this).attr("data-init","true"),$(this).html(n)}})}});
var TFLLoadFileListMap=["js/tfl-core.js","js/tfl-button.js","js/tfl-dialog.js","js/tfl-dropdown.js","js/tfl-tips.js","js/tfl-formValidate.js","js/tfl-localdata.js","js/tfl-cluetip.js","js/tfl-dkselect.js","js/tfl-confirm.js","js/tfl-datepicker.js","js/tfl-datetimepicker.js","js/tfl-daterangepicker.js","js/tfl-field.js","js/tfl-filter.js","js/tfl-editable.js","js/tfl-remove.js","js/tfl-guide.js","js/tfl-template.js","js/tfl-pinyinuserchooser.js","js/tfl-pinyinuserchooser-avatar.js","js/tfl-avatarlist.js","js/tfl-progress-bar.js",]