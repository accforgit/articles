TFL.widget("WorktableCounting",{worktables:[],add_worktable:function(t){this.worktables.push(t),this.get_counting_data()},get_no_cache_counting_data:function(){var t=this,a=_base+"worktable_ajax/get_top_nav_worktable_data?no_cache=true&t="+Math.random();t._get_counting_data(a)},get_counting_data:function(){var t=this,a=_base+"worktable_ajax/get_top_nav_worktable_data?t="+Math.random();t._get_counting_data(a)},_get_counting_data:function(t){var a=this;$.getJSON(t,function(t){a.fill_data_to_view(t),$(document).trigger({type:"worktablecounting",workdata:t})})},fill_data_to_view:function(t){if(t)for(var a=this,o=a.worktables.length,n=0;o>n;n++){for(var e=a.worktables[n],_=e.find(".t-num"),d=["todo_total","todo_bug","todo_story","todo_task","todo_launch","todo_tobject","unread_notice"],i=["todo_tobject","todo_feedback","todo_launch"],r=0;r<d.length;r++){var s=d[r];if(0===t[s]&&$.inArray(s,i)>-1)_.find("."+s).parents("li.r2").remove();else{var c=0;c=Number(t[s])>99?'<span class="num-dot"></span><span class="num-dot"></span><span class="num-dot"></span>':t[s],_.find("."+s).html(c),"unread_notice"==s&&_.find("."+s).length>0&&"undefined"!=typeof t[s]&&t[s]>0&&_.addClass("nav-icon-num")}}t.todo_total>0?$(e).find("#todo_workitem_count").addClass("nav-icon-num"):$(e).find("#todo_workitem_count").remove()}}});