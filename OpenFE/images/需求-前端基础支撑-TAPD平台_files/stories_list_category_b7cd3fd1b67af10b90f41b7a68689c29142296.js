!function(t){t.fn.hoverIntent=function(e,n){var o={sensitivity:7,interval:100,timeout:0};o=t.extend(o,n?{over:e,out:n}:e);var r,i,u,v,s=function(t){r=t.pageX,i=t.pageY},a=function(e,n){return n.hoverIntent_t=clearTimeout(n.hoverIntent_t),Math.abs(u-r)+Math.abs(v-i)<o.sensitivity?(t(n).unbind("mousemove",s),n.hoverIntent_s=1,o.over.apply(n,[e])):(u=r,v=i,n.hoverIntent_t=setTimeout(function(){a(e,n)},o.interval),void 0)},h=function(t,e){return e.hoverIntent_t=clearTimeout(e.hoverIntent_t),e.hoverIntent_s=0,o.out.apply(e,[t])},m=function(e){for(var n=("mouseover"==e.type?e.fromElement:e.toElement)||e.relatedTarget;n&&n!=this;)try{n=n.parentNode}catch(e){n=this}if(n==this)return!1;var r=jQuery.extend({},e),i=this;i.hoverIntent_t&&(i.hoverIntent_t=clearTimeout(i.hoverIntent_t)),"mouseover"==e.type?(u=r.pageX,v=r.pageY,t(i).bind("mousemove",s),1!=i.hoverIntent_s&&(i.hoverIntent_t=setTimeout(function(){a(r,i)},o.interval))):(t(i).unbind("mousemove",s),1==i.hoverIntent_s&&(i.hoverIntent_t=setTimeout(function(){h(r,i)},o.timeout)))};return this.mouseover(m).mouseout(m)}}(jQuery);var CategoryManager=new Class({initialize:function(e){this.tree_id=e.tree_id,this.current_category_id=e.current_category_id,this.tree_url=e.tree_url,this.tree_div_id=e.tree_div_id,this.content_url_prefix=e.content_url_prefix,this.content_div_id=e.content_div_id;var t=$("#"+this.tree_div_id);this.registered_events=[],this.register_event(TapdEvent.Category_tree_reload_complete,t)},init_all:function(){var e=$("#"+this.tree_id);$("#category_tree_controller").unbind("fold_all, unfold_all").bind("fold_all",function(){e.trigger("collaps_all")}).bind("unfold_all",function(){e.trigger("expand_all")}),this.bind_category_clicked();var t=$("#"+this.tree_id+" a[obj_id='"+this.current_category_id+"']");t.length>0?t.trigger("click"):$("#"+this.tree_id+"_root_node").trigger("click")},bind_category_clicked:function(){var e=this;$("#"+e.tree_id).bind(TapdEvent.Category_clicked,function(t,i){var r=$(i).attr("obj_id");e.load_category_content(r)})},reload_tree:function(){$(".load_indicator").show();var e=this;$.ajax({cache:!1,url:this.tree_url,success:function(t){var i=$("#"+e.tree_div_id);i.html(""),i.html(t),e.bind_category_clicked(),e.publish_event(TapdEvent.Category_tree_reload_complete),e.init_all(),$(".load_indicator").hide()}})},load_category_content:function(e,t,i){var r=this,n=$("#"+r.content_div_id);TFL.use("mask",function(){TFL.mask.init(n)}),void 0==t&&(t=this.content_url_prefix+e+location.search),$.ajax({type:"GET",cache:!1,url:t,success:function(e){n.html(e),i&&i()}})},register_event:function(e,t){this.registered_events[e]=t},subscribe:function(e,t){var i=this.registered_events[e];i&&i.bind(e,t)},publish_event:function(e){var t=this.registered_events[e];t&&t.trigger(e)}}),CookieCategoryManager=new Class({initialize:function(e){this.base(e),this.name=void 0!=e.name?e.name:"selected_category_id",this.current_category_id=this.get_current_category_id(),this.category_url=document.location.href,this.register_event(TapdEvent.Stories_tree_table_updated,$("#"+this.content_div_id)),this.register_event(TapdEvent.Export_tapdbox_url_updated,$("#"+this.content_div_id))},get_current_category_id:function(){var e=$.cookie(this.name);return null==e?0:e},set_current_category_id:function(e){var t=this,i=t.name;$.cookie(i,e,{expires:365}),t.current_category_id=t.get_current_category_id()},bind_category_clicked:function(){var e=this;$("#"+e.tree_id).bind(TapdEvent.Category_clicked,function(t,i){var r=(e.name,$(i).attr("obj_id"));e.set_current_category_id(r);var n=$(i).attr("prev_obj_id"),_=$(i).attr("obj_id");e.load_category_content(n,_,r)})},load_category_content:function(e,t,i){this.process_category_content_url(e,t,i);var r=this;this.baseclass.load_category_content.call(this,t,this.category_url,function(){r.publish_event(TapdEvent.Stories_tree_table_updated),r.publish_event(TapdEvent.Export_tapdbox_url_updated)})},process_category_content_url:function(e,t,i){var r=this.category_url;void 0!=e&&e!=i&&(r=r.replace(/&page=\d+/,"&page=1")),r=r.replace(/\?category_id=\d+/,"?"),r=r.replace(/&category_id=\d+/,""),this.category_url=r+"&category_id="+t}});CookieCategoryManager.extend(CategoryManager);var shrink={init:function(){$(".j-tui-shrink").each(function(){var i=$(this);i.hasClass("font-public-shrink-right-icon")&&i.css("right","10px"),i.bind("click",function(){var t=$(i.attr("shrink-target"));switch(i.attr("shrink-target")){case"#category_div":var s="收起需求分类",r="打开需求分类";break;default:var s="收起",r="打开"}var a=i.attr("shrink-target")+"_width";i.hasClass("font-public-shrink-left-icon")?($.cookie(a,t.outerWidth()),$.cookie(user_id+"_"+_workspace_id+"_story_category_list_status",1),$("#sidebar-drag-handler").css("display","none"),t.width("0px").css("margin-right","0"),i.removeClass("font-public-shrink-left-icon").addClass("font-public-shrink-right-icon").attr("title",s),i.css("right","10px")):(t.width($.cookie(a)).css("margin-right","15px"),$.cookie(user_id+"_"+_workspace_id+"_story_category_list_status",0),$("#sidebar-drag-handler").css("display","block"),i.removeClass("font-public-shrink-right-icon").addClass("font-public-shrink-left-icon").attr("title",r),i.css("right","-12px")),"object"==typeof headFloat&&headFloat.init()})})}};function adjust_category_tree_scroll_bar(){var e=$("#category_tree_div"),t=0;t=$("#story_list_content")?$("#story_list_content").outerHeight():$("#story_lists_table").outerHeight();var o=500;if(o>t?e.height(o):e.height(t),e[0].scrollHeight<=e[0].clientHeight);else try{var i=$("#category_tree_div .current_category").offset().top-e.offset().top-e.height();i>0&&$("#category_tree_div").scrollTop(i+20)}catch(a){}}function pop_up_category_choose_dialog(e){var t=(new Date).getTime(),o=category_init_params.request_for_categories_tree_url+"&time="+t;$.get(o,function(e){e&&($("#category_choosing_dialog").dialog("option","open",function(e,t){var o=$(e.target);o.closest(".ui-dialog").find(".ui-dialog-buttonset a").first().addClass("btn-primary")}),$("#category_choosing_dialog").dialog("open"),$("#category_choosing_dialog").html(e),$("#category_choosing_dialog").dialog("option","position","center"),$("#tree_for_apply").bind("category_clicked",function(e,t){selected_category_id=$(t).attr("obj_id"),$("#selected_category_id").val(selected_category_id)}))})}function close_category_view(){var e="with_category_view",t="false";$.cookie(e,t,{expires:365})}function open_category_view(){var e="with_category_view",t="true";$.cookie(e,t,{expires:365})}function dragSidebar(){var e=$("#category_div").addClass("draggable-sidebar"),t=$('<span id="sidebar-drag-handler"><i class="ico-drag"></i></span>').appendTo(e);t.mousedown(function(){var t;$(this);if($("#category_div").size())var o=e.offset().left;else var o=0;$(document).mousemove(function(e){t=e.pageX-o;$("#left-tree").offset();t=t>800?800:t,t=150>t?150:t,$("#category_div").width(t),$("#category_tree_div").width(t),"function"==typeof change_category_width_call_back&&change_category_width_call_back(t),e.preventDefault()})}),$(document).mouseup(function(){$(document).unbind("mousemove")})}$(document).ready(function(){dragSidebar(),setTimeout(function(){new CookieCategoryManager({tree_id:"category_tree_for_view",tree_div_id:"category_tree_div",content_div_id:"stories_tree_table"});setTimeout(function(){setTimeout(function(){$("#check_all").bind("click",check_all_selected)},50);var e={};e[category_init_params.message_sure]=function(){refresh_selected_items(),selected_stories_ids=choosed_story(),$("#selected_stories_ids").val(selected_stories_ids),""==selected_stories_ids||";"==selected_stories_ids||""==$("#selected_category_id").val()?alert(category_init_params.select_story_alter_message):$("#selected_story_category").submit()},e[category_init_params.message_cancel]=function(){$("#category_choosing_dialog").dialog("close")},$("#category_choosing_dialog").dialog({autoOpen:!1,resizable:!1,modal:!0,width:350,height:400,bgiframe:!0,closeOnEscape:!0,open:function(){$("#category_choosing_dialog").css("padding-left",10)},buttons:e})},50)},50)});