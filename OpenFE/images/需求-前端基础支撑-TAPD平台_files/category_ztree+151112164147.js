TFL.widget("CategoryZtree",{data:{$zTreeObj:null,curDragNode:null,oldPId:""},options:null,extendOption:function(e){function t(e,t){var r=$("#"+t.tId+"_a");r.addClass("category_item").attr("obj_id",t.id).attr("title",t.description),r.closest("li").attr("obj_id",t.id).addClass("category_item_wrap")}function r(e,t,r){var n=$.Event("selectTreeNode");n.treeId=t,n.categoryId=r.id,$("#"+t).trigger(n)}function n(e,t,r){$("#"+t).trigger("set_category_count_num");var n=$.Event("expand.ztree");n.treeId=t,n.categoryId=r.id,$("#"+r.tId+"_switch").trigger(n)}function i(e,t,r){var n=$.Event("collapse.ztree");n.treeId=t,n.categoryId=r.id,$("#"+r.tId+"_switch").trigger(n)}function a(e,t){var r=l.data.curDragNode=t[0];switch(l.data.oldPId=r.pId,r.id+""){case"0":return!1;default:return!0}}function d(e,t,r){if(!r)return!1;switch(r.id+""){case"0":return!1}return!0}function o(e,t,r){if(!r)return!1;var n=t[0];if(n.id+""=="-1")return!1;switch(r.id+""){case"-1":case"0":return!1}return!0}function c(e,t,r){if(!r)return!1;switch(r.id+""){case"0":return!1}return!0}function s(e,t,r,n,i,a){if(null==i)return!1;for(var d=r[0],o=d.getParentNode(),c=o.children,s=c.length,u=[],g="",p=0;s>p;p++)u.push(c[p].id);o&&o.id!=l.data.oldPId&&(g=o.id);({"data[parent]":g,"data[sorting]":u.join(","),"data[current]":d.id})}var l=this,u={treeSettings:{data:{simpleData:{enable:!0}},view:{showIcon:!1,selectedMulti:!1,addDiyDom:t},edit:{drag:{autoExpandTrigger:!0,prev:d,inner:o,next:c},enable:!0,showRemoveBtn:!1,showRenameBtn:!1},check:{enable:!1,chkStyle:"checkbox",autoCheckTrigger:!1,chkboxType:{Y:"s",N:"s"}},callback:{onClick:r,onExpand:n,onCollapse:i,beforeDrag:a,onDrop:s}},treeId:"ztree",nodes:null};return this.options=$.extend(!0,{},u,e)},bindEvents:function(e){var t=this;$(document).bind("fold_all",function(e){t.data.$zTreeObj.expandAll(!1),$("#"+t.options.treeId).trigger("expandAll.ztree")}),$(document).bind("unfold_all",function(e){t.data.$zTreeObj.expandAll(!0),$("#"+t.options.treeId).trigger("collapseAll.ztree"),$("#"+t.options.treeId).trigger("set_category_count_num")})},_init:function(){var e=this.extendOption(this.options);return this.data.$zTreeObj=$.fn.zTree.init($("#"+e.treeId),e.treeSettings,e.nodes),this.bindEvents(),this.data.$zTreeObj}},!1,!0);